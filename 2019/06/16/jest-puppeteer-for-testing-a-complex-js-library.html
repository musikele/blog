<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<script>
		var host = "michelenasti.com";
		if ((host == window.location.host) && (window.location.protocol != "https:"))
			window.location.protocol = "https";
	</script>
	
	<title>Typescript: why so complicated?! (A list of my preferred options) - Michele Nasti's blog</title>
	 
	<meta name="keywords" content="" />  
	<meta http-equiv="last-modified" content="2019-06-24 23:45:11 +0200" /> 
	<!--<noscript>-->
	<link rel="stylesheet" href="/css/skel.css" />
	<link rel="stylesheet" href="/css/style.css" />
	<link rel="stylesheet" href="/css/style-xlarge.css" />
	<link rel="stylesheet" href="/css/colorful.css" />
	<link rel="stylesheet" href="/css/social.css" />
	<link rel="stylesheet" href="/node_modules/animate.css/animate.min.css" />
	<meta name="google-site-verification" content="wpVjnRuXV99CAZxjYBzZgKbJm-8_tdLPrlP43u9zhV0" /> <!-- facebook Open Graph Metadatas -->
<meta content="your_facebook_app_id" property="fb:app_id">
<meta content="" property="og:site_name">


  <meta content="Typescript: why so complicated?! (A list of my preferred options)" property="og:title">



  <meta content="article" property="og:type">



  <meta content="Typescript does not have sane defaults and I had to experiment a lot before finding the right set of options for my projects. Here's a discussion about module, target, outDir, moduleResolution, lib, etc" property="og:description">



  <meta content="https://michelenasti.com/2019/06/16/jest-puppeteer-for-testing-a-complex-js-library.html" property="og:url">



  <meta content="2019-06-16T00:00:00+02:00" property="article:published_time">
  <meta content="https://www.facebook.com/micnasti/" property="article:author">



<meta content="https://michelenasti.com///images/typescript-cover-image.jpg" property="og:image">



  


<!-- Twitter cards metadatas -->
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@vdaubry">
<meta name="twitter:creator" content="@micnasti">

  <meta name="twitter:title" content="Typescript: why so complicated?! (A list of my preferred options)">


  <meta name="twitter:url" content="https://michelenasti.com/2019/06/16/jest-puppeteer-for-testing-a-complex-js-library.html">



  <meta name="twitter:description" content="Typescript does not have sane defaults and I had to experiment a lot before finding the right set of options for my projects. Here's a discussion about module, target, outDir, moduleResolution, lib, etc">



  <meta name="twitter:image:src" content="https://michelenasti.com//images/typescript-cover-image.jpg">

	<!--</noscript>-->
	<!--[if lte IE 8]><link rel="stylesheet" href="/css/ie/v8.css" /><![endif]-->
	<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-88764277-1', 'auto');
  ga('send', 'pageview');

</script>
	<link rel="stylesheet" href="/css/prism.css" />
	
	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
    (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-9588917209740632",
        enable_page_level_ads: true
    });
</script>
</head>

<body id="top">

	<header id="header">
	<a href="#" class="image avatar"><img src="/images/michele_nasti.jpg" alt="michele nasti volto" /></a>
	<h1><strong><a href="/">Michele Nasti</a></strong><br /> Full-stack developer <br> with an eye for the web<br>
	</h1>
<a href="/chi-sono-michele-nasti/">Chi sono</a> | 
<a href="/talks-conferences/">Talks &amp; Conferences</a> | 
<a href="/archives/">Archives</a>

</header> <div id="main">
	<article>
		<header class="major">
			<h1 class="post-title"><a href="/2019/06/16/jest-puppeteer-for-testing-a-complex-js-library.html">Typescript: why so complicated?! (A list of my preferred options)</a></h1>
			<p class="post-meta">Jun 16, 2019 • musikele</p>
		</header>

		<section>
			
			<p>Hey there, after digging over the web about how Typescript settings mesh together, I decided to write an article about what I found <em>the hard way</em>.</p>

<p><img src="/images/typescript-cover-image.jpg" alt="" /></p>

<p>Once you install Typescript, default values are a bit dumb. For example, 99% of the world would put the source code in a <code>src</code> directory, and typescript has to be configured this way. Let’s change <code>tsconfig.json</code> into something more meaningful:</p>

<pre><code class="language-json">{
    "compilerOptions": {
        "module": "esnext",
        "target": "esnext",
        "sourceMap": true,
        "outDir": "./build/",
        "moduleResolution": "node",
        "lib": [
            "dom",
            "esnext",
            "dom.iterable",
            "scripthost"
        ],
    },
    "include": [
        "src/**/*.ts"
    ],
    "exclude": [
        "src/**/*.spec.ts",
        "src/**/*.test.ts"
    ],
    "compileOnSave": true
}
</code></pre>

<p>This is part of my setup. I will go through some of these options so you can choose wisely.</p>

<h3 id="the-target-option">The “target” option</h3>

<p>Typescript is a compiler from a superset to a subset of Javascript features and <code>target</code> determines what kind of EcmaScript (Javascript’s formal name) should be targeted.</p>

<p>Possible values are:</p>

<ul>
  <li><code>ES3</code> (default)</li>
  <li><code>ES5</code></li>
  <li><code>ES6</code></li>
  <li><code>esnext</code></li>
</ul>

<p>If you leave it blank, or choose <code>ES3</code>, your code would be compatible with very old browsers, like Internet Explorer 5 or Netscape Navigator (joking, but not that much). ES3 is the first standardized version of Javascript.</p>

<p>You may think this is a great default value and be tempted to use <code>fetch</code>, or <code>Promise</code>, and typescript will let you use them, BUT <strong>typescript will not add any polyfill to your code.</strong> Beware of this!</p>

<p>Similarly you can choose to run several different options, <code>ES5</code> (if your users are on Internet Explorer),  <code>ES6</code>… I prefer <code>esnext</code> to be able to use the latest features of the language and leave to Babel the transpilation step.</p>

<p>Did you know that prior to ES6 there was no official way to import some JS code inside another JS code? The community came out with several options and the next section will discuss them.</p>

<h3 id="the-module-option">The “module” option</h3>

<p><strong>module</strong> determines the way modules (and files) express dependencies between each other. Possible values are:</p>

<ul>
  <li><code>None</code></li>
  <li><code>CommonJS</code></li>
  <li><code>AMD</code></li>
  <li><code>System</code></li>
  <li><code>UMD</code></li>
  <li><code>ES6</code></li>
  <li><code>ES2015</code></li>
  <li><code>ESNext</code></li>
</ul>

<p>Ouch, so many options for a single task: importing code. Why?! That’s because the evolution of Javascript is non-linear,  and many of them do not apply for every platform.</p>

<p>If you use <strong>None</strong> you cannot use <code>import</code>, <code>export</code>, <code>require</code>… nothing.</p>

<p><strong>AMD</strong>, <strong>System</strong> and <strong>CommonJS</strong> are (IMHO) a thing of the past.  the first (AMD) came from <a href="https://requirejs.org/docs/whyamd.html" title="RequireJS">RequireJS</a> and the second from <a href="https://github.com/systemjs/systemjs" title="SystemJS">SystemJS</a>. These two are browser’s solutions. Not so long ago there was no way to express dependencies across JS files, so many competing systems came out to solve the same problem. AMD and SystemJS did not get enough fortune to become a standard.</p>

<p><strong>CommonJS</strong> is a spec that is very similar to what NodeJS has implemented (<code>require</code>/<code>exports</code>).</p>

<p><strong>UMD</strong> stands for <em>Universal Module Definition</em> and tries to deliver a module that works with every possible module definition defined before.</p>

<p>However, the ECMAScript community went for the <code>import/export</code> solution, and node has embraced that too, and we have that available in  <code>ES6</code> and <code>ES2015</code>.</p>

<p>Again, I prefer to use Typescript as a superset of JS, so I choose <code>esnext</code> and let webpack decide how to bundle stuff together.</p>

<h3 id="outdir-or-outfile-">outDir or outFile ?</h3>

<p>You have decided which module system you want to use (you know  my vote for <code>ES6</code>), but do you want a single file in output (<code>outFile</code>) or many single files in a output directory (<code>outDir</code>)?</p>

<p>If you write JS for the browser you may be tempted to go for <code>outFile</code> and let TS deal with everything. You may think that this way you can skip webpack, babel and so on. The problem is that TS allows to use this option only with <code>amd</code> and <code>system</code>. So this is a hard requirement for that.</p>

<p>The second big problem is that, to build a single file with all modules, Typescript needs also to know the <em>order</em> of files, so <em>you</em> have to provide the list in the right order. Imagine having 30-50-100 modules…</p>

<p>Again, my advice is to use<code>outDir</code>. For every source file you get a compiled file in the output directory. Then, again, did I tell you of webpack + babel?</p>

<h3 id="moduleresolution">ModuleResolution</h3>

<p>This setting accepts two possible values: <code>node</code> and <code>classic</code>. At this point there’s no need to have a value different than <code>node</code> here. For what I read <a href="https://www.typescriptlang.org/docs/handbook/module-resolution.html">in the official documentation</a>,</p>

<blockquote>
  <p>Nowadays, this strategy [<code>classic</code>] is mainly present for backward compatibility.</p>
</blockquote>

<h3 id="lib">Lib</h3>

<p>Since we are working in the browser and we are targeting a JS version greater than ES2015, I use the defaults that are <code>DOM,ES6,DOM.Iterable,ScriptHost</code>. The list of all available libraries is <a href="https://www.typescriptlang.org/docs/handbook/compiler-options.html">here</a>. If you forget to put those, Typescript will output weird errors like missing <code>Set</code> interface or other stuff - I guess the problem is that TS goes in <code>node_modules</code> and finds code that is obviously thought for Node, and it fails somehow.</p>

<h3 id="compileonsave">compileOnSave</h3>

<p>An option for IDEs to trigger compilation on a file save. If your IDE does not support it you can disable it but having it turned on it does not harm.</p>

<h2 id="conclusions">Conclusions</h2>

<p>So many choices to do and I guess inexperienced developers do not know what to do at first. Hoping to do them a favour!</p>

<p>I’ve also cited <strong>Webpack + Babel</strong> setup here, and this will be discussed in another article. It will require some changes here and there, and typescript will only be used to check the syntax of the project, but the transpilation will be done by Babel.</p>

<p>Curious? Stay tuned!</p>
 
			
			
<ul class="share-buttons">
  <li><a href="https://www.facebook.com/sharer/sharer.php?u=https://michelenasti.com/2019/06/16/jest-puppeteer-for-testing-a-complex-js-library.html&t=" title="Share on Facebook" target="_blank" onclick="window.open('https://www.facebook.com/sharer/sharer.php?u=' + encodeURIComponent(https://michelenasti.com/2019/06/16/jest-puppeteer-for-testing-a-complex-js-library.html) + '&t=' + encodeURIComponent(document.title)); return false;"><img alt="Share on Facebook" src="/images/icons/Facebook.svg"></a></li>
  <li><a href="https://twitter.com/intent/tweet?source=https://michelenasti.com/2019/06/16/jest-puppeteer-for-testing-a-complex-js-library.html&text=Typescript: why so complicated?! (A list of my preferred options):%20https://michelenasti.com/2019/06/16/jest-puppeteer-for-testing-a-complex-js-library.html&via=micnasti" target="_blank" title="Tweet" onclick="window.open('https://twitter.com/intent/tweet?text=' + encodeURIComponent(Typescript: why so complicated?! (A list of my preferred options)) + ':%20'  + encodeURIComponent(https://michelenasti.com/2019/06/16/jest-puppeteer-for-testing-a-complex-js-library.html)); return false;"><img alt="Tweet" src="/images/icons/Twitter.svg"></a></li>
  <li><a href="https://plus.google.com/share?url=https://michelenasti.com/2019/06/16/jest-puppeteer-for-testing-a-complex-js-library.html" target="_blank" title="Share on Google+" onclick="window.open('https://plus.google.com/share?url=' + encodeURIComponent(https://michelenasti.com/2019/06/16/jest-puppeteer-for-testing-a-complex-js-library.html)); return false;"><img alt="Share on Google+" src="/images/icons/Google+.svg"></a></li>
  <li><a href="http://www.linkedin.com/shareArticle?mini=true&url=https://michelenasti.com/2019/06/16/jest-puppeteer-for-testing-a-complex-js-library.html&title=Typescript: why so complicated?! (A list of my preferred options)&summary=&source=https://michelenasti.com/2019/06/16/jest-puppeteer-for-testing-a-complex-js-library.html" target="_blank" title="Share on LinkedIn" onclick="window.open('http://www.linkedin.com/shareArticle?mini=true&url=' + encodeURIComponent(https://michelenasti.com/2019/06/16/jest-puppeteer-for-testing-a-complex-js-library.html) + '&title=' +  encodeURIComponent(document.title)); return false;"><img alt="Share on LinkedIn" src="/images/icons/LinkedIn.svg"></a></li>
</ul>

			<h4>Related Posts:</h4>
<div class="articles-row">







    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    





    
        
        
        
        
        

        <div class="col-4">
            <h5><a href="/2016/03/gioco-flexbox/">Vuoi imparare flexbox ma ti annoi? Prova questo gioco</a></h5>
        </div>
    
        
        
        
        
        

        <div class="col-4">
            <h5><a href="/2018/04/05/come-realizzare-un-form-esterno-es-assistenza-che-manda-dati-a-magnews.html">Come realizzare un form esterno (Es. assistenza) che manda dati a MagNews</a></h5>
        </div>
    
        
        
        
        
        

        <div class="col-4">
            <h5><a href="/2015/11/angularizing-a-jquery-website-template-what-i-discovered-what-i-have-done/">Angularizing a jQuery website template: what I discovered, what I have done</a></h5>
        </div>
    
        
        
        
        
        

        <div class="col-4">
            <h5><a href="/2017/06/09/we-waglio-vuoi-venire-a-lavorare-nella-mia-startup.html">We' waglio', vuoi venire a lavorare nella mia startup?</a></h5>
        </div>
    


</div>

		</section>

		<section>
			 <div id="disqus_thread"></div>
<script>
    /**
     *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
     *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
     */
    
    var disqus_config = function () {
    	//var disqus_identifier = 'https://michelenasti.com';
			//var disqus_url = '';
			var disqus_url = 'https://michelenasti.com/2019/06/16/jest-puppeteer-for-testing-a-complex-js-library.html';
			var disqus_identifier = 'https://michelenasti.com/2019/06/16/jest-puppeteer-for-testing-a-complex-js-library.html';

    };
    
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = '//michele-nastis-blog.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript> 
		</section>

		<footer>			
			<div>
    

    <div class="6u 12u(small) excerpt" id="previousArticle">
        <header>
            <h2><a href="/2019/06/13/i-work-remote-i-do-two-video-calls-per-day.html">I work remote, I do two video meetings per day</a></h2>
        </header>
        <section>
            <p>Do you love meetings? Do you enjoy taking a break from your work and <em>talk</em> - ehm, <em>listen</em> to your managers, stakeholders, customers, peers? I suppose you not. If you’re like me, 99% of your work life meetings have been a total waste of time.</p>


        </section>
        <div>
            <ul class="actions">
                <li><a href="/2019/06/13/i-work-remote-i-do-two-video-calls-per-day.html" class="button">Read More</a></li>
            </ul>
        </div>
    </div>
     
</div>
		</footer>

	</article>

</div>
<script src="/js/infinite-scroll.js"></script>

	<!-- Footer -->
	<footer id="footer">
	<ul class="icons">

		
		<li>
			<a href="https://github.com/musikele" class="icon fa-github">
				<span class="label">GitHub</span>
			</a>
		</li>
		 
		<li>
			<a href="https://twitter.com/micnasti" class="icon fa-twitter">
				<span class="label">Twitter</span>
			</a>
		</li>
		 
		<li>
			<a href="https://linkedin.com/in/michelenasti" class="icon fa-linkedin">
				<span class="label">LinkedIn</span>
			</a>
		</li>
		 
		<li>
			<a href="https://plus.google.com/+MicheleNasti" class="icon fa-google-plus">
				<span class="label">Google+</span>
			</a>
		</li>
		 
		<li>
			<a href="https://www.facebook.com/musikele" class="icon fa-facebook">
				<span class="label">Facebook</span>
			</a>
		</li>
		  
	</ul>
	<ul class="copyright">
		<li>&copy; Michele Nasti</li>
		<li>Based on <a href="http://html5up.net/strata">STRATA</a> theme</li>
	</ul>
</footer>
	<!--[if lte IE 8]><script src="css/ie/html5shiv.js"></script><![endif]-->
	<script src="/js/jquery.min.js"></script>
	<script src="/js/jquery.poptrox.min.js"></script>
	<script src="/js/skel.min.js"></script>
	<script src="/js/init.js"></script>
	<script src="/js/prism.js"></script>
	<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.0.3/cookieconsent.min.css" />
<script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.0.3/cookieconsent.min.js"></script>
<script>
window.addEventListener("load", function(){
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#000"
    },
    "button": {
      "background": "#f1d600"
    }
  },
  "position": "bottom-left",
  "content": {
    "href": "//www.iubenda.com/privacy-policy/84379975"
  }
})});
</script>
	<!-- <script src="/js/badge.js"></script> -->
</body>

</html>
