<!DOCTYPE html>
<html>
  	<head>
			<script>
				var host = "michelenasti.com";
				if ((host == window.location.host) && (window.location.protocol != "https:"))
    		window.location.protocol = "https";
			</script>
			
				<title>Easy testing of NodeJS applications with Mocha - Michele Nasti's blog</title>
				<meta name="description" content="Testing in Javascript has become an immensely popular argument, but still there’s a lot of people that has not clear how to do it effectively. I was one of these. There are many troubles that a young developer has to overcome in order to master Javascript testing. In this article, I’m going to explain Javascript testing with Mocha, a powerful library.

" />
  		<meta name="keywords" content="Javascript, Nodejs, Testing, Mocha" />
			
			 
				<meta http-equiv="last-modified" content="2017-03-24 21:39:10 +0100" />
			
  		<!--<noscript>-->
  			<link rel="stylesheet" href="/css/skel.css" />
  			<link rel="stylesheet" href="/css/style.css" />
  			<link rel="stylesheet" href="/css/style-xlarge.css" />
				<link rel="stylesheet" href="/css/colorful.css" />
				<link rel="stylesheet" href="/css/social.css" />
				<meta name="google-site-verification" content="wpVjnRuXV99CAZxjYBzZgKbJm-8_tdLPrlP43u9zhV0" />
				<!-- facebook Open Graph Metadatas -->
<meta content="your_facebook_app_id" property="fb:app_id">
<meta content="" property="og:site_name">

  <meta content="Easy testing of NodeJS applications with Mocha" property="og:title">


  <meta content="article" property="og:type">


  <meta content="I'm a full stack Developer with an eye for the web." property="og:description">


  <meta content="https://michelenasti.com/2017/03/23/node-js-testing-easy-with-mocha.html" property="og:url">


  <meta content="2017-03-23T18:13:00+01:00" property="article:published_time">
  <meta content="https://michelenasti.com/about/" property="article:author">


  <meta content="/img/logo-high-resolution.png" property="og:image">


  
  <meta content="English" property="article:section">
  


  
  <meta content="Javascript" property="article:tag">
  
  <meta content="Nodejs" property="article:tag">
  
  <meta content="Testing" property="article:tag">
  
  <meta content="Mocha" property="article:tag">
  


<!-- Twitter cards metadatas -->
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@vdaubry">
<meta name="twitter:creator" content="@vdaubry">

  <meta name="twitter:title" content="Easy testing of NodeJS applications with Mocha">


  <meta name="twitter:url" content="https://michelenasti.com/2017/03/23/node-js-testing-easy-with-mocha.html">


  <meta name="twitter:description" content="I'm a full stack Developer with an eye for the web.">


<meta property="fb:pages" content="1069985669778335" />
  		<!--</noscript>-->
  		<!--[if lte IE 8]><link rel="stylesheet" href="/css/ie/v8.css" /><![endif]-->
  	</head>

	<body id="top">

		<header id="header">
	<a href="#" class="image avatar"><img src="/images/michele_nasti.jpg" alt="michele nasti volto" /></a>
	<h1><strong><a href="/">Michele Nasti</a></strong><br /> Full-stack developer <br> with an eye for the web<br>
	</h1>
<a href="/chi-sono-michele-nasti/">Chi sono</a> | 
<a href="/talks-conferences/">Talks &amp; Conferences</a> | 
<a href="/archives/">Archives</a>
</header>

<div id="main">
    <article>
        <header class="major">
            <h2 class="post-title"><a href="/2017/03/23/node-js-testing-easy-with-mocha.html">Easy testing of NodeJS applications with Mocha</a></h2>
                <p class="post-meta">Mar 23, 2017 • musikele</p>
        </header>

        <section>

					<p><script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- banner sotto al titolo - Michelenasti.com -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-9588917209740632"
     data-ad-slot="5184740634"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script></p>

        	<p>Testing in Javascript has become an immensely popular argument, but still there’s a lot of people that has not clear how to do it effectively. <a href="/2016/08/my-very-personal-javascript-fatigue/">I was one of these</a>. There are many troubles that a young developer has to overcome in order to master Javascript testing. In this article, I’m going to explain Javascript testing with Mocha, a powerful library.</p>

<h2 id="why-testing-in-javascript">Why testing in Javascript</h2>

<p>An easy example. You write a function that takes only one argument, and use it extensively. After some days, you modify this function to take two arguments.</p>

<p>Obviously you try to find every place where this function is called and add the missing parameter. Since the scripting nature of the language, how can you tell that this modification did not break anything? How to discover rapidly what to fix? Are users our only testers?</p>

<h2 id="setup-the-example">Setup the example</h2>

<p>Let’s write a simple Node test file. Let’s call it <code class="highlighter-rouge">utils.js</code>, a file where we put all the functions that do not fit in a specific module.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>module.exports.add = (a,b) =&amp;gt;  a + b;
</code></pre>
</div>

<p>That’s it! Let’s test this function. Is our sum function really doing its job?</p>

<h2 id="setup-the-test">Setup the test</h2>

<p>First, let’s install 
<a href="https://mochajs.org"><strong>Mocha</strong></a>. This is easy as launching</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ npm install --save-dev mocha 
</code></pre>
</div>

<p>Let’s modify our <code class="highlighter-rouge">package.json</code> (you did run <code class="highlighter-rouge">npm init</code>, didn’t you?) to add a new task:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>"scripts": {
    ... 
    "test": "mocha **/*.test.js"
  },
</code></pre>
</div>

<p>Mocha will be installed as a <em>development dependency</em>, this means that it is not necessary to run our code. Some deployment systems (like Heroku) will not download these dev dependencies.</p>

<p>As you can see, the <code class="highlighter-rouge">test</code> command will execute all files in every directory ending with <code class="highlighter-rouge">.test.js</code>. This is incredibly fast.</p>

<p>Let’s create in the very same directory where we put <code class="highlighter-rouge">utils.js</code>, another file called <code class="highlighter-rouge">utils.test.js</code>.</p>

<p>Here is the test code:</p>
<div class="highlighter-rouge"><pre class="highlight"><code>const utils = require('./utils'); //(1)

it('should add two numbers', () =&amp;gt; {   //(2)
  let res = utils.add(33,11);
  if (res !== 44) {
     throw new Error(`Expected: 44, but got ${res}`); //(3)
  }
});
</code></pre>
</div>

<p>And now you can simply run <code class="highlighter-rouge">npm test</code>. you should see an out like this:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ npm test

&amp;gt; node-tests@1.0.0 test /Users/michelenasti/Doc
uments/node-tests
&amp;gt; mocha **/*.test.js



  ✓ should add two numbers

  1 passing (13ms)

</code></pre>
</div>

<h2 id="whats-going-on">What’s going on</h2>

<p>Our tests are run directly by Mocha, that’s why we don’t import the library in this function.</p>

<p>Mocha provides us a function called <code class="highlighter-rouge">it()</code>. You might notice this function at (1). It takes two parameters: a description of the test, and a function with the code to execute.</p>

<p>In the JS community tests are usually written in a <em>Behaviour Driven Development</em> paradygm, this is a complex notion, for now let’s just say that test description starts with “<em>should …</em>”. I’ll write more in the future :)</p>

<p>The second argument passed to <code class="highlighter-rouge">it()</code> is a function with the actual test code. Here we call the function under test, take the result and check the correctness.</p>

<p>How Mocha decides if a test has passed or not? If no errors are thrown in our test code, then the test is marked as passed. On the other side, if an <code class="highlighter-rouge">Error()</code> object is thrown, the test will stop and the message of the <code class="highlighter-rouge">Error</code> is printed to the terminal.</p>

<p><em>Exercise for you: modify <code class="highlighter-rouge">utils.js</code> to let the test fail :)</em></p>

<h2 id="do-js-developers-throw-errors-to-test-their-functions">Do JS developers throw errors to test their functions?</h2>

<p>No, in reality JS developers NEVER throw Errors. Usually in JS we use some other libraries to <em>assert</em> some properties on the result, using functions that are more expressive. We will talk about this aspect in another post. However, I think that seeing how tests work without assertion libraries is <em>fundamental</em> to use such libraries.</p>

<h2 id="last-but-not-least">Last but not least</h2>

<p>Do you want your test to run automatically everytime you change some file? Of course you can, mixing some code coming from a previous post (<a href="https://michelenasti.com/2017/01/31/develop-faster-in-nodejs-with-nodemon.html">nodemon</a>).</p>

<p>In <code class="highlighter-rouge">package.json</code> add the script <code class="highlighter-rouge">test-watch</code>…</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="s2">"scripts"</span><span class="err">:</span> <span class="p">{</span>
   <span class="s2">"test"</span><span class="err">:</span> <span class="s2">"mocha **/*.test.js"</span><span class="p">,</span>
   <span class="s2">"test-watch"</span><span class="err">:</span> <span class="s2">"nodemon --exec \"npm test\""</span>
  <span class="p">},</span>
</code></pre>
</div>

<p>Happy testing!</p>


					
<ul class="share-buttons">
  <li><a href="https://www.facebook.com/sharer/sharer.php?u=https://michelenasti.com/2017/03/23/node-js-testing-easy-with-mocha.html&t=" title="Share on Facebook" target="_blank" onclick="window.open('https://www.facebook.com/sharer/sharer.php?u=' + encodeURIComponent(https://michelenasti.com/2017/03/23/node-js-testing-easy-with-mocha.html) + '&t=' + encodeURIComponent(document.title)); return false;"><img alt="Share on Facebook" src="/images/icons/Facebook.svg"></a></li>
  <li><a href="https://twitter.com/intent/tweet?source=https://michelenasti.com/2017/03/23/node-js-testing-easy-with-mocha.html&text=Easy testing of NodeJS applications with Mocha:%20https://michelenasti.com/2017/03/23/node-js-testing-easy-with-mocha.html&via=micnasti" target="_blank" title="Tweet" onclick="window.open('https://twitter.com/intent/tweet?text=' + encodeURIComponent(Easy testing of NodeJS applications with Mocha) + ':%20'  + encodeURIComponent(https://michelenasti.com/2017/03/23/node-js-testing-easy-with-mocha.html)); return false;"><img alt="Tweet" src="/images/icons/Twitter.svg"></a></li>
  <li><a href="https://plus.google.com/share?url=https://michelenasti.com/2017/03/23/node-js-testing-easy-with-mocha.html" target="_blank" title="Share on Google+" onclick="window.open('https://plus.google.com/share?url=' + encodeURIComponent(https://michelenasti.com/2017/03/23/node-js-testing-easy-with-mocha.html)); return false;"><img alt="Share on Google+" src="/images/icons/Google+.svg"></a></li>
  <li><a href="http://www.linkedin.com/shareArticle?mini=true&url=https://michelenasti.com/2017/03/23/node-js-testing-easy-with-mocha.html&title=Easy testing of NodeJS applications with Mocha&summary=&source=https://michelenasti.com/2017/03/23/node-js-testing-easy-with-mocha.html" target="_blank" title="Share on LinkedIn" onclick="window.open('http://www.linkedin.com/shareArticle?mini=true&url=' + encodeURIComponent(https://michelenasti.com/2017/03/23/node-js-testing-easy-with-mocha.html) + '&title=' +  encodeURIComponent(document.title)); return false;"><img alt="Share on LinkedIn" src="/images/icons/LinkedIn.svg"></a></li>
</ul>

					<p><script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- banner sotto al titolo - Michelenasti.com -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-9588917209740632"
     data-ad-slot="5184740634"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script></p>
        </section>

				<section>
					
						<div id="disqus_thread"></div>
<script>
    /**
     *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
     *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
     */
    
    var disqus_config = function () {
    	//var disqus_identifier = 'https://michelenasti.com';
			//var disqus_url = '';
			var disqus_url = 'https://michelenasti.com/2017/03/23/node-js-testing-easy-with-mocha.html';
			var disqus_identifier = 'https://michelenasti.com/2017/03/23/node-js-testing-easy-with-mocha.html';

    };
    
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = '//michele-nastis-blog.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
					
				</section>

        <footer> 
					<br> 
					Altri articoli: 
					<br>
          <div class="row">
            
            
                <article class="6u 12u(small) excerpt">
                    <header>
                        <h2><a href="/2017/03/20/l-inglese-tra-italiani-a-lavoro-e-una-scelta-sbagliata.html">L'Inglese tra italiani, a lavoro, è una scelta sbagliata</a></h2>
                    </header>
                    <section>
                        <p>C’è un trend che ogni tanto ritorna, ossia quello di usare l’inglese come lingua ufficiale durante l’orario di lavoro. Con colleghi italiani. In un ufficio italiano.</p>


                    </section>
                    <footer>
                        <ul class="actions">
                            <li><a href="/2017/03/20/l-inglese-tra-italiani-a-lavoro-e-una-scelta-sbagliata.html" class="button">Read More</a></li>
                        </ul>
                    </footer>
                </article>
            
            
            
            </div>
        </footer>

    </article>

</div>


        <!-- Footer -->
        <footer id="footer">
	<ul class="icons">

		
		<li>
			<a href="https://github.com/musikele" class="icon fa-github">
				<span class="label">GitHub</span>
			</a>
		</li>
		 
		<li>
			<a href="https://twitter.com/micnasti" class="icon fa-twitter">
				<span class="label">Twitter</span>
			</a>
		</li>
		 
		<li>
			<a href="https://linkedin.com/in/michelenasti" class="icon fa-linkedin">
				<span class="label">LinkedIn</span>
			</a>
		</li>
		 
		<li>
			<a href="https://plus.google.com/MicheleNasti" class="icon fa-google-plus">
				<span class="label">Google+</span>
			</a>
		</li>
		 
		<li>
			<a href="https://www.facebook.com/musikele" class="icon fa-facebook">
				<span class="label">Facebook</span>
			</a>
		</li>
		  
	</ul>
	<ul class="copyright">
		<li>&copy; Michele Nasti</li>
		<li>Based on <a href="http://html5up.net/strata">STRATA</a> theme</li>
	</ul>
</footer>
<!--[if lte IE 8]><script src="css/ie/html5shiv.js"></script><![endif]-->
  		<script src="/js/jquery.min.js"></script>
  		<script src="/js/jquery.poptrox.min.js"></script>
  		<script src="/js/skel.min.js"></script>
  		<script src="/js/init.js"></script>
			<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-88764277-1', 'auto');
  ga('send', 'pageview');

</script>
	</body>
</html>
