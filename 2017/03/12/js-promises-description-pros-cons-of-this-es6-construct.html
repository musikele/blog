<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<script>
		var host = "michelenasti.com";
		if ((host == window.location.host) && (window.location.protocol != "https:"))
			window.location.protocol = "https";
	</script>
	
	<title>JS Promises: description, pros, cons of this ES6 construct - Michele Nasti's blog</title>
	 
	<meta name="keywords" content="javascript, es6, promises" />  
	<meta http-equiv="last-modified" content="2017-09-19 10:17:10 +0200" /> 
	<!--<noscript>-->
	<link rel="stylesheet" href="/css/skel.css" />
	<link rel="stylesheet" href="/css/style.css" />
	<link rel="stylesheet" href="/css/style-xlarge.css" />
	<link rel="stylesheet" href="/css/colorful.css" />
	<link rel="stylesheet" href="/css/social.css" />
	<link rel="stylesheet" href="/node_modules/animate.css/animate.min.css" />
	<meta name="google-site-verification" content="wpVjnRuXV99CAZxjYBzZgKbJm-8_tdLPrlP43u9zhV0" /> <!-- facebook Open Graph Metadatas -->
<meta content="your_facebook_app_id" property="fb:app_id">
<meta content="" property="og:site_name">


  <meta content="JS Promises: description, pros, cons of this ES6 construct" property="og:title">



  <meta content="article" property="og:type">



  <meta content="I'm a full stack Developer with an eye for the web." property="og:description">



  <meta content="https://michelenasti.com/2017/03/12/js-promises-description-pros-cons-of-this-es6-construct.html" property="og:url">



  <meta content="2017-03-12T14:06:29+01:00" property="article:published_time">
  <meta content="https://www.facebook.com/micnasti/" property="article:author">



<meta content="/img/logo-high-resolution.png" property="og:image">



  
  <meta content="javascript" property="article:tag">
  
  <meta content="es6" property="article:tag">
  
  <meta content="promises" property="article:tag">
  


<!-- Twitter cards metadatas -->
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@vdaubry">
<meta name="twitter:creator" content="@micnasti">

  <meta name="twitter:title" content="JS Promises: description, pros, cons of this ES6 construct">


  <meta name="twitter:url" content="https://michelenasti.com/2017/03/12/js-promises-description-pros-cons-of-this-es6-construct.html">



  <meta name="twitter:description" content="I'm a full stack Developer with an eye for the web.">



	<!--</noscript>-->
	<!--[if lte IE 8]><link rel="stylesheet" href="/css/ie/v8.css" /><![endif]-->
	<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-88764277-1', 'auto');
  ga('send', 'pageview');

</script>
	<link rel="stylesheet" href="/css/prism.css" />
</head>

<body id="top">

	<header id="header">
	<a href="#" class="image avatar"><img src="/images/michele_nasti.jpg" alt="michele nasti volto" /></a>
	<h1><strong><a href="/">Michele Nasti</a></strong><br /> Full-stack developer <br> with an eye for the web<br>
	</h1>
<a href="/chi-sono-michele-nasti/">Chi sono</a> | 
<a href="/talks-conferences/">Talks &amp; Conferences</a> | 
<a href="/archives/">Archives</a>

</header> <div id="main">
	<article>
		<header class="major">
			<h1 class="post-title"><a href="/2017/03/12/js-promises-description-pros-cons-of-this-es6-construct.html">JS Promises: description, pros, cons of this ES6 construct</a></h1>
			<p class="post-meta">Mar 12, 2017 • musikele</p>
		</header>

		<section>
			
<ul class="share-buttons">
  <li><a href="https://www.facebook.com/sharer/sharer.php?u=https://michelenasti.com/2017/03/12/js-promises-description-pros-cons-of-this-es6-construct.html&t=" title="Share on Facebook" target="_blank" onclick="window.open('https://www.facebook.com/sharer/sharer.php?u=' + encodeURIComponent(https://michelenasti.com/2017/03/12/js-promises-description-pros-cons-of-this-es6-construct.html) + '&t=' + encodeURIComponent(document.title)); return false;"><img alt="Share on Facebook" src="/images/icons/Facebook.svg"></a></li>
  <li><a href="https://twitter.com/intent/tweet?source=https://michelenasti.com/2017/03/12/js-promises-description-pros-cons-of-this-es6-construct.html&text=JS Promises: description, pros, cons of this ES6 construct:%20https://michelenasti.com/2017/03/12/js-promises-description-pros-cons-of-this-es6-construct.html&via=micnasti" target="_blank" title="Tweet" onclick="window.open('https://twitter.com/intent/tweet?text=' + encodeURIComponent(JS Promises: description, pros, cons of this ES6 construct) + ':%20'  + encodeURIComponent(https://michelenasti.com/2017/03/12/js-promises-description-pros-cons-of-this-es6-construct.html)); return false;"><img alt="Tweet" src="/images/icons/Twitter.svg"></a></li>
  <li><a href="https://plus.google.com/share?url=https://michelenasti.com/2017/03/12/js-promises-description-pros-cons-of-this-es6-construct.html" target="_blank" title="Share on Google+" onclick="window.open('https://plus.google.com/share?url=' + encodeURIComponent(https://michelenasti.com/2017/03/12/js-promises-description-pros-cons-of-this-es6-construct.html)); return false;"><img alt="Share on Google+" src="/images/icons/Google+.svg"></a></li>
  <li><a href="http://www.linkedin.com/shareArticle?mini=true&url=https://michelenasti.com/2017/03/12/js-promises-description-pros-cons-of-this-es6-construct.html&title=JS Promises: description, pros, cons of this ES6 construct&summary=&source=https://michelenasti.com/2017/03/12/js-promises-description-pros-cons-of-this-es6-construct.html" target="_blank" title="Share on LinkedIn" onclick="window.open('http://www.linkedin.com/shareArticle?mini=true&url=' + encodeURIComponent(https://michelenasti.com/2017/03/12/js-promises-description-pros-cons-of-this-es6-construct.html) + '&title=' +  encodeURIComponent(document.title)); return false;"><img alt="Share on LinkedIn" src="/images/icons/LinkedIn.svg"></a></li>
</ul>
			
			<p>I hope that you have done some kind of exploration with Javascript, NodeJS and asynchronous constructs right now.</p>

<p>To recap: when you wait for an async operation to handle the result, for example in NodeJS when we read a file, we do this:</p>

<pre><code class="language-javascript">const fs = require('fs');
fs.readFile('filename.txt', (err, data) =&gt; {
   if (err) throw err; 
   //now you can use the data object 
   ...
});
</code></pre>

<p>This is the standard, classic way of handling asynchronicity in NodeJS and Javascript.</p>

<p>In the last few years a new approach has come to rise, first from outside libraries, then as part of ES6 language: <strong>Promises</strong>.</p>

<p><img src="/images/promise.jpg" alt="" style="float: none;" /></p>

<p><em>Not me in the photo. This is the Italian way to promise. I love his way of looking guilty. </em></p>

<h2 id="i-promise-that-i-will-give-you-the-result">I promise that I will give you the result</h2>

<p>I don’t want to talk about the history of promises, because like everything in JS Promises have a complex story coming from many libraries doing the same thing, with different syntaxes and patterns.</p>

<p>However ES6 has standardized this, and now we have a fantastic <code>Promise</code> object. Let’s see how to use it.</p>

<p>The following snippet will create a Promise that waits 2,5 seconds and then sends a message <code>Hey. it worked</code>:</p>

<pre><code class="language-javascript">let somePromise = new Promise((resolve, reject) =&gt; { //1
  setTimeout(() =&gt; {
    // only one can be called and only once 
    resolve('Hey. it worked');                      //2
    //reject('Unable to fulfill promise');          //3
  }, 2500);
}); 

somePromise.then(                                   //4
  (message) =&gt; {
    console.log('Success: ' + message);
  }, 
  (errorMessage) =&gt; {
    console.log('Error: ', errorMessage);
  }
);
</code></pre>

<p>My definition of promises: <strong>a <code>Promise</code> is a wrapper object that you use to encapsulate a function that might return a value in the future</strong>.</p>

<p>We declare a promise as showed in (1): <code>new Promise()</code> with a function inside.</p>

<p>This function takes two arguments that are two other functions, usually called <code>resolve</code> and <code>reject</code>. So the full specification is <code>let somePromise = new Promise((resolve, reject) =&gt; {...});</code>.</p>

<p>How do you use these two parameters? <code>resolve</code> (2) is a function used to return a value, when the function ends normally (e.g. reading a file, you get the content of the file and return to the caller); <code>reject</code> (3) is used when you encounter a problem (e.g. you couldn’t read the file).</p>

<p>There are some bonds on using Promises:</p>

<ul>
  <li>you cannot call both <code>resolve</code> or <code>reject</code>in your code. As soon as one of the two functions gets called, the promise stops.</li>
  <li>if you don’t call any of the two functions, the promise will hang.</li>
  <li>you can only pass <strong>one</strong> parameter to <code>resolve</code> or <code>reject</code>. If you have more stuff to pass, wrap everything in an object.</li>
</ul>

<p>Ok, now we have defined a promise. How do we use it? An example is shown in (4): we just call the promise and then use the <code>then</code> method to use the response.</p>

<p><code>then</code> can take two functions as arguments:</p>

<ul>
  <li>the first callback is called when the promise ends correctly, with the value contained in <code>resolve</code></li>
  <li>the second callback is the <em>error handler</em>, so you might want to use it when you want to get data from the <code>reject</code> function.</li>
</ul>

<h2 id="chaining-promises">Chaining promises</h2>

<p>This approach is nice, but the true power comes when you can <code>chain</code> many promises one after another.</p>

<p>The following code shows a function <code>asyncAdd</code> that adds two numbers after 1,5 seconds. I bet your calculator is faster. It does however some checks on the type of <code>a</code> and <code>b</code>, to be sure they are numbers.</p>

<pre><code class="language-javascript">let asyncAdd = (a, b) =&gt; {
  return new Promise((resolve, reject) =&gt; {
    setTimeout(() =&gt; {
      if (typeof a === 'number' &amp;&amp; typeof b === 'number') {
        resolve(a + b);
      } else {
        reject('Arguments must be numbers');
      }
    }, 1500);
  });
};

asyncAdd(5, 7)                         // (1)
  .then((result) =&gt; {                  // (2)
    console.log(result);
    return asyncAdd(result, '33');     // (3)
  })
  .then((res) =&gt; {                     // (4)
    console.log('Should be 45:', res); 
  })
  .catch((errorMessage) =&gt; {           // (5)
    console.log(errorMessage);
  })
</code></pre>

<p><strong>Quiz</strong>: what does this code print? (Answer below)</p>

<p>In (1) we are evaluating the first sum. <strong>Then</strong> (2) (<em>Look how it is semantically fantastic to express this concept in plain english!!!</em>) we write the result to console, and return another operation (3): we add the result to the number ‘33’ (<strong>note! it is a string!</strong>).</p>

<p>Since we are returning a function that returns a promise, we can chain the two promises with another <code>then()</code>.</p>

<p>We didn’t write the second <code>then</code> callback, because we have used the <code>.catch()</code> method. We will explain this in a second.</p>

<p>In the second <code>then()</code> (4) we would print the result of the total sum.</p>

<p>Lastly, in (5) we have the <code>catch</code> block. In the previous paragraph we were saying that you can handle errors inside every <code>then</code>, but if you chain many <code>then</code> together and the first one fails, the others are still executed. Usually you don’t want this, because the next <code>then</code> depends on the result of the previous.</p>

<p>So, if you just want to stop an operation at the first error encountered, you can use a single <code>catch()</code> block at the end: whatever promise will fail, be it the first or the last, the <code>catch</code> block will be called to handle the failure. So easy to reason about.</p>

<p>(Sorry, no answer for the quiz… run it and see!)</p>

<h2 id="conclusions">Conclusions</h2>

<p>A promise is a new construct that, after some practice, becomes a powerful tool for your async constructs.</p>

<p>The advantages are that you don’t have to write anymore nested callbacks with a lot of indented code, that is often complex to reason about, and to handle errors.</p>

<p>The disadvantage is that there is much more than what I wrote in this article, about promises, that covers every possible edge case that naturally occours when you work with async code. However, what you read here should cover 80% of your needs.</p>

<p>You can transform every callback in a promise; many NodeJS core developers don’t like promises at all, and use only callbacks. Popular libraries in NPM use one way or the other to deliver results, so you might be forced to use one or the other approach based on this.</p>
 
			
			
<ul class="share-buttons">
  <li><a href="https://www.facebook.com/sharer/sharer.php?u=https://michelenasti.com/2017/03/12/js-promises-description-pros-cons-of-this-es6-construct.html&t=" title="Share on Facebook" target="_blank" onclick="window.open('https://www.facebook.com/sharer/sharer.php?u=' + encodeURIComponent(https://michelenasti.com/2017/03/12/js-promises-description-pros-cons-of-this-es6-construct.html) + '&t=' + encodeURIComponent(document.title)); return false;"><img alt="Share on Facebook" src="/images/icons/Facebook.svg"></a></li>
  <li><a href="https://twitter.com/intent/tweet?source=https://michelenasti.com/2017/03/12/js-promises-description-pros-cons-of-this-es6-construct.html&text=JS Promises: description, pros, cons of this ES6 construct:%20https://michelenasti.com/2017/03/12/js-promises-description-pros-cons-of-this-es6-construct.html&via=micnasti" target="_blank" title="Tweet" onclick="window.open('https://twitter.com/intent/tweet?text=' + encodeURIComponent(JS Promises: description, pros, cons of this ES6 construct) + ':%20'  + encodeURIComponent(https://michelenasti.com/2017/03/12/js-promises-description-pros-cons-of-this-es6-construct.html)); return false;"><img alt="Tweet" src="/images/icons/Twitter.svg"></a></li>
  <li><a href="https://plus.google.com/share?url=https://michelenasti.com/2017/03/12/js-promises-description-pros-cons-of-this-es6-construct.html" target="_blank" title="Share on Google+" onclick="window.open('https://plus.google.com/share?url=' + encodeURIComponent(https://michelenasti.com/2017/03/12/js-promises-description-pros-cons-of-this-es6-construct.html)); return false;"><img alt="Share on Google+" src="/images/icons/Google+.svg"></a></li>
  <li><a href="http://www.linkedin.com/shareArticle?mini=true&url=https://michelenasti.com/2017/03/12/js-promises-description-pros-cons-of-this-es6-construct.html&title=JS Promises: description, pros, cons of this ES6 construct&summary=&source=https://michelenasti.com/2017/03/12/js-promises-description-pros-cons-of-this-es6-construct.html" target="_blank" title="Share on LinkedIn" onclick="window.open('http://www.linkedin.com/shareArticle?mini=true&url=' + encodeURIComponent(https://michelenasti.com/2017/03/12/js-promises-description-pros-cons-of-this-es6-construct.html) + '&title=' +  encodeURIComponent(document.title)); return false;"><img alt="Share on LinkedIn" src="/images/icons/LinkedIn.svg"></a></li>
</ul>

			<h4>Related Posts:</h4>
<div class="articles-row">







    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    
        <div class="col-4">
        <h5><a href="/2017/11/16/why-nan.html">Other thoughts about NaN (then, stop) <span class="label label-default">javascript</span> </a></h5>
        </div>
        
         
    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    
        <div class="col-4">
        <h5><a href="/2017/04/14/javascript-filter-map-reduce.html">Diventare Senior™ con Javascript: le funzioni filter, map, reduce <span class="label label-default">javascript</span> </a></h5>
        </div>
        
         
    



    
    

    

    
        <div class="col-4">
        <h5><a href="/2017/04/08/all-my-articles-about-testing-in-javascript-in-one-post.html">All my articles about Testing in Javascript in one post <span class="label label-default">javascript</span> </a></h5>
        </div>
        
         
    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    



    
    

    

    
        <div class="col-4">
        <h5><a href="/the-javascript-event-loop-for-dummies/">The Javascript Event Loop for dummies <span class="label label-default">javascript</span> </a></h5>
        </div>
        
        
            



    


</div>

		</section>

		<section>
			 <div id="disqus_thread"></div>
<script>
    /**
     *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
     *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
     */
    
    var disqus_config = function () {
    	//var disqus_identifier = 'https://michelenasti.com';
			//var disqus_url = '';
			var disqus_url = 'https://michelenasti.com/2017/03/12/js-promises-description-pros-cons-of-this-es6-construct.html';
			var disqus_identifier = 'https://michelenasti.com/2017/03/12/js-promises-description-pros-cons-of-this-es6-construct.html';

    };
    
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = '//michele-nastis-blog.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript> 
		</section>

		<footer>			
			<div>
    

    <div class="6u 12u(small) excerpt" id="previousArticle">
        <header>
            <h2><a href="/2017/02/28/quando-l-azienda-non-paga-gli-stipendi.html"> Quando l'azienda non paga gli stipendi</a></h2>
        </header>
        <section>
            <p>Qualche anno fa <strong>l’azienda per cui lavoravo ha attraversato un periodo di crisi e lo stipendio arrivava a singhiozzo</strong> (o peggio, non arrivava proprio). Lo ricordo come uno dei periodi più brutti della mia vita.</p>


        </section>
        <div>
            <ul class="actions">
                <li><a href="/2017/02/28/quando-l-azienda-non-paga-gli-stipendi.html" class="button">Read More</a></li>
            </ul>
        </div>
    </div>
     

    <div class="6u$ 12u(small) excerpt f-right" id="nextArticle">
        <header>
            <h2><a href="/2017/03/14/two-easy-ways-perform-get-requests-in-nodejs.html">Two easy ways perform GET requests in NodeJS </a></h2>
        </header>
        <section>
            <p>Today I want to talk about something that we all need during our programming life: requesting data from a remote server. We will do this using callbacks and promises, to show both the approaches.</p>


        </section>
        <div>
            <ul class="actions">
                <li><a href="//2017/03/14/two-easy-ways-perform-get-requests-in-nodejs.html" class="button">Read More</a></li>
            </ul>
        </div>
    </div>
    
</div>
		</footer>

	</article>

</div>
<script src="/js/infinite-scroll.js"></script>

	<!-- Footer -->
	<footer id="footer">
	<ul class="icons">

		
		<li>
			<a href="https://github.com/musikele" class="icon fa-github">
				<span class="label">GitHub</span>
			</a>
		</li>
		 
		<li>
			<a href="https://twitter.com/micnasti" class="icon fa-twitter">
				<span class="label">Twitter</span>
			</a>
		</li>
		 
		<li>
			<a href="https://linkedin.com/in/michelenasti" class="icon fa-linkedin">
				<span class="label">LinkedIn</span>
			</a>
		</li>
		 
		<li>
			<a href="https://plus.google.com/MicheleNasti" class="icon fa-google-plus">
				<span class="label">Google+</span>
			</a>
		</li>
		 
		<li>
			<a href="https://www.facebook.com/musikele" class="icon fa-facebook">
				<span class="label">Facebook</span>
			</a>
		</li>
		  
	</ul>
	<ul class="copyright">
		<li>&copy; Michele Nasti</li>
		<li>Based on <a href="http://html5up.net/strata">STRATA</a> theme</li>
	</ul>
</footer>
	<!--[if lte IE 8]><script src="css/ie/html5shiv.js"></script><![endif]-->
	<script src="/js/jquery.min.js"></script>
	<script src="/js/jquery.poptrox.min.js"></script>
	<script src="/js/skel.min.js"></script>
	<script src="/js/init.js"></script>
	<script src="/js/prism.js"></script>
	
	<!-- <script src="/js/badge.js"></script> -->
</body>

</html>
