<!DOCTYPE html>
<html>
  	<head>
			<script>
				var host = "michelenasti.com";
				if ((host == window.location.host) && (window.location.protocol != "https:"))
    		window.location.protocol = "https";
			</script>
			
				<title>JS Promises: description, pros, cons of this ES6 construct - Michele Nasti's blog</title>
				<meta name="description" content="I hope that you have done some kind of exploration with Javascript, NodeJS and asynchronous constructs right now.

" />
  		<meta name="keywords" content="javascript, es6, promises" />
			
			 
				<meta http-equiv="last-modified" content="2017-03-13 16:35:03 +0100" />
			
  		<!--<noscript>-->
  			<link rel="stylesheet" href="/css/skel.css" />
  			<link rel="stylesheet" href="/css/style.css" />
  			<link rel="stylesheet" href="/css/style-xlarge.css" />
				<link rel="stylesheet" href="/css/colorful.css" />
				<link rel="stylesheet" href="/css/social.css" />
				<meta name="google-site-verification" content="wpVjnRuXV99CAZxjYBzZgKbJm-8_tdLPrlP43u9zhV0" />
				<!-- facebook Open Graph Metadatas -->
<meta content="your_facebook_app_id" property="fb:app_id">
<meta content="" property="og:site_name">

  <meta content="JS Promises: description, pros, cons of this ES6 construct" property="og:title">


  <meta content="article" property="og:type">


  <meta content="I'm a full stack Developer with an eye for the web." property="og:description">


  <meta content="https://michelenasti.com/2017/03/12/js-promises-description-pros-cons-of-this-es6-construct.html" property="og:url">


  <meta content="2017-03-12T14:06:29+01:00" property="article:published_time">
  <meta content="https://michelenasti.com/about/" property="article:author">


  <meta content="/img/logo-high-resolution.png" property="og:image">


  
  <meta content="English" property="article:section">
  


  
  <meta content="javascript" property="article:tag">
  
  <meta content="es6" property="article:tag">
  
  <meta content="promises" property="article:tag">
  


<!-- Twitter cards metadatas -->
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@vdaubry">
<meta name="twitter:creator" content="@vdaubry">

  <meta name="twitter:title" content="JS Promises: description, pros, cons of this ES6 construct">


  <meta name="twitter:url" content="https://michelenasti.com/2017/03/12/js-promises-description-pros-cons-of-this-es6-construct.html">


  <meta name="twitter:description" content="I'm a full stack Developer with an eye for the web.">


<meta property="fb:pages" content="1069985669778335" />
  		<!--</noscript>-->
  		<!--[if lte IE 8]><link rel="stylesheet" href="/css/ie/v8.css" /><![endif]-->
  	</head>

	<body id="top">

		<header id="header">
	<a href="#" class="image avatar"><img src="/images/michele_nasti.jpg" alt="michele nasti volto" /></a>
	<h1><strong><a href="/">Michele Nasti</a></strong><br /> Full-stack developer <br> with an eye for the web<br>
	</h1>
<a href="/chi-sono-michele-nasti/">Chi sono</a> | 
<a href="/talks-conferences/">Talks &amp; Conferences</a> | 
<a href="/archives/">Archives</a>
</header>

<div id="main">
    <article>
        <header class="major">
            <h2 class="post-title"><a href="/2017/03/12/js-promises-description-pros-cons-of-this-es6-construct.html">JS Promises: description, pros, cons of this ES6 construct</a></h2>
                <p class="post-meta">Mar 12, 2017 • musikele</p>
        </header>

        <section>

					<p><script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- banner sotto al titolo - Michelenasti.com -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-9588917209740632"
     data-ad-slot="5184740634"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script></p>

        	<p>I hope that you have done some kind of exploration with Javascript, NodeJS and asynchronous constructs right now.</p>

<p>To recap: when you wait for an async operation to handle the result, for example in NodeJS when we read a file, we do this:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kr">const</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'fs'</span><span class="p">);</span>
<span class="nx">fs</span><span class="p">.</span><span class="nx">readFile</span><span class="p">(</span><span class="s1">'filename.txt'</span><span class="p">,</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
   <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="k">throw</span> <span class="nx">err</span><span class="p">;</span> 
   <span class="c1">//now you can use the data object </span>
   <span class="p">...</span>
<span class="p">});</span>
</code></pre>
</div>

<p>This is the standard, classic way of handling asynchronicity in NodeJS and Javascript.</p>

<p>In the last few years a new approach has come to rise, first from outside libraries, then as part of ES6 language: <strong>Promises</strong>.</p>

<p><img src="/images/promise.jpg" alt="" style="float: none;" /></p>

<p><em>Not me in the photo. This is the Italian way to promise. I love his way of looking guilty. </em></p>

<h2 id="i-promise-that-i-will-give-you-the-result">I promise that I will give you the result</h2>

<p>I don’t want to talk about the history of promises, because like everything in JS Promises have a complex story coming from many libraries doing the same thing, with different syntaxes and patterns.</p>

<p>However ES6 has standardized this, and now we have a fantastic <code class="highlighter-rouge">Promise</code> object. Let’s see how to use it.</p>

<p>The following snippet will create a Promise that waits 2,5 seconds and then sends a message <code class="highlighter-rouge">Hey. it worked</code>:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">somePromise</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="c1">//1</span>
  <span class="nx">setTimeout</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// only one can be called and only once </span>
    <span class="nx">resolve</span><span class="p">(</span><span class="s1">'Hey. it worked'</span><span class="p">);</span>                      <span class="c1">//2</span>
    <span class="c1">//reject('Unable to fulfill promise');          //3</span>
  <span class="p">},</span> <span class="mi">2500</span><span class="p">);</span>
<span class="p">});</span> 

<span class="nx">somePromise</span><span class="p">.</span><span class="nx">then</span><span class="p">(</span>                                   <span class="c1">//4</span>
  <span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Success: '</span> <span class="o">+</span> <span class="nx">message</span><span class="p">);</span>
  <span class="p">},</span> 
  <span class="p">(</span><span class="nx">errorMessage</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Error: '</span><span class="p">,</span> <span class="nx">errorMessage</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">);</span>
</code></pre>
</div>

<p>My definition of promises: <strong>a <code class="highlighter-rouge">Promise</code> is a wrapper object that you use to encapsulate a function that might return a value in the future</strong>.</p>

<p>We declare a promise as showed in (1): <code class="highlighter-rouge">new Promise()</code> with a function inside.</p>

<p>This function takes two arguments that are two other functions, usually called <code class="highlighter-rouge">resolve</code> and <code class="highlighter-rouge">reject</code>. So the full specification is <code class="highlighter-rouge">let somePromise = new Promise((resolve, reject) =&gt; {...});</code>.</p>

<p>How do you use these two parameters? <code class="highlighter-rouge">resolve</code> (2) is a function used to return a value, when the function ends normally (e.g. reading a file, you get the content of the file and return to the caller); <code class="highlighter-rouge">reject</code> (3) is used when you encounter a problem (e.g. you couldn’t read the file).</p>

<p>There are some bonds on using Promises:</p>

<ul>
  <li>you cannot call both <code class="highlighter-rouge">resolve</code> or <code class="highlighter-rouge">reject</code>in your code. As soon as one of the two functions gets called, the promise stops.</li>
  <li>if you don’t call any of the two functions, the promise will hang.</li>
  <li>you can only pass <strong>one</strong> parameter to <code class="highlighter-rouge">resolve</code> or <code class="highlighter-rouge">reject</code>. If you have more stuff to pass, wrap everything in an object.</li>
</ul>

<p>Ok, now we have defined a promise. How do we use it? An example is shown in (4): we just call the promise and then use the <code class="highlighter-rouge">then</code> method to use the response.</p>

<p><code class="highlighter-rouge">then</code> can take two functions as arguments:</p>

<ul>
  <li>the first callback is called when the promise ends correctly, with the value contained in <code class="highlighter-rouge">resolve</code></li>
  <li>the second callback is the <em>error handler</em>, so you might want to use it when you want to get data from the <code class="highlighter-rouge">reject</code> function.</li>
</ul>

<h2 id="chaining-promises">Chaining promises</h2>

<p>This approach is nice, but the true power comes when you can <code class="highlighter-rouge">chain</code> many promises one after another.</p>

<p>The following code shows a function <code class="highlighter-rouge">asyncAdd</code> that adds two numbers after 1,5 seconds. I bet your calculator is faster. It does however some checks on the type of <code class="highlighter-rouge">a</code> and <code class="highlighter-rouge">b</code>, to be sure they are numbers.</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">asyncAdd</span> <span class="o">=</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">new</span> <span class="nx">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">setTimeout</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">a</span> <span class="o">===</span> <span class="s1">'number'</span> <span class="o">&amp;&amp;</span> <span class="k">typeof</span> <span class="nx">b</span> <span class="o">===</span> <span class="s1">'number'</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">resolve</span><span class="p">(</span><span class="nx">a</span> <span class="o">+</span> <span class="nx">b</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">reject</span><span class="p">(</span><span class="s1">'Arguments must be numbers'</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">},</span> <span class="mi">1500</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">};</span>

<span class="nx">asyncAdd</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>                         <span class="c1">// (1)</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">result</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>                  <span class="c1">// (2)</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">asyncAdd</span><span class="p">(</span><span class="nx">result</span><span class="p">,</span> <span class="s1">'33'</span><span class="p">);</span>     <span class="c1">// (3)</span>
  <span class="p">})</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>                     <span class="c1">// (4)</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Should be 45:'</span><span class="p">,</span> <span class="nx">res</span><span class="p">);</span> 
  <span class="p">})</span>
  <span class="p">.</span><span class="k">catch</span><span class="p">((</span><span class="nx">errorMessage</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>           <span class="c1">// (5)</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">errorMessage</span><span class="p">);</span>
  <span class="p">})</span>
</code></pre>
</div>

<p><strong>Quiz</strong>: what does this code print? (Answer below)</p>

<p>In (1) we are evaluating the first sum. <strong>Then</strong> (2) (<em>Look how it is semantically fantastic to express this concept in plain english!!!</em>) we write the result to console, and return another operation (3): we add the result to the number ‘33’ (<strong>note! it is a string!</strong>).</p>

<p>Since we are returning a function that returns a promise, we can chain the two promises with another <code class="highlighter-rouge">then()</code>.</p>

<p>We didn’t write the second <code class="highlighter-rouge">then</code> callback, because we have used the <code class="highlighter-rouge">.catch()</code> method. We will explain this in a second.</p>

<p>In the second <code class="highlighter-rouge">then()</code> (4) we would print the result of the total sum.</p>

<p>Lastly, in (5) we have the <code class="highlighter-rouge">catch</code> block. In the previous paragraph we were saying that you can handle errors inside every <code class="highlighter-rouge">then</code>, but if you chain many <code class="highlighter-rouge">then</code> together and the first one fails, the others are still executed. Usually you don’t want this, because the next <code class="highlighter-rouge">then</code> depends on the result of the previous.</p>

<p>So, if you just want to stop an operation at the first error encountered, you can use a single <code class="highlighter-rouge">catch()</code> block at the end: whatever promise will fail, be it the first or the last, the <code class="highlighter-rouge">catch</code> block will be called to handle the failure. So easy to reason about.</p>

<p>(Sorry, no answer for the quiz… run it and see!)</p>

<h2 id="conclusions">Conclusions</h2>

<p>A promise is a new construct that, after some practice, becomes a powerful tool for your async constructs.</p>

<p>The advantages are that you don’t have to write anymore nested callbacks with a lot of indented code, that is often complex to reason about, and to handle errors.</p>

<p>The disadvantage is that there is much more than what I wrote in this article, about promises, that covers every possible edge case that naturally occours when you work with async code. However, what you read here should cover 80% of your needs.</p>

<p>You can transform every callback in a promise; many NodeJS core developers don’t like promises at all, and use only callbacks. Popular libraries in NPM use one way or the other to deliver results, so you might be forced to use one or the other approach based on this.</p>


					
<ul class="share-buttons">
  <li><a href="https://www.facebook.com/sharer/sharer.php?u=https://michelenasti.com/2017/03/12/js-promises-description-pros-cons-of-this-es6-construct.html&t=" title="Share on Facebook" target="_blank" onclick="window.open('https://www.facebook.com/sharer/sharer.php?u=' + encodeURIComponent(https://michelenasti.com/2017/03/12/js-promises-description-pros-cons-of-this-es6-construct.html) + '&t=' + encodeURIComponent(document.title)); return false;"><img alt="Share on Facebook" src="/images/icons/Facebook.svg"></a></li>
  <li><a href="https://twitter.com/intent/tweet?source=https://michelenasti.com/2017/03/12/js-promises-description-pros-cons-of-this-es6-construct.html&text=JS Promises: description, pros, cons of this ES6 construct:%20https://michelenasti.com/2017/03/12/js-promises-description-pros-cons-of-this-es6-construct.html&via=micnasti" target="_blank" title="Tweet" onclick="window.open('https://twitter.com/intent/tweet?text=' + encodeURIComponent(JS Promises: description, pros, cons of this ES6 construct) + ':%20'  + encodeURIComponent(https://michelenasti.com/2017/03/12/js-promises-description-pros-cons-of-this-es6-construct.html)); return false;"><img alt="Tweet" src="/images/icons/Twitter.svg"></a></li>
  <li><a href="https://plus.google.com/share?url=https://michelenasti.com/2017/03/12/js-promises-description-pros-cons-of-this-es6-construct.html" target="_blank" title="Share on Google+" onclick="window.open('https://plus.google.com/share?url=' + encodeURIComponent(https://michelenasti.com/2017/03/12/js-promises-description-pros-cons-of-this-es6-construct.html)); return false;"><img alt="Share on Google+" src="/images/icons/Google+.svg"></a></li>
  <li><a href="http://www.linkedin.com/shareArticle?mini=true&url=https://michelenasti.com/2017/03/12/js-promises-description-pros-cons-of-this-es6-construct.html&title=JS Promises: description, pros, cons of this ES6 construct&summary=&source=https://michelenasti.com/2017/03/12/js-promises-description-pros-cons-of-this-es6-construct.html" target="_blank" title="Share on LinkedIn" onclick="window.open('http://www.linkedin.com/shareArticle?mini=true&url=' + encodeURIComponent(https://michelenasti.com/2017/03/12/js-promises-description-pros-cons-of-this-es6-construct.html) + '&title=' +  encodeURIComponent(document.title)); return false;"><img alt="Share on LinkedIn" src="/images/icons/LinkedIn.svg"></a></li>
</ul>

					<p><script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- banner sotto al titolo - Michelenasti.com -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-9588917209740632"
     data-ad-slot="5184740634"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script></p>
        </section>

				<section>
					
						<div id="disqus_thread"></div>
<script>
    /**
     *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
     *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
     */
    
    var disqus_config = function () {
    	//var disqus_identifier = 'https://michelenasti.com';
			//var disqus_url = '';
			var disqus_url = 'https://michelenasti.com/2017/03/12/js-promises-description-pros-cons-of-this-es6-construct.html';
			var disqus_identifier = 'https://michelenasti.com/2017/03/12/js-promises-description-pros-cons-of-this-es6-construct.html';

    };
    
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = '//michele-nastis-blog.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
					
				</section>

        <footer> 
					<br> 
					Altri articoli: 
					<br>
          <div class="row">
            
            
                <article class="6u 12u(small) excerpt">
                    <header>
                        <h2><a href="/2017/02/28/quando-l-azienda-non-paga-gli-stipendi.html"> Quando l'azienda non paga gli stipendi</a></h2>
                    </header>
                    <section>
                        <p>Qualche anno fa <strong>l’azienda per cui lavoravo ha attraversato un periodo di crisi e lo stipendio arrivava a singhiozzo</strong> (o peggio, non arrivava proprio). Lo ricordo come uno dei periodi più brutti della mia vita.</p>


                    </section>
                    <footer>
                        <ul class="actions">
                            <li><a href="/2017/02/28/quando-l-azienda-non-paga-gli-stipendi.html" class="button">Read More</a></li>
                        </ul>
                    </footer>
                </article>
            
            
            
            
                <article class="6u$ 12u(small) excerpt f-right">
                    <header>
                        <h2><a href="/2017/03/14/two-easy-ways-perform-get-requests-in-nodejs.html">Two easy ways perform GET requests in NodeJS </a></h2>
                    </header>
                    <section>
                        <p>Today I want to talk about something that we all need during our programming life: requesting data from a remote server. We will do this using callbacks and promises, to show both the approaches.</p>


                    </section>
                    <footer>
                        <ul class="actions">
                            <li><a href="//2017/03/14/two-easy-ways-perform-get-requests-in-nodejs.html" class="button">Read More</a></li>
                        </ul>
                    </footer>
                </article>
            
            </div>
        </footer>

    </article>

</div>


        <!-- Footer -->
        <footer id="footer">
	<ul class="icons">

		
		<li>
			<a href="https://github.com/musikele" class="icon fa-github">
				<span class="label">GitHub</span>
			</a>
		</li>
		 
		<li>
			<a href="https://twitter.com/micnasti" class="icon fa-twitter">
				<span class="label">Twitter</span>
			</a>
		</li>
		 
		<li>
			<a href="https://linkedin.com/in/michelenasti" class="icon fa-linkedin">
				<span class="label">LinkedIn</span>
			</a>
		</li>
		 
		<li>
			<a href="https://plus.google.com/MicheleNasti" class="icon fa-google-plus">
				<span class="label">Google+</span>
			</a>
		</li>
		 
		<li>
			<a href="https://www.facebook.com/musikele" class="icon fa-facebook">
				<span class="label">Facebook</span>
			</a>
		</li>
		  
	</ul>
	<ul class="copyright">
		<li>&copy; Michele Nasti</li>
		<li>Based on <a href="http://html5up.net/strata">STRATA</a> theme</li>
	</ul>
</footer>
<!--[if lte IE 8]><script src="css/ie/html5shiv.js"></script><![endif]-->
  		<script src="/js/jquery.min.js"></script>
  		<script src="/js/jquery.poptrox.min.js"></script>
  		<script src="/js/skel.min.js"></script>
  		<script src="/js/init.js"></script>
			<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-88764277-1', 'auto');
  ga('send', 'pageview');

</script>
	</body>
</html>
