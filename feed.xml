<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title></title>
    <description>I'm a full stack Developer with an eye for the web.</description>
    <link>https://michelenasti.com/</link>
    <atom:link href="https://michelenasti.com/feed.xml" rel="self" type="application/rss+xml" />
    <updated>2017-04-27T10:28:11+00:00</updated>
    <id>https://michelenasti.com</id>
    <author>
      <name></name>
    </author>
    
      <item>
        <title>&quot;Vorrei, ma ho paura che vada male&quot;	&amp;#58 come assumersi dei &quot;rischi intelligenti&quot;</title>
        <link>https://michelenasti.com/2017/04/21/vorrei-ma-ho-paura-che-vada-male-come-assumersi-dei-rischi-intelligenti.html</link>
        <guid isPermaLink="true">https://michelenasti.com/2017/04/21/vorrei-ma-ho-paura-che-vada-male-come-assumersi-dei-rischi-intelligenti.html</guid>
        <pubDate>Fri, 21 Apr 2017 00:00:00 +0000</pubDate>
        <author></author>
        
          <description>&lt;p&gt;Oggi vorrei parlarvi di &lt;strong&gt;come assumersi dei rischi intelligenti&lt;/strong&gt;. Intelligenti in che senso?!&lt;/p&gt;

&lt;p&gt;Questo post ce l’ho in testa da molto tempo, almeno da quando ho letto il libro &lt;a href=&quot;http://amzn.to/2oaDAB6&quot;&gt;Startup Of You&lt;/a&gt; di Reid Hoffman (fondatore di LinkedIn) e Ben Casnocha. Per i duri di comprendorio inglese qui c’è la &lt;a href=&quot;http://amzn.to/2oQsY92&quot;&gt;versione in Italiano&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Nel libro gli autori spiegano cosa si può fare per &lt;strong&gt;conferire alla propria vita e alla propria carriera un atteggiamento “da startup”&lt;/strong&gt;: ci sono una lunga serie di consigli, discussioni, esempi, e insomma è uno dei libri che ho letto con più piacere.&lt;img src=&quot;/images/rischio-investimenti-definizione-749x400.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;i-rischi-intelligenti&quot;&gt;I rischi intelligenti&lt;/h2&gt;

&lt;p&gt;&lt;em&gt;Siamo abituati a pensare ai rischi come qualcosa di negativo&lt;/em&gt;: perdite di denaro sui mercati azionari, o guida di una moto senza casco. Ma il rischio non è un nemico; è qualcosa che fa intrinsecamente parte della nostra vita.&lt;/p&gt;

&lt;p&gt;Le situazioni rischiose, comunque, sono quelle in cui la possibilità che le cose vadano male è decisamente più alto del vantaggio che si ottiene se le cose vanno bene.&lt;/p&gt;

&lt;p&gt;Ad esempio, &lt;strong&gt;volare in aereo non è rischioso&lt;/strong&gt;, perché anche se lo scenario peggiore è &lt;em&gt;molto **doloroso&lt;/em&gt; la possibilità che questo accada è bassissima. Invece, il tempo di viaggio risparmiato è un dato di fatto.&lt;/p&gt;

&lt;p&gt;Alcuni imprenditori sono dei cowboy del rischio; tuttavia, &lt;strong&gt;ciò che distingue un imprenditore giudizioso da un semplice spavaldo non è l’alta tolleranza al rischio, ma l’abilità di saperlo valutare e gestire correttamente&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;Il rischio, in un contesto come quello del lavoro, è correlato alle scelte che facciamo, e alla possibilità che qualcosa vada storto. Ad esempio, quando cambiamo lavoro, ci assumiamo il rischio che il nuovo possa essere anche peggiore del vecchio, e invochiamo tutte le divinità affinché non sia così!&lt;/p&gt;

&lt;p&gt;Ma non solo tutto ciò che facciamo comporta rischi; &lt;strong&gt;anche&lt;/strong&gt; &lt;strong&gt;ciò che NON facciamo è altamente rischioso&lt;/strong&gt;. Questo vale specialmente quando il mondo intorno a noi sta cambiando e richiede un nostro adattamento.&lt;/p&gt;

&lt;h2 id=&quot;valutare-i-rischi&quot;&gt;Valutare i rischi&lt;/h2&gt;

&lt;p&gt;&lt;strong&gt;Valutare i rischi è difficile, ma non impossibile. Gli imprenditori lo fanno tutti i giorni.&lt;/strong&gt; Tuttavia, essi non usano analisi matematiche o economiche (degne di Wall Street!) per prendere decisioni; sinceramente, non dovremmo farlo neanche noi.&lt;/p&gt;

&lt;p&gt;Ecco alcuni princìpi guida:&lt;/p&gt;

&lt;h3 id=&quot;1-stiamo-esagerando-nella-valutazione&quot;&gt;1. stiamo esagerando nella valutazione?&lt;/h3&gt;

&lt;p&gt;Il primo passo nella valutazione di un rischio è ricordarsi che &lt;strong&gt;il caso peggiore probabilmente non è così brutto, o così probabile, come sembra&lt;/strong&gt;.&lt;/p&gt;

&lt;h3 id=&quot;2-il-caso-peggiore-è-tollerabile&quot;&gt;2. Il caso peggiore è tollerabile?&lt;/h3&gt;

&lt;p&gt;Se accade il caso peggiore cosa succede alla nostra vita? La reputazione scenderà a livelli sotto zero, perderemo tutti i soldi, la carriera sarà definitivamente finita?&lt;/p&gt;

&lt;p&gt;Se nel caso peggiore accade che perdiamo &lt;em&gt;un po’&lt;/em&gt; di soldi, o veniamo licenziati (posto che riusciamo a trovare un altro lavoro subito), o rischi semplicemente di sentirti inadeguato, &lt;strong&gt;dovresti comunque provarci&lt;/strong&gt;. Almeno finché hai un &lt;a href=&quot;https://michelenasti.com/2015/11/serve-un-piano/&quot;&gt;solido Piano Z&lt;/a&gt;.&lt;/p&gt;

&lt;h3 id=&quot;3-puoi-cambiare-la-decisione-a-metà-dellopera-puoi-passare-al-piano-b&quot;&gt;3. Puoi cambiare la decisione a metà dell’opera? Puoi passare al piano B?&lt;/h3&gt;

&lt;p&gt;Quando vediamo che le cose si stanno mettendo male, possiamo fare delle scelte che ti permettono di tornare indietro e ricominciare?&lt;/p&gt;

&lt;h3 id=&quot;4-non-confondiamo-lincertezza-con-il-rischio&quot;&gt;4. Non confondiamo l’incertezza con il rischio&lt;/h3&gt;

&lt;p&gt;Nessuno può sapere come andrà prima del tempo. Ma questo non significa che l’incertezza sia un rischio! &lt;strong&gt;Le opportunità migliori sono quelle con i più grandi punti interrogativi&lt;/strong&gt;.&lt;/p&gt;

&lt;h3 id=&quot;5-considera-la-tua-età-e-a-che-fase-della-tua-vita-ti-trovi-quali-saranno-i-rischi-tra-un-paio-danni&quot;&gt;5. Considera la tua età e a che fase della tua vita ti trovi. Quali saranno i rischi tra un paio d’anni?&lt;/h3&gt;

&lt;p&gt;Fallire da ragazzi è considerato formativo; è per questo che sono i ventenni a fondare le aziende più strampalate.&lt;/p&gt;

&lt;p&gt;Man mano che invecchi, la tua percezione del rischio cambia. Arrivano i bambini, la casa, l’auto, etc.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Meglio fare qualcosa di rischioso prima che sia troppo tardi&lt;/strong&gt; ;)&lt;/p&gt;

&lt;h2 id=&quot;facciamo-un-rapido-test&quot;&gt;Facciamo un rapido test…&lt;/h2&gt;

&lt;p&gt;Prendetevi 30 secondi per ogni punto sottostante. Provate a immaginare i pro e i contro delle seguenti situazioni. Considerati i cinque punti espressi precedentemente, come cambierebbe la tua vita se:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;trovi un lavoro fantastico e strapagato ma è negli USA&lt;/li&gt;
  &lt;li&gt;la tua azienda smette di pagare gli stipendi&lt;/li&gt;
  &lt;li&gt;inizi a dirigere un team&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Questo semplice esercizio mentale magari vi farà riflettere su come percepite il rischio; nel mio caso mi ha aiutato a fare scelte più consapevoli nel mondo del lavoro.&lt;/p&gt;

&lt;p&gt;In bocca al rischio ;)&lt;/p&gt;

</description>
        
        <content:encoded>
            <![CDATA[
                <!doctype html>
                <html lang="en" prefix="op: http://media.facebook.com/op#">
              <head>
                <meta charset="utf-8">
                <link rel="canonical" href="https://michelenasti.com/2017/04/21/vorrei-ma-ho-paura-che-vada-male-come-assumersi-dei-rischi-intelligenti.html">
                <meta property="op:markup_version" content="v1.0">
              </head>
              <body>
                <article>
                  <header>
                      <h1>&quot;Vorrei, ma ho paura che vada male&quot;	&amp;#58 come assumersi dei &quot;rischi intelligenti&quot;</h1>
                      
                      <figure>
                          <img src="https://michelenasti.com/images/michele_nasti.jpg" alt=" "Vorrei, ma ho paura che vada male"	&#58 come assumersi dei "rischi intelligenti" ">
                          <figcaption>"Vorrei, ma ho paura che vada male"	&#58 come assumersi dei "rischi intelligenti"</figcaption>
                      </figure>
                      
                      <time class="op-published" dateTime="2017-04-21 00:00:00 UTC">Fri, 21 Apr 2017 00:00:00 +0000</time>
                      <time class="op-modified" dateTime=""></time>
                  </header>
                  
                    <p>Oggi vorrei parlarvi di <strong>come assumersi dei rischi intelligenti</strong>. Intelligenti in che senso?!</p>

<p>Questo post ce l’ho in testa da molto tempo, almeno da quando ho letto il libro <a href="http://amzn.to/2oaDAB6">Startup Of You</a> di Reid Hoffman (fondatore di LinkedIn) e Ben Casnocha. Per i duri di comprendorio inglese qui c’è la <a href="http://amzn.to/2oQsY92">versione in Italiano</a>.</p>

<p>Nel libro gli autori spiegano cosa si può fare per <strong>conferire alla propria vita e alla propria carriera un atteggiamento “da startup”</strong>: ci sono una lunga serie di consigli, discussioni, esempi, e insomma è uno dei libri che ho letto con più piacere.<img src="/images/rischio-investimenti-definizione-749x400.jpg" alt="" /></p>

<h2 id="i-rischi-intelligenti">I rischi intelligenti</h2>

<p><em>Siamo abituati a pensare ai rischi come qualcosa di negativo</em>: perdite di denaro sui mercati azionari, o guida di una moto senza casco. Ma il rischio non è un nemico; è qualcosa che fa intrinsecamente parte della nostra vita.</p>

<p>Le situazioni rischiose, comunque, sono quelle in cui la possibilità che le cose vadano male è decisamente più alto del vantaggio che si ottiene se le cose vanno bene.</p>

<p>Ad esempio, <strong>volare in aereo non è rischioso</strong>, perché anche se lo scenario peggiore è <em>molto **doloroso</em> la possibilità che questo accada è bassissima. Invece, il tempo di viaggio risparmiato è un dato di fatto.</p>

<p>Alcuni imprenditori sono dei cowboy del rischio; tuttavia, <strong>ciò che distingue un imprenditore giudizioso da un semplice spavaldo non è l’alta tolleranza al rischio, ma l’abilità di saperlo valutare e gestire correttamente</strong>.</p>

<p>Il rischio, in un contesto come quello del lavoro, è correlato alle scelte che facciamo, e alla possibilità che qualcosa vada storto. Ad esempio, quando cambiamo lavoro, ci assumiamo il rischio che il nuovo possa essere anche peggiore del vecchio, e invochiamo tutte le divinità affinché non sia così!</p>

<p>Ma non solo tutto ciò che facciamo comporta rischi; <strong>anche</strong> <strong>ciò che NON facciamo è altamente rischioso</strong>. Questo vale specialmente quando il mondo intorno a noi sta cambiando e richiede un nostro adattamento.</p>

<h2 id="valutare-i-rischi">Valutare i rischi</h2>

<p><strong>Valutare i rischi è difficile, ma non impossibile. Gli imprenditori lo fanno tutti i giorni.</strong> Tuttavia, essi non usano analisi matematiche o economiche (degne di Wall Street!) per prendere decisioni; sinceramente, non dovremmo farlo neanche noi.</p>

<p>Ecco alcuni princìpi guida:</p>

<h3 id="1-stiamo-esagerando-nella-valutazione">1. stiamo esagerando nella valutazione?</h3>

<p>Il primo passo nella valutazione di un rischio è ricordarsi che <strong>il caso peggiore probabilmente non è così brutto, o così probabile, come sembra</strong>.</p>

<h3 id="2-il-caso-peggiore-è-tollerabile">2. Il caso peggiore è tollerabile?</h3>

<p>Se accade il caso peggiore cosa succede alla nostra vita? La reputazione scenderà a livelli sotto zero, perderemo tutti i soldi, la carriera sarà definitivamente finita?</p>

<p>Se nel caso peggiore accade che perdiamo <em>un po’</em> di soldi, o veniamo licenziati (posto che riusciamo a trovare un altro lavoro subito), o rischi semplicemente di sentirti inadeguato, <strong>dovresti comunque provarci</strong>. Almeno finché hai un <a href="https://michelenasti.com/2015/11/serve-un-piano/">solido Piano Z</a>.</p>

<h3 id="3-puoi-cambiare-la-decisione-a-metà-dellopera-puoi-passare-al-piano-b">3. Puoi cambiare la decisione a metà dell’opera? Puoi passare al piano B?</h3>

<p>Quando vediamo che le cose si stanno mettendo male, possiamo fare delle scelte che ti permettono di tornare indietro e ricominciare?</p>

<h3 id="4-non-confondiamo-lincertezza-con-il-rischio">4. Non confondiamo l’incertezza con il rischio</h3>

<p>Nessuno può sapere come andrà prima del tempo. Ma questo non significa che l’incertezza sia un rischio! <strong>Le opportunità migliori sono quelle con i più grandi punti interrogativi</strong>.</p>

<h3 id="5-considera-la-tua-età-e-a-che-fase-della-tua-vita-ti-trovi-quali-saranno-i-rischi-tra-un-paio-danni">5. Considera la tua età e a che fase della tua vita ti trovi. Quali saranno i rischi tra un paio d’anni?</h3>

<p>Fallire da ragazzi è considerato formativo; è per questo che sono i ventenni a fondare le aziende più strampalate.</p>

<p>Man mano che invecchi, la tua percezione del rischio cambia. Arrivano i bambini, la casa, l’auto, etc.</p>

<p><strong>Meglio fare qualcosa di rischioso prima che sia troppo tardi</strong> ;)</p>

<h2 id="facciamo-un-rapido-test">Facciamo un rapido test…</h2>

<p>Prendetevi 30 secondi per ogni punto sottostante. Provate a immaginare i pro e i contro delle seguenti situazioni. Considerati i cinque punti espressi precedentemente, come cambierebbe la tua vita se:</p>

<ul>
  <li>trovi un lavoro fantastico e strapagato ma è negli USA</li>
  <li>la tua azienda smette di pagare gli stipendi</li>
  <li>inizi a dirigere un team</li>
</ul>

<p>Questo semplice esercizio mentale magari vi farà riflettere su come percepite il rischio; nel mio caso mi ha aiutato a fare scelte più consapevoli nel mondo del lavoro.</p>

<p>In bocca al rischio ;)</p>


                  
                    <footer>
                        <aside>Written by Amit Seal Ami, a Lecturer from Institute of Information Technology, University of Dhaka.</aside>
                        <small>Copyright - Amit Seal Ami</small>
                  </footer>
                </article>
              </body>
            </html>
        ]]>
        </content:encoded>

      </item>
    
      <item>
        <title>Diventare Senior™ con Javascript: le funzioni filter, map, reduce</title>
        <link>https://michelenasti.com/2017/04/14/javascript-filter-map-reduce.html</link>
        <guid isPermaLink="true">https://michelenasti.com/2017/04/14/javascript-filter-map-reduce.html</guid>
        <pubDate>Fri, 14 Apr 2017 10:09:00 +0000</pubDate>
        <author></author>
        
          <description>&lt;p&gt;Si può lavorare per anni con javascript senza mai arrivare a conoscere tre funzioni fantastiche (e standard) che permettono di scrivere codice veloce e testabile.&lt;/p&gt;

&lt;p&gt;E’ vero che si diventa senior principalmente con l’esperienza, ma se dite di aver lavorato per 3+ anni con JS dovete anche mostrare che avete un’&lt;em&gt;esperienza di un certo livello&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Aprite la console del browser e provate gli esempi!&lt;/strong&gt;&lt;/p&gt;

&lt;h3 id=&quot;a-partire-da-un-array-come-filtriamo-solo-gli-elementi-pari-senza-usare-il-ciclo-for&quot;&gt;A partire da un array, come filtriamo solo gli elementi pari senza usare il ciclo for?&lt;/h3&gt;

&lt;div class=&quot;language-javascript highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;arr&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;filtered&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;arr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;filter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;elem&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;elem&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;%&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;filtered&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;filter()&lt;/code&gt; prende in input una funzione di &lt;em&gt;test&lt;/em&gt; che viene eseguita su ogni elemento dell’input: se la funzione restituisce &lt;code class=&quot;highlighter-rouge&quot;&gt;true&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;elem&lt;/code&gt; viene aggiunto all’array in output.&lt;/p&gt;

&lt;h3 id=&quot;come-raddoppiamo-tutti-gli-element-di-un-array-senza-usare-il-ciclo-for&quot;&gt;Come raddoppiamo tutti gli element di un array senza usare il ciclo for?&lt;/h3&gt;

&lt;div class=&quot;language-javascript highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;mapped&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;arr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;elem&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;elem&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;mapped&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Anche qui la funzione &lt;code class=&quot;highlighter-rouge&quot;&gt;map()&lt;/code&gt; prende in input una funzione che viene eseguita su ogni elemento dell’input. Per ogni elemento, questo viene &lt;em&gt;trasformato&lt;/em&gt; in un altro valore in base al risultato della funzione.&lt;/p&gt;

&lt;h3 id=&quot;come-sommiamo-tutti-gli-elementi-di-un-array-senza-usare-il-ciclo-for&quot;&gt;Come sommiamo tutti gli elementi di un array senza usare il ciclo for?&lt;/h3&gt;

&lt;div class=&quot;language-javascript highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;reduced&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;arr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;reduce&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;prev&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;elem&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;prev&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;elem&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;reduced&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;reduce()&lt;/code&gt; è più complessa da spiegare, ma poi sarà facilissima da usare: permette di applicare una funzione &lt;em&gt;N-a-1&lt;/em&gt; dove da un array tiriamo fuori un unico risultato. Nel nostro esempio abbiamo applicato la somma (voi come esercizio potreste provare a tirare fuori la media!).&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;reduce()&lt;/code&gt; prende in input due elementi: una funzione e un elemento di partenza (Sarebbe lo &lt;code class=&quot;highlighter-rouge&quot;&gt;0&lt;/code&gt; specificato in fondo). Per capire cosa accade, facciamo un esempio sull’array &lt;code class=&quot;highlighter-rouge&quot;&gt;[8, 7]&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Alla prima iterazione viene chiamata la funzione con &lt;code class=&quot;highlighter-rouge&quot;&gt;prev = 0&lt;/code&gt; e &lt;code class=&quot;highlighter-rouge&quot;&gt;elem = 8&lt;/code&gt;: siccome stiamo iterando sul primo elemento e non c’è nessun elemento precedente, viene usato il secondo argomento di &lt;code class=&quot;highlighter-rouge&quot;&gt;reduce&lt;/code&gt; come valore di inizio (ricordate quello &lt;code class=&quot;highlighter-rouge&quot;&gt;0&lt;/code&gt; lì in fondo?). A questo punto viene eseguita la somma, che è &lt;code class=&quot;highlighter-rouge&quot;&gt;8&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Alla seconda iterazione, la funzione viene chiamata con &lt;code class=&quot;highlighter-rouge&quot;&gt;prev = 8&lt;/code&gt; (risultato dell’iterazione precedente!) e &lt;code class=&quot;highlighter-rouge&quot;&gt;elem = 7&lt;/code&gt;:  Anche in questo caso verrà eseguita la somma che è &lt;code class=&quot;highlighter-rouge&quot;&gt;15&lt;/code&gt;, che sarà anche l’output di &lt;code class=&quot;highlighter-rouge&quot;&gt;reduce&lt;/code&gt;.&lt;/p&gt;

&lt;h3 id=&quot;domanda-implicita-del-lettore-perchè-tutto-staccanimento-contro-il-ciclo-for&quot;&gt;(Domanda implicita del lettore: Perchè tutto st’accanimento contro il ciclo for?)&lt;/h3&gt;
&lt;p&gt;Il ciclo for è un ottimo costrutto per iterare gli array, tuttavia non fa capire a chi legge cosa sta accadendo, oltre al fatto di non essere manutenibile. e componibile.&lt;/p&gt;

&lt;p&gt;Supponiamo di voler filtrare tutti i numeri pari da un array; successivamente raddoppiarli e poi sommarli (ossia, la composizione delle tre domande precedenti).&lt;/p&gt;

&lt;p&gt;Con le funzioni presentate prima, ecco la soluzione:&lt;/p&gt;

&lt;div class=&quot;language-javascript highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;result&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;arr&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;filter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;elem&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;elem&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;%&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;elem&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;elem&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;reduce&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;prev&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;elem&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;prev&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;elem&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;nx&quot;&gt;console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;result&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;E’ ovvio che si può scrivere anche con un bel (paio di) for. Ma quante righe ci vogliono? e rileggendolo dopo sei mesi, si capisce?&lt;/p&gt;

&lt;p&gt;Per concludere, con la svolta funzionale di altri linguaggi (chi ha detto Java?!) questi concetti sono stati applicati anche altrove, proprio per la loro semplicità e componibilità. Magari hanno altri nomi, ma il funzionamento è lo stesso. Cercateli e …usateli!&lt;/p&gt;
</description>
        
        <content:encoded>
            <![CDATA[
                <!doctype html>
                <html lang="en" prefix="op: http://media.facebook.com/op#">
              <head>
                <meta charset="utf-8">
                <link rel="canonical" href="https://michelenasti.com/2017/04/14/javascript-filter-map-reduce.html">
                <meta property="op:markup_version" content="v1.0">
              </head>
              <body>
                <article>
                  <header>
                      <h1>Diventare Senior™ con Javascript: le funzioni filter, map, reduce</h1>
                      
                      <figure>
                          <img src="https://michelenasti.com/images/michele_nasti.jpg" alt=" Diventare Senior™ con Javascript: le funzioni filter, map, reduce ">
                          <figcaption>Diventare Senior™ con Javascript: le funzioni filter, map, reduce</figcaption>
                      </figure>
                      
                      <time class="op-published" dateTime="2017-04-14 10:09:00 UTC">Fri, 14 Apr 2017 10:09:00 +0000</time>
                      <time class="op-modified" dateTime=""></time>
                  </header>
                  
                    <p>Si può lavorare per anni con javascript senza mai arrivare a conoscere tre funzioni fantastiche (e standard) che permettono di scrivere codice veloce e testabile.</p>

<p>E’ vero che si diventa senior principalmente con l’esperienza, ma se dite di aver lavorato per 3+ anni con JS dovete anche mostrare che avete un’<em>esperienza di un certo livello</em>.</p>

<p><strong>Aprite la console del browser e provate gli esempi!</strong></p>

<h3 id="a-partire-da-un-array-come-filtriamo-solo-gli-elementi-pari-senza-usare-il-ciclo-for">A partire da un array, come filtriamo solo gli elementi pari senza usare il ciclo for?</h3>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">arr</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">];</span>

<span class="kd">let</span> <span class="nx">filtered</span> <span class="o">=</span> <span class="nx">arr</span><span class="p">.</span><span class="nx">filter</span><span class="p">((</span><span class="nx">elem</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">elem</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">===</span> <span class="mi">0</span> <span class="p">});</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">filtered</span><span class="p">);</span>
</code></pre>
</div>

<p><code class="highlighter-rouge">filter()</code> prende in input una funzione di <em>test</em> che viene eseguita su ogni elemento dell’input: se la funzione restituisce <code class="highlighter-rouge">true</code>, <code class="highlighter-rouge">elem</code> viene aggiunto all’array in output.</p>

<h3 id="come-raddoppiamo-tutti-gli-element-di-un-array-senza-usare-il-ciclo-for">Come raddoppiamo tutti gli element di un array senza usare il ciclo for?</h3>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">mapped</span> <span class="o">=</span> <span class="nx">arr</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">elem</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">elem</span> <span class="o">*</span> <span class="mi">2</span> <span class="p">});</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">mapped</span><span class="p">);</span>
</code></pre>
</div>

<p>Anche qui la funzione <code class="highlighter-rouge">map()</code> prende in input una funzione che viene eseguita su ogni elemento dell’input. Per ogni elemento, questo viene <em>trasformato</em> in un altro valore in base al risultato della funzione.</p>

<h3 id="come-sommiamo-tutti-gli-elementi-di-un-array-senza-usare-il-ciclo-for">Come sommiamo tutti gli elementi di un array senza usare il ciclo for?</h3>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">reduced</span> <span class="o">=</span> <span class="nx">arr</span><span class="p">.</span><span class="nx">reduce</span><span class="p">((</span><span class="nx">prev</span><span class="p">,</span> <span class="nx">elem</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">prev</span> <span class="o">+</span> <span class="nx">elem</span> <span class="p">},</span> <span class="mi">0</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">reduced</span><span class="p">);</span>
</code></pre>
</div>

<p><code class="highlighter-rouge">reduce()</code> è più complessa da spiegare, ma poi sarà facilissima da usare: permette di applicare una funzione <em>N-a-1</em> dove da un array tiriamo fuori un unico risultato. Nel nostro esempio abbiamo applicato la somma (voi come esercizio potreste provare a tirare fuori la media!).</p>

<p><code class="highlighter-rouge">reduce()</code> prende in input due elementi: una funzione e un elemento di partenza (Sarebbe lo <code class="highlighter-rouge">0</code> specificato in fondo). Per capire cosa accade, facciamo un esempio sull’array <code class="highlighter-rouge">[8, 7]</code>.</p>

<p>Alla prima iterazione viene chiamata la funzione con <code class="highlighter-rouge">prev = 0</code> e <code class="highlighter-rouge">elem = 8</code>: siccome stiamo iterando sul primo elemento e non c’è nessun elemento precedente, viene usato il secondo argomento di <code class="highlighter-rouge">reduce</code> come valore di inizio (ricordate quello <code class="highlighter-rouge">0</code> lì in fondo?). A questo punto viene eseguita la somma, che è <code class="highlighter-rouge">8</code>.</p>

<p>Alla seconda iterazione, la funzione viene chiamata con <code class="highlighter-rouge">prev = 8</code> (risultato dell’iterazione precedente!) e <code class="highlighter-rouge">elem = 7</code>:  Anche in questo caso verrà eseguita la somma che è <code class="highlighter-rouge">15</code>, che sarà anche l’output di <code class="highlighter-rouge">reduce</code>.</p>

<h3 id="domanda-implicita-del-lettore-perchè-tutto-staccanimento-contro-il-ciclo-for">(Domanda implicita del lettore: Perchè tutto st’accanimento contro il ciclo for?)</h3>
<p>Il ciclo for è un ottimo costrutto per iterare gli array, tuttavia non fa capire a chi legge cosa sta accadendo, oltre al fatto di non essere manutenibile. e componibile.</p>

<p>Supponiamo di voler filtrare tutti i numeri pari da un array; successivamente raddoppiarli e poi sommarli (ossia, la composizione delle tre domande precedenti).</p>

<p>Con le funzioni presentate prima, ecco la soluzione:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">arr</span>
	<span class="p">.</span><span class="nx">filter</span><span class="p">((</span><span class="nx">elem</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">elem</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span>
	<span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">elem</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">elem</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
	<span class="p">.</span><span class="nx">reduce</span><span class="p">((</span><span class="nx">prev</span><span class="p">,</span> <span class="nx">elem</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">prev</span> <span class="o">+</span> <span class="nx">elem</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>
</code></pre>
</div>

<p>E’ ovvio che si può scrivere anche con un bel (paio di) for. Ma quante righe ci vogliono? e rileggendolo dopo sei mesi, si capisce?</p>

<p>Per concludere, con la svolta funzionale di altri linguaggi (chi ha detto Java?!) questi concetti sono stati applicati anche altrove, proprio per la loro semplicità e componibilità. Magari hanno altri nomi, ma il funzionamento è lo stesso. Cercateli e …usateli!</p>

                  
                    <footer>
                        <aside>Written by Amit Seal Ami, a Lecturer from Institute of Information Technology, University of Dhaka.</aside>
                        <small>Copyright - Amit Seal Ami</small>
                  </footer>
                </article>
              </body>
            </html>
        ]]>
        </content:encoded>

      </item>
    
      <item>
        <title>All my articles about Testing in Javascript in one post</title>
        <link>https://michelenasti.com/2017/04/08/all-my-articles-about-testing-in-javascript-in-one-post.html</link>
        <guid isPermaLink="true">https://michelenasti.com/2017/04/08/all-my-articles-about-testing-in-javascript-in-one-post.html</guid>
        <pubDate>Sat, 08 Apr 2017 13:23:03 +0000</pubDate>
        <author></author>
        
          <description>&lt;p&gt;Hey there,&lt;/p&gt;

&lt;p&gt;in the last month I have done a great work to understand how testing in javascript could be done in a effective, elegant way.&lt;/p&gt;

&lt;p&gt;Here are all my articles about it:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://michelenasti.com/2017/03/23/node-js-testing-easy-with-mocha.html&quot;&gt;Easy testing of NodeJS applications with Mocha&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://michelenasti.com/2017/03/27/become-a-test-expert-in-nodejs-with-these-tricks.html&quot;&gt;Become a test expert in NodeJS with these tricks&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://michelenasti.com/2017/04/07/fantastic-unit-tests-in-javascript-with-mocks.html&quot;&gt;Fantastic Unit Tests in Javascript with Mocks&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Enjoy!&lt;/p&gt;
</description>
        
        <content:encoded>
            <![CDATA[
                <!doctype html>
                <html lang="en" prefix="op: http://media.facebook.com/op#">
              <head>
                <meta charset="utf-8">
                <link rel="canonical" href="https://michelenasti.com/2017/04/08/all-my-articles-about-testing-in-javascript-in-one-post.html">
                <meta property="op:markup_version" content="v1.0">
              </head>
              <body>
                <article>
                  <header>
                      <h1>All my articles about Testing in Javascript in one post</h1>
                      
                      <figure>
                          <img src="https://michelenasti.com/images/michele_nasti.jpg" alt=" All my articles about Testing in Javascript in one post ">
                          <figcaption>All my articles about Testing in Javascript in one post</figcaption>
                      </figure>
                      
                      <time class="op-published" dateTime="2017-04-08 13:23:03 UTC">Sat, 08 Apr 2017 13:23:03 +0000</time>
                      <time class="op-modified" dateTime=""></time>
                  </header>
                  
                    <p>Hey there,</p>

<p>in the last month I have done a great work to understand how testing in javascript could be done in a effective, elegant way.</p>

<p>Here are all my articles about it:</p>
<ul>
  <li><a href="https://michelenasti.com/2017/03/23/node-js-testing-easy-with-mocha.html">Easy testing of NodeJS applications with Mocha</a></li>
  <li><a href="https://michelenasti.com/2017/03/27/become-a-test-expert-in-nodejs-with-these-tricks.html">Become a test expert in NodeJS with these tricks</a></li>
  <li><a href="https://michelenasti.com/2017/04/07/fantastic-unit-tests-in-javascript-with-mocks.html">Fantastic Unit Tests in Javascript with Mocks</a></li>
</ul>

<p>Enjoy!</p>

                  
                    <footer>
                        <aside>Written by Amit Seal Ami, a Lecturer from Institute of Information Technology, University of Dhaka.</aside>
                        <small>Copyright - Amit Seal Ami</small>
                  </footer>
                </article>
              </body>
            </html>
        ]]>
        </content:encoded>

      </item>
    
      <item>
        <title>Fantastic Unit Tests in Javascript with Mocks</title>
        <link>https://michelenasti.com/2017/04/07/fantastic-unit-tests-in-javascript-with-mocks.html</link>
        <guid isPermaLink="true">https://michelenasti.com/2017/04/07/fantastic-unit-tests-in-javascript-with-mocks.html</guid>
        <pubDate>Fri, 07 Apr 2017 09:49:00 +0000</pubDate>
        <author></author>
        
          <description>&lt;p&gt;Let’s start with the example. We have two files, one that is the main one called &lt;code class=&quot;highlighter-rouge&quot;&gt;app.js&lt;/code&gt; that exports just one method, called &lt;code class=&quot;highlighter-rouge&quot;&gt;handleSignup()&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;// file app.js
const db = require('./db.js');

module.exports.handleSignup = (email, password) =&amp;gt; {
  // ...
  // save the user to the database
  db.saveUser({ email, password });
  // ...
};
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;This &lt;code class=&quot;highlighter-rouge&quot;&gt;app.js&lt;/code&gt;, at some point, calls the &lt;code class=&quot;highlighter-rouge&quot;&gt;db.saveUser()&lt;/code&gt; function. Let’s see the &lt;code class=&quot;highlighter-rouge&quot;&gt;db&lt;/code&gt; module:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;// file db.js
module.exports.saveUser = user =&amp;gt; {
  console.log('Saving the user...', user);
};
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Nothing very special, it’s just a demo. Let’s go with the important question.&lt;/p&gt;

&lt;h2 id=&quot;how-do-we-unit-test-appjs&quot;&gt;How do we unit-test app.js?&lt;/h2&gt;

&lt;p&gt;For those not used to &lt;strong&gt;unit testing&lt;/strong&gt;, it &lt;strong&gt;is a way of testing classes atomically&lt;/strong&gt;. This means that app.js may depend on other classes, but we will not test these.&lt;/p&gt;

&lt;p&gt;Let me be more specific. the &lt;code class=&quot;highlighter-rouge&quot;&gt;db&lt;/code&gt; module could be really calling a database, this means that if the database connection is not working, the test would fail. OR, if the test is &lt;em&gt;really&lt;/em&gt; saving a user, next time we launch the test it could be failing because the user is already in the db.&lt;/p&gt;

&lt;p&gt;To handle all these scenarios, we will &lt;strong&gt;mock&lt;/strong&gt; the &lt;code class=&quot;highlighter-rouge&quot;&gt;db&lt;/code&gt; module. We will provide a fake implementation of &lt;code class=&quot;highlighter-rouge&quot;&gt;db&lt;/code&gt; that will reply as we will, every time. This way, &lt;em&gt;we will be testing only app.js code&lt;/em&gt;.&lt;/p&gt;

&lt;h2 id=&quot;but-what-if-db-module-has-a-bug&quot;&gt;But… what if db module has a bug?&lt;/h2&gt;

&lt;p&gt;You &lt;strong&gt;MUST&lt;/strong&gt; test the &lt;code class=&quot;highlighter-rouge&quot;&gt;db&lt;/code&gt; module, too! However, it’s not a good practice to test the &lt;code class=&quot;highlighter-rouge&quot;&gt;db&lt;/code&gt; module by testing the &lt;code class=&quot;highlighter-rouge&quot;&gt;app&lt;/code&gt; module.&lt;/p&gt;

&lt;p&gt;If you don’t test the &lt;code class=&quot;highlighter-rouge&quot;&gt;db&lt;/code&gt; module, and all of a sudden your test has a bug, how can you say where the bug is? Imagine this in a layer of 10-15 modules… you get the complexity.&lt;/p&gt;

&lt;p&gt;However, let me point out that &lt;strong&gt;unit testing alone is not the solution to all of your problems&lt;/strong&gt;. Unit testing can test that a single class will perform as specified, but another kind of testing (I call it “integration testing”) should be responsible to check that everything is wired correctly.&lt;/p&gt;

&lt;p&gt;Here is a famous gif about this concept:&lt;img src=&quot;/images/unit-testing-1.gif&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;1-before-showing-the-code-let-me-introduce-to-you-rewire&quot;&gt;1. Before showing the code, let me introduce to you: rewire()&lt;/h2&gt;

&lt;p&gt;To test &lt;code class=&quot;highlighter-rouge&quot;&gt;app.js&lt;/code&gt; we need &lt;a href=&quot;https://www.npmjs.com/package/rewire&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;rewire&lt;/code&gt;&lt;/a&gt;, a nodejs module.&lt;/p&gt;

&lt;p&gt;To install:&lt;/p&gt;

&lt;div class=&quot;language-console highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;w&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;npm&lt;/span&gt;&lt;span class=&quot;kv&quot;&gt; i --save-dev rewire 
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;rewire()&lt;/code&gt; works like the &lt;code class=&quot;highlighter-rouge&quot;&gt;require()&lt;/code&gt; function, this mean that you &lt;em&gt;could&lt;/em&gt; use rewire for your applications, even if it does not make any sense. It is indeed very useful in tests.&lt;/p&gt;

&lt;p&gt;When you &lt;code class=&quot;highlighter-rouge&quot;&gt;rewire&lt;/code&gt; a module, the module is imported &lt;em&gt;but&lt;/em&gt; some new methods are added: these are &lt;code class=&quot;highlighter-rouge&quot;&gt;__get__()&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;__set__()&lt;/code&gt;. Whith these two methods you can retrive any local variable instantiated locally.&lt;/p&gt;

&lt;p&gt;Example:&lt;/p&gt;

&lt;div class=&quot;language-javascript highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kr&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;rewire&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'rewire'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; 

&lt;span class=&quot;kr&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;app&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;rewire&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'app'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;//like require but...&lt;/span&gt;

&lt;span class=&quot;kr&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;db&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;__get__&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'db'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// will return the db object! &lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h3 id=&quot;rewire-has-a-problem-with-const&quot;&gt;Rewire has a problem with const&lt;/h3&gt;

&lt;p&gt;You might be tempted to do this:&lt;/p&gt;

&lt;div class=&quot;language-javascript highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;kr&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;app&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;rewire&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'app'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;kr&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;db&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; 
  &lt;span class=&quot;na&quot;&gt;saveUser&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{...}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;nx&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;__set__&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'db'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;db&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;//this will not work in this case!&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Since &lt;code class=&quot;highlighter-rouge&quot;&gt;db&lt;/code&gt; is declared as a &lt;code class=&quot;highlighter-rouge&quot;&gt;const&lt;/code&gt; in &lt;code class=&quot;highlighter-rouge&quot;&gt;app&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;rewire&lt;/code&gt; cannot do the magic: &lt;code class=&quot;highlighter-rouge&quot;&gt;const&lt;/code&gt; variables in javascript are not reassignable.&lt;/p&gt;

&lt;p&gt;However, even if the &lt;code class=&quot;highlighter-rouge&quot;&gt;db&lt;/code&gt; object is not reassignable, we can still modify its internals, as long they are declared as &lt;code class=&quot;highlighter-rouge&quot;&gt;let&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;var&lt;/code&gt;. That’s &lt;strong&gt;why we will mock single functions and not the whole object&lt;/strong&gt;.&lt;/p&gt;

&lt;h2 id=&quot;2-before-showing-the-code-let-me-introduce-to-you-expectcreatespy&quot;&gt;2. Before showing the code, let me introduce to you: expect.createSpy()&lt;/h2&gt;

&lt;p&gt;I have already talked about the &lt;a href=&quot;https://michelenasti.com/2017/03/27/become-a-test-expert-in-nodejs-with-these-tricks.html&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;expect&lt;/code&gt;&lt;/a&gt; assertion library.&lt;/p&gt;

&lt;p&gt;The good thing is, &lt;strong&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;expect&lt;/code&gt; has also a way to create mocks - that they call spies&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;What is a &lt;em&gt;spy&lt;/em&gt;? it’s a function that can substitute the real implementation. It can be “trained” to return the value you want, to simulate errors, throw exceptions, etc.&lt;/p&gt;

&lt;p&gt;With spies, you can also check that the function has been called, with the right parameters.&lt;/p&gt;

&lt;h2 id=&quot;tldr---here-is-the-code&quot;&gt;TL;DR - Here is the CODE&lt;/h2&gt;

&lt;div class=&quot;language-javascript highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;//file app.test.js &lt;/span&gt;
&lt;span class=&quot;kr&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;expect&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'expect'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;kr&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;rewire&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'rewire'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;app&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;rewire&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'./app'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// (1) &lt;/span&gt;

&lt;span class=&quot;nx&quot;&gt;describe&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'App'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;c1&quot;&gt;//mock&lt;/span&gt;
  &lt;span class=&quot;kd&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;db&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;__get__&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'db'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;       &lt;span class=&quot;c1&quot;&gt;// (2) &lt;/span&gt;
  &lt;span class=&quot;nx&quot;&gt;db&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;saveUser&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;expect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;createSpy&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// (3) &lt;/span&gt;
 
  &lt;span class=&quot;nx&quot;&gt;it&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'should call saveUser with user object'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;email&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'michele@example.com'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;password&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'123abc'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;nx&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;handleSignup&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;email&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;password&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;c1&quot;&gt;// (4) &lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;expect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;db&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;saveUser&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;toHaveBeenCalledWith&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;({&lt;/span&gt; 
      &lt;span class=&quot;nx&quot;&gt;email&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;nx&quot;&gt;password&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;   
  &lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;You should find familiar what happens at (1): we are importing the app module with &lt;code class=&quot;highlighter-rouge&quot;&gt;rewire&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;then, we are (2) using the &lt;code class=&quot;highlighter-rouge&quot;&gt;__get__()&lt;/code&gt; function to retrieve the &lt;code class=&quot;highlighter-rouge&quot;&gt;db&lt;/code&gt; object from the module. At (3) we are replacing the function &lt;code class=&quot;highlighter-rouge&quot;&gt;saveUser()&lt;/code&gt; with a spy, created by us.&lt;/p&gt;

&lt;p&gt;The test is created as always; we prepare some input parameters and pass them to &lt;code class=&quot;highlighter-rouge&quot;&gt;app.handleSignup()&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;At (4) we can check that the spy has been called for real with the function &lt;code class=&quot;highlighter-rouge&quot;&gt;toHaveBeenCalledWith&lt;/code&gt; and we can check also that the parameters are the same!&lt;/p&gt;

&lt;h2 id=&quot;theres-more&quot;&gt;There’s more…&lt;/h2&gt;
&lt;p&gt;But that’s enough for now! Testing is something I really like, because it can tell you instantly if you’re doing something wrong. The overall quality of a project is greatly improved when you test and know how to test.&lt;/p&gt;
</description>
        
        <content:encoded>
            <![CDATA[
                <!doctype html>
                <html lang="en" prefix="op: http://media.facebook.com/op#">
              <head>
                <meta charset="utf-8">
                <link rel="canonical" href="https://michelenasti.com/2017/04/07/fantastic-unit-tests-in-javascript-with-mocks.html">
                <meta property="op:markup_version" content="v1.0">
              </head>
              <body>
                <article>
                  <header>
                      <h1>Fantastic Unit Tests in Javascript with Mocks</h1>
                      
                      <figure>
                          <img src="https://michelenasti.com/images/michele_nasti.jpg" alt=" Fantastic Unit Tests in Javascript with Mocks ">
                          <figcaption>Fantastic Unit Tests in Javascript with Mocks</figcaption>
                      </figure>
                      
                      <time class="op-published" dateTime="2017-04-07 09:49:00 UTC">Fri, 07 Apr 2017 09:49:00 +0000</time>
                      <time class="op-modified" dateTime=""></time>
                  </header>
                  
                    <p>Let’s start with the example. We have two files, one that is the main one called <code class="highlighter-rouge">app.js</code> that exports just one method, called <code class="highlighter-rouge">handleSignup()</code>:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>// file app.js
const db = require('./db.js');

module.exports.handleSignup = (email, password) =&gt; {
  // ...
  // save the user to the database
  db.saveUser({ email, password });
  // ...
};
</code></pre>
</div>

<p>This <code class="highlighter-rouge">app.js</code>, at some point, calls the <code class="highlighter-rouge">db.saveUser()</code> function. Let’s see the <code class="highlighter-rouge">db</code> module:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>// file db.js
module.exports.saveUser = user =&gt; {
  console.log('Saving the user...', user);
};
</code></pre>
</div>

<p>Nothing very special, it’s just a demo. Let’s go with the important question.</p>

<h2 id="how-do-we-unit-test-appjs">How do we unit-test app.js?</h2>

<p>For those not used to <strong>unit testing</strong>, it <strong>is a way of testing classes atomically</strong>. This means that app.js may depend on other classes, but we will not test these.</p>

<p>Let me be more specific. the <code class="highlighter-rouge">db</code> module could be really calling a database, this means that if the database connection is not working, the test would fail. OR, if the test is <em>really</em> saving a user, next time we launch the test it could be failing because the user is already in the db.</p>

<p>To handle all these scenarios, we will <strong>mock</strong> the <code class="highlighter-rouge">db</code> module. We will provide a fake implementation of <code class="highlighter-rouge">db</code> that will reply as we will, every time. This way, <em>we will be testing only app.js code</em>.</p>

<h2 id="but-what-if-db-module-has-a-bug">But… what if db module has a bug?</h2>

<p>You <strong>MUST</strong> test the <code class="highlighter-rouge">db</code> module, too! However, it’s not a good practice to test the <code class="highlighter-rouge">db</code> module by testing the <code class="highlighter-rouge">app</code> module.</p>

<p>If you don’t test the <code class="highlighter-rouge">db</code> module, and all of a sudden your test has a bug, how can you say where the bug is? Imagine this in a layer of 10-15 modules… you get the complexity.</p>

<p>However, let me point out that <strong>unit testing alone is not the solution to all of your problems</strong>. Unit testing can test that a single class will perform as specified, but another kind of testing (I call it “integration testing”) should be responsible to check that everything is wired correctly.</p>

<p>Here is a famous gif about this concept:<img src="/images/unit-testing-1.gif" alt="" /></p>

<h2 id="1-before-showing-the-code-let-me-introduce-to-you-rewire">1. Before showing the code, let me introduce to you: rewire()</h2>

<p>To test <code class="highlighter-rouge">app.js</code> we need <a href="https://www.npmjs.com/package/rewire"><code class="highlighter-rouge">rewire</code></a>, a nodejs module.</p>

<p>To install:</p>

<div class="language-console highlighter-rouge"><pre class="highlight"><code><span class="w">$ </span><span class="nc">npm</span><span class="kv"> i --save-dev rewire 
</span></code></pre>
</div>

<p><code class="highlighter-rouge">rewire()</code> works like the <code class="highlighter-rouge">require()</code> function, this mean that you <em>could</em> use rewire for your applications, even if it does not make any sense. It is indeed very useful in tests.</p>

<p>When you <code class="highlighter-rouge">rewire</code> a module, the module is imported <em>but</em> some new methods are added: these are <code class="highlighter-rouge">__get__()</code> and <code class="highlighter-rouge">__set__()</code>. Whith these two methods you can retrive any local variable instantiated locally.</p>

<p>Example:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kr">const</span> <span class="nx">rewire</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'rewire'</span><span class="p">);</span> 

<span class="kr">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">rewire</span><span class="p">(</span><span class="s1">'app'</span><span class="p">);</span> <span class="c1">//like require but...</span>

<span class="kr">const</span> <span class="nx">db</span> <span class="o">=</span> <span class="nx">app</span><span class="p">.</span><span class="nx">__get__</span><span class="p">(</span><span class="s1">'db'</span><span class="p">);</span> <span class="c1">// will return the db object! </span>
</code></pre>
</div>

<h3 id="rewire-has-a-problem-with-const">Rewire has a problem with const</h3>

<p>You might be tempted to do this:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="p">...</span>
<span class="kr">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">rewire</span><span class="p">(</span><span class="s1">'app'</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">db</span> <span class="o">=</span> <span class="p">{</span> 
  <span class="na">saveUser</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{...}</span>
<span class="p">}</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">__set__</span><span class="p">(</span><span class="s1">'db'</span><span class="p">,</span> <span class="nx">db</span><span class="p">);</span> <span class="c1">//this will not work in this case!</span>
</code></pre>
</div>

<p>Since <code class="highlighter-rouge">db</code> is declared as a <code class="highlighter-rouge">const</code> in <code class="highlighter-rouge">app</code>, <code class="highlighter-rouge">rewire</code> cannot do the magic: <code class="highlighter-rouge">const</code> variables in javascript are not reassignable.</p>

<p>However, even if the <code class="highlighter-rouge">db</code> object is not reassignable, we can still modify its internals, as long they are declared as <code class="highlighter-rouge">let</code> and <code class="highlighter-rouge">var</code>. That’s <strong>why we will mock single functions and not the whole object</strong>.</p>

<h2 id="2-before-showing-the-code-let-me-introduce-to-you-expectcreatespy">2. Before showing the code, let me introduce to you: expect.createSpy()</h2>

<p>I have already talked about the <a href="https://michelenasti.com/2017/03/27/become-a-test-expert-in-nodejs-with-these-tricks.html"><code class="highlighter-rouge">expect</code></a> assertion library.</p>

<p>The good thing is, <strong><code class="highlighter-rouge">expect</code> has also a way to create mocks - that they call spies</strong>.</p>

<p>What is a <em>spy</em>? it’s a function that can substitute the real implementation. It can be “trained” to return the value you want, to simulate errors, throw exceptions, etc.</p>

<p>With spies, you can also check that the function has been called, with the right parameters.</p>

<h2 id="tldr---here-is-the-code">TL;DR - Here is the CODE</h2>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="c1">//file app.test.js </span>
<span class="kr">const</span> <span class="nx">expect</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'expect'</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">rewire</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'rewire'</span><span class="p">);</span>

<span class="kd">let</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">rewire</span><span class="p">(</span><span class="s1">'./app'</span><span class="p">);</span> <span class="c1">// (1) </span>

<span class="nx">describe</span><span class="p">(</span><span class="s1">'App'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">//mock</span>
  <span class="kd">let</span> <span class="nx">db</span> <span class="o">=</span> <span class="nx">app</span><span class="p">.</span><span class="nx">__get__</span><span class="p">(</span><span class="s1">'db'</span><span class="p">);</span>       <span class="c1">// (2) </span>
  <span class="nx">db</span><span class="p">.</span><span class="nx">saveUser</span> <span class="o">=</span> <span class="nx">expect</span><span class="p">.</span><span class="nx">createSpy</span><span class="p">();</span> <span class="c1">// (3) </span>
 
  <span class="nx">it</span><span class="p">(</span><span class="s1">'should call saveUser with user object'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">email</span> <span class="o">=</span> <span class="s1">'michele@example.com'</span><span class="p">;</span>
    <span class="kd">let</span> <span class="nx">password</span> <span class="o">=</span> <span class="s1">'123abc'</span><span class="p">;</span>

    <span class="nx">app</span><span class="p">.</span><span class="nx">handleSignup</span><span class="p">(</span><span class="nx">email</span><span class="p">,</span> <span class="nx">password</span><span class="p">);</span>

    <span class="c1">// (4) </span>
    <span class="nx">expect</span><span class="p">(</span><span class="nx">db</span><span class="p">.</span><span class="nx">saveUser</span><span class="p">).</span><span class="nx">toHaveBeenCalledWith</span><span class="p">({</span> 
      <span class="nx">email</span><span class="p">,</span>
      <span class="nx">password</span>
    <span class="p">});</span>   
  <span class="p">});</span>
<span class="p">});</span>

</code></pre>
</div>

<p>You should find familiar what happens at (1): we are importing the app module with <code class="highlighter-rouge">rewire</code>.</p>

<p>then, we are (2) using the <code class="highlighter-rouge">__get__()</code> function to retrieve the <code class="highlighter-rouge">db</code> object from the module. At (3) we are replacing the function <code class="highlighter-rouge">saveUser()</code> with a spy, created by us.</p>

<p>The test is created as always; we prepare some input parameters and pass them to <code class="highlighter-rouge">app.handleSignup()</code>.</p>

<p>At (4) we can check that the spy has been called for real with the function <code class="highlighter-rouge">toHaveBeenCalledWith</code> and we can check also that the parameters are the same!</p>

<h2 id="theres-more">There’s more…</h2>
<p>But that’s enough for now! Testing is something I really like, because it can tell you instantly if you’re doing something wrong. The overall quality of a project is greatly improved when you test and know how to test.</p>

                  
                    <footer>
                        <aside>Written by Amit Seal Ami, a Lecturer from Institute of Information Technology, University of Dhaka.</aside>
                        <small>Copyright - Amit Seal Ami</small>
                  </footer>
                </article>
              </body>
            </html>
        ]]>
        </content:encoded>

      </item>
    
      <item>
        <title>Become a test expert in NodeJS with these tricks</title>
        <link>https://michelenasti.com/2017/03/27/become-a-test-expert-in-nodejs-with-these-tricks.html</link>
        <guid isPermaLink="true">https://michelenasti.com/2017/03/27/become-a-test-expert-in-nodejs-with-these-tricks.html</guid>
        <pubDate>Mon, 27 Mar 2017 10:55:00 +0000</pubDate>
        <author></author>
        
          <description>&lt;p&gt;After reading my first guide to 
&lt;a href=&quot;https://michelenasti.com/2017/03/23/node-js-testing-easy-with-mocha.html&quot;&gt;testing NodeJS with Mocha&lt;/a&gt; you might have grasped the fundamental concepts of NodeJS testing. However, &lt;strong&gt;real word code is usually tested with some other expedients&lt;/strong&gt; that you might know to be a better tester (and coder).&lt;/p&gt;

&lt;h2 id=&quot;using-an-assertion-library&quot;&gt;Using an assertion library&lt;/h2&gt;

&lt;p&gt;In my previous article I wrote how to check the test result: to set a test as failing, you throw a &lt;code class=&quot;highlighter-rouge&quot;&gt;new Error()&lt;/code&gt; object with the message to show.&lt;/p&gt;

&lt;p&gt;This is the naive approach; the default is to use an assertion library. These libraries will expose an API that is clearer and simpler to manage, and will let you test more conditions with less code. Under the hood, they will launch the &lt;code class=&quot;highlighter-rouge&quot;&gt;new Error()&lt;/code&gt; if the conditions are not respected.&lt;/p&gt;

&lt;p&gt;Let’s see one of these libraries. One of the most famous libraries is called 
&lt;a href=&quot;https://github.com/mjackson/expect&quot;&gt;&lt;code&gt;expect&lt;/code&gt;&lt;/a&gt;:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;When you use expect, you write assertions similarly to how you would say them, e.g. &quot;I expect this value to be equal to 3&quot; or &quot;I expect this array to contain 3&quot;. When you write assertions in this way, you don't need to remember the order of actual and expected arguments to functions like assert.equal, which helps you write better tests.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Let’s see an example. Here is the test for a &lt;code class=&quot;highlighter-rouge&quot;&gt;add&lt;/code&gt; function, and the test is contained in file &lt;code class=&quot;highlighter-rouge&quot;&gt;utils.test.js&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;//utils.test.js
const expect = require('expect');

const utils = require('./utils');

it('should add two numbers', () =&amp;gt; {
  let res = utils.add(33, 11);

  expect(res).toBe(44).toBeA('number');
});
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Easier to write, and to reason about. with &lt;code class=&quot;highlighter-rouge&quot;&gt;expect&lt;/code&gt; you can also check if objects have properties, etc. Have a look on their website to see all aviable methods.&lt;/p&gt;

&lt;h2 id=&quot;testing-async-code&quot;&gt;Testing async code&lt;/h2&gt;

&lt;p&gt;If you’re using NodeJS, or Javascript, you’re also probably using async functions. No matter if it’s in the form of promises or callbacks, stuff in JS happens async, and we must deal with it.&lt;/p&gt;

&lt;p&gt;Let’s prepare an example async function:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;//utils.js
module.exports.asyncAdd = (a,b, callback) =&amp;gt; {
  setTimeout(() =&amp;gt; {
    callback(a+b);
  }, 1000);
}

&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;How do we test it? The first approach we might think would be to write the test like before:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;//utils.test.js
it('should add two numbers', () =&amp;gt; {
  let res = utils.asyncAdd(33, 11, (res) =&amp;gt; {
  
    // will this work? 
    expect(res).toBe(44).toBeA('number'); 
  });
});

&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;If you launch this example, &lt;em&gt;the test will pass, but for the &lt;strong&gt;wrong reason&lt;/strong&gt;&lt;/em&gt;. Infact, Mocha will not wait the result callback an will end the test instantly. Try to break the test or the function… Mocha will say that everything is ok. That’s not good.&lt;/p&gt;

&lt;p&gt;How can we fix this? Mocha has a super-simple solution, just add a &lt;code class=&quot;highlighter-rouge&quot;&gt;done&lt;/code&gt; argument to the test callback. When &lt;code class=&quot;highlighter-rouge&quot;&gt;done&lt;/code&gt; is present, Mocha will not end the test before you call the &lt;code class=&quot;highlighter-rouge&quot;&gt;done()&lt;/code&gt; function. Let’s try:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;//utils.test.js
it('should add two numbers', (done) =&amp;gt; {
  let res = utils.asyncAdd(33, 11, (res) =&amp;gt; {
  
    expect(res).toBe(44).toBeA('number'); 
    done();
  });
});

&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Now, if you try to break the test or the function, you’ll see that Mocha will fail. Exactely what we want.&lt;/p&gt;

&lt;h2 id=&quot;testing-an-express-application&quot;&gt;Testing an Express application&lt;/h2&gt;

&lt;p&gt;It’s very difficult for the random developer to write a NodeJS app without using &lt;a href=&quot;https://expressjs.com/it/&quot;&gt;Express&lt;/a&gt;, a framework for web applicatons that allows you to write REST endpoints easily.&lt;/p&gt;

&lt;p&gt;How do I test an express application?&lt;/p&gt;

&lt;p&gt;the creators of Express have come in help by creating another library called &lt;a href=&quot;https://github.com/visionmedia/supertest&quot;&gt;supertest&lt;/a&gt;:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt; HTTP assertions made easy via superagent.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Let’s write a simple http application with Express:&lt;/p&gt;

&lt;div class=&quot;language-javascript highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;//file server.js&lt;/span&gt;
&lt;span class=&quot;kr&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;express&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'express'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;kr&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;app&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;express&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;

&lt;span class=&quot;nx&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'/'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;req&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;res&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;nx&quot;&gt;res&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;status&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;404&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;send&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;({&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'Page not found'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'hello baby'&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;

&lt;span class=&quot;nx&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;listen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;3000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;module&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;exports&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;app&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// (1)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;This simple express app will return a &lt;code class=&quot;highlighter-rouge&quot;&gt;404&lt;/code&gt; error with a json payload, everytime you navigate to &lt;code class=&quot;highlighter-rouge&quot;&gt;http://localhost:3000/&lt;/code&gt;. Why? Because there’s nothing to see, obviously! :p&lt;/p&gt;

&lt;p&gt;The only point worth of noting is that we simply export the app, as every other node module. Adding this line at (1) does not break anything, and makes testing possible.&lt;/p&gt;

&lt;p&gt;To test this app, let’s write the test using &lt;em&gt;supertest&lt;/em&gt;:&lt;/p&gt;

&lt;div class=&quot;language-javascript highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;//server.test.js&lt;/span&gt;

&lt;span class=&quot;kr&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;request&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'supertest'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;kr&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;expect&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'expect'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;kr&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;app&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'./server'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;nx&quot;&gt;it&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'should return hello world response'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;done&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;nx&quot;&gt;request&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;          &lt;span class=&quot;c1&quot;&gt;// (1)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'/'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;           &lt;span class=&quot;c1&quot;&gt;// (2)&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;//supertest expect!!&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;expect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;404&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;        &lt;span class=&quot;c1&quot;&gt;// (3)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;expect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;res&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;  &lt;span class=&quot;c1&quot;&gt;// (4)&lt;/span&gt;
      &lt;span class=&quot;c1&quot;&gt;//expect library! &lt;/span&gt;
      &lt;span class=&quot;nx&quot;&gt;expect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;res&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;body&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;toInclude&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;({&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'Page not found'&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;})&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;})&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;end&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;done&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;         &lt;span class=&quot;c1&quot;&gt;// (5)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;That’s interesting. At (1) we are importing the express app and using &lt;code class=&quot;highlighter-rouge&quot;&gt;supertest&lt;/code&gt; to wrap it. Then we perform a &lt;code class=&quot;highlighter-rouge&quot;&gt;get&lt;/code&gt; request over &lt;code class=&quot;highlighter-rouge&quot;&gt;/&lt;/code&gt; (2) and start expecting things about the result. Unfortunately, supertest has another &lt;code class=&quot;highlighter-rouge&quot;&gt;expect&lt;/code&gt; method that is not related to the one in the &lt;code class=&quot;highlighter-rouge&quot;&gt;expect&lt;/code&gt; library.&lt;/p&gt;

&lt;p&gt;By the way, with supertest we can make assumptions about the status code (3), and if we want to assert something about the body of the request, we can do like in (4): when using a callback we can do everything over the &lt;code class=&quot;highlighter-rouge&quot;&gt;res&lt;/code&gt; variable, and infact we are using the &lt;code class=&quot;highlighter-rouge&quot;&gt;expect&lt;/code&gt; library to see if the body includes the &lt;code class=&quot;highlighter-rouge&quot;&gt;error&lt;/code&gt; property.&lt;/p&gt;

&lt;p&gt;Since this Mocha test is async, we need a way to tell mocha that the test has ended. In (5) we see that supertest is already aware of mocha and will stop the test by passing the &lt;code class=&quot;highlighter-rouge&quot;&gt;done&lt;/code&gt; function to &lt;code class=&quot;highlighter-rouge&quot;&gt;end()&lt;/code&gt;.&lt;/p&gt;

&lt;h2 id=&quot;conclusions&quot;&gt;Conclusions&lt;/h2&gt;

&lt;p&gt;For a novice, the problem of testing Node apps is that there are many libraries the same thing. For an expert, this becomes an advantage: you can choose the best for your purposes (but you must know them in advance).&lt;/p&gt;

&lt;p&gt;By the way, testing is important. Test everything is testable. Otherwise, maintaining javascript code can only be a mess.&lt;/p&gt;
</description>
        
        <content:encoded>
            <![CDATA[
                <!doctype html>
                <html lang="en" prefix="op: http://media.facebook.com/op#">
              <head>
                <meta charset="utf-8">
                <link rel="canonical" href="https://michelenasti.com/2017/03/27/become-a-test-expert-in-nodejs-with-these-tricks.html">
                <meta property="op:markup_version" content="v1.0">
              </head>
              <body>
                <article>
                  <header>
                      <h1>Become a test expert in NodeJS with these tricks</h1>
                      
                      <figure>
                          <img src="https://michelenasti.com/images/michele_nasti.jpg" alt=" Become a test expert in NodeJS with these tricks ">
                          <figcaption>Become a test expert in NodeJS with these tricks</figcaption>
                      </figure>
                      
                      <time class="op-published" dateTime="2017-03-27 10:55:00 UTC">Mon, 27 Mar 2017 10:55:00 +0000</time>
                      <time class="op-modified" dateTime=""></time>
                  </header>
                  
                    <p>After reading my first guide to 
<a href="https://michelenasti.com/2017/03/23/node-js-testing-easy-with-mocha.html">testing NodeJS with Mocha</a> you might have grasped the fundamental concepts of NodeJS testing. However, <strong>real word code is usually tested with some other expedients</strong> that you might know to be a better tester (and coder).</p>

<h2 id="using-an-assertion-library">Using an assertion library</h2>

<p>In my previous article I wrote how to check the test result: to set a test as failing, you throw a <code class="highlighter-rouge">new Error()</code> object with the message to show.</p>

<p>This is the naive approach; the default is to use an assertion library. These libraries will expose an API that is clearer and simpler to manage, and will let you test more conditions with less code. Under the hood, they will launch the <code class="highlighter-rouge">new Error()</code> if the conditions are not respected.</p>

<p>Let’s see one of these libraries. One of the most famous libraries is called 
<a href="https://github.com/mjackson/expect"><code>expect</code></a>:</p>
<blockquote>
<p>When you use expect, you write assertions similarly to how you would say them, e.g. "I expect this value to be equal to 3" or "I expect this array to contain 3". When you write assertions in this way, you don't need to remember the order of actual and expected arguments to functions like assert.equal, which helps you write better tests.</p>
</blockquote>

<p>Let’s see an example. Here is the test for a <code class="highlighter-rouge">add</code> function, and the test is contained in file <code class="highlighter-rouge">utils.test.js</code>:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>//utils.test.js
const expect = require('expect');

const utils = require('./utils');

it('should add two numbers', () =&gt; {
  let res = utils.add(33, 11);

  expect(res).toBe(44).toBeA('number');
});
</code></pre>
</div>

<p>Easier to write, and to reason about. with <code class="highlighter-rouge">expect</code> you can also check if objects have properties, etc. Have a look on their website to see all aviable methods.</p>

<h2 id="testing-async-code">Testing async code</h2>

<p>If you’re using NodeJS, or Javascript, you’re also probably using async functions. No matter if it’s in the form of promises or callbacks, stuff in JS happens async, and we must deal with it.</p>

<p>Let’s prepare an example async function:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>//utils.js
module.exports.asyncAdd = (a,b, callback) =&gt; {
  setTimeout(() =&gt; {
    callback(a+b);
  }, 1000);
}

</code></pre>
</div>

<p>How do we test it? The first approach we might think would be to write the test like before:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>//utils.test.js
it('should add two numbers', () =&gt; {
  let res = utils.asyncAdd(33, 11, (res) =&gt; {
  
    // will this work? 
    expect(res).toBe(44).toBeA('number'); 
  });
});

</code></pre>
</div>

<p>If you launch this example, <em>the test will pass, but for the <strong>wrong reason</strong></em>. Infact, Mocha will not wait the result callback an will end the test instantly. Try to break the test or the function… Mocha will say that everything is ok. That’s not good.</p>

<p>How can we fix this? Mocha has a super-simple solution, just add a <code class="highlighter-rouge">done</code> argument to the test callback. When <code class="highlighter-rouge">done</code> is present, Mocha will not end the test before you call the <code class="highlighter-rouge">done()</code> function. Let’s try:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>//utils.test.js
it('should add two numbers', (done) =&gt; {
  let res = utils.asyncAdd(33, 11, (res) =&gt; {
  
    expect(res).toBe(44).toBeA('number'); 
    done();
  });
});

</code></pre>
</div>

<p>Now, if you try to break the test or the function, you’ll see that Mocha will fail. Exactely what we want.</p>

<h2 id="testing-an-express-application">Testing an Express application</h2>

<p>It’s very difficult for the random developer to write a NodeJS app without using <a href="https://expressjs.com/it/">Express</a>, a framework for web applicatons that allows you to write REST endpoints easily.</p>

<p>How do I test an express application?</p>

<p>the creators of Express have come in help by creating another library called <a href="https://github.com/visionmedia/supertest">supertest</a>:</p>

<blockquote>
  <p> HTTP assertions made easy via superagent.</p>
</blockquote>

<p>Let’s write a simple http application with Express:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="c1">//file server.js</span>
<span class="kr">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'express'</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'/'</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">404</span><span class="p">).</span><span class="nx">send</span><span class="p">({</span>
    <span class="na">error</span><span class="p">:</span> <span class="s1">'Page not found'</span><span class="p">,</span>
    <span class="na">name</span><span class="p">:</span> <span class="s1">'hello baby'</span>
  <span class="p">});</span>
<span class="p">});</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">3000</span><span class="p">);</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="p">.</span><span class="nx">app</span> <span class="o">=</span> <span class="nx">app</span><span class="p">;</span> <span class="c1">// (1)</span>
</code></pre>
</div>

<p>This simple express app will return a <code class="highlighter-rouge">404</code> error with a json payload, everytime you navigate to <code class="highlighter-rouge">http://localhost:3000/</code>. Why? Because there’s nothing to see, obviously! :p</p>

<p>The only point worth of noting is that we simply export the app, as every other node module. Adding this line at (1) does not break anything, and makes testing possible.</p>

<p>To test this app, let’s write the test using <em>supertest</em>:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="c1">//server.test.js</span>

<span class="kr">const</span> <span class="nx">request</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'supertest'</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">expect</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'expect'</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'./server'</span><span class="p">);</span>

<span class="nx">it</span><span class="p">(</span><span class="s1">'should return hello world response'</span><span class="p">,</span> <span class="p">(</span><span class="nx">done</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">request</span><span class="p">(</span><span class="nx">app</span><span class="p">)</span>          <span class="c1">// (1)</span>
    <span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'/'</span><span class="p">)</span>           <span class="c1">// (2)</span>
    <span class="c1">//supertest expect!!</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="mi">404</span><span class="p">)</span>        <span class="c1">// (3)</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">((</span><span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>  <span class="c1">// (4)</span>
      <span class="c1">//expect library! </span>
      <span class="nx">expect</span><span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">body</span><span class="p">).</span><span class="nx">toInclude</span><span class="p">({</span>
        <span class="na">error</span><span class="p">:</span> <span class="s1">'Page not found'</span>
      <span class="p">})</span>
    <span class="p">})</span>
    <span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="nx">done</span><span class="p">);</span>         <span class="c1">// (5)</span>
<span class="p">});</span>
</code></pre>
</div>

<p>That’s interesting. At (1) we are importing the express app and using <code class="highlighter-rouge">supertest</code> to wrap it. Then we perform a <code class="highlighter-rouge">get</code> request over <code class="highlighter-rouge">/</code> (2) and start expecting things about the result. Unfortunately, supertest has another <code class="highlighter-rouge">expect</code> method that is not related to the one in the <code class="highlighter-rouge">expect</code> library.</p>

<p>By the way, with supertest we can make assumptions about the status code (3), and if we want to assert something about the body of the request, we can do like in (4): when using a callback we can do everything over the <code class="highlighter-rouge">res</code> variable, and infact we are using the <code class="highlighter-rouge">expect</code> library to see if the body includes the <code class="highlighter-rouge">error</code> property.</p>

<p>Since this Mocha test is async, we need a way to tell mocha that the test has ended. In (5) we see that supertest is already aware of mocha and will stop the test by passing the <code class="highlighter-rouge">done</code> function to <code class="highlighter-rouge">end()</code>.</p>

<h2 id="conclusions">Conclusions</h2>

<p>For a novice, the problem of testing Node apps is that there are many libraries the same thing. For an expert, this becomes an advantage: you can choose the best for your purposes (but you must know them in advance).</p>

<p>By the way, testing is important. Test everything is testable. Otherwise, maintaining javascript code can only be a mess.</p>

                  
                    <footer>
                        <aside>Written by Amit Seal Ami, a Lecturer from Institute of Information Technology, University of Dhaka.</aside>
                        <small>Copyright - Amit Seal Ami</small>
                  </footer>
                </article>
              </body>
            </html>
        ]]>
        </content:encoded>

      </item>
    
      <item>
        <title>Easy testing of NodeJS applications with Mocha</title>
        <link>https://michelenasti.com/2017/03/23/node-js-testing-easy-with-mocha.html</link>
        <guid isPermaLink="true">https://michelenasti.com/2017/03/23/node-js-testing-easy-with-mocha.html</guid>
        <pubDate>Thu, 23 Mar 2017 18:13:00 +0000</pubDate>
        <author></author>
        
          <description>&lt;p&gt;Testing in Javascript has become an immensely popular argument, but still there’s a lot of people that has not clear how to do it effectively. &lt;a href=&quot;/2016/08/my-very-personal-javascript-fatigue/&quot;&gt;I was one of these&lt;/a&gt;. There are many troubles that a young developer has to overcome in order to master Javascript testing. In this article, I’m going to explain Javascript testing with Mocha, a powerful library.&lt;/p&gt;

&lt;h2 id=&quot;why-testing-in-javascript&quot;&gt;Why testing in Javascript&lt;/h2&gt;

&lt;p&gt;An easy example. You write a function that takes only one argument, and use it extensively. After some days, you modify this function to take two arguments.&lt;/p&gt;

&lt;p&gt;Obviously you try to find every place where this function is called and add the missing parameter. Since the scripting nature of the language, how can you tell that this modification did not break anything? How to discover rapidly what to fix? Are users our only testers?&lt;/p&gt;

&lt;h2 id=&quot;setup-the-example&quot;&gt;Setup the example&lt;/h2&gt;

&lt;p&gt;Let’s write a simple Node test file. Let’s call it &lt;code class=&quot;highlighter-rouge&quot;&gt;utils.js&lt;/code&gt;, a file where we put all the functions that do not fit in a specific module.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;module.exports.add = (a,b) =&amp;amp;gt;  a + b;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;That’s it! Let’s test this function. Is our sum function really doing its job?&lt;/p&gt;

&lt;h2 id=&quot;setup-the-test&quot;&gt;Setup the test&lt;/h2&gt;

&lt;p&gt;First, let’s install 
&lt;a href=&quot;https://mochajs.org&quot;&gt;&lt;strong&gt;Mocha&lt;/strong&gt;&lt;/a&gt;. This is easy as launching&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ npm install --save-dev mocha 
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Let’s modify our &lt;code class=&quot;highlighter-rouge&quot;&gt;package.json&lt;/code&gt; (you did run &lt;code class=&quot;highlighter-rouge&quot;&gt;npm init&lt;/code&gt;, didn’t you?) to add a new task:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&quot;scripts&quot;: {
    ... 
    &quot;test&quot;: &quot;mocha **/*.test.js&quot;
  },
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Mocha will be installed as a &lt;em&gt;development dependency&lt;/em&gt;, this means that it is not necessary to run our code. Some deployment systems (like Heroku) will not download these dev dependencies.&lt;/p&gt;

&lt;p&gt;As you can see, the &lt;code class=&quot;highlighter-rouge&quot;&gt;test&lt;/code&gt; command will execute all files in every directory ending with &lt;code class=&quot;highlighter-rouge&quot;&gt;.test.js&lt;/code&gt;. This is incredibly fast.&lt;/p&gt;

&lt;p&gt;Let’s create in the very same directory where we put &lt;code class=&quot;highlighter-rouge&quot;&gt;utils.js&lt;/code&gt;, another file called &lt;code class=&quot;highlighter-rouge&quot;&gt;utils.test.js&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Here is the test code:&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;const utils = require('./utils'); //(1)

it('should add two numbers', () =&amp;amp;gt; {   //(2)
  let res = utils.add(33,11);
  if (res !== 44) {
     throw new Error(`Expected: 44, but got ${res}`); //(3)
  }
});
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;And now you can simply run &lt;code class=&quot;highlighter-rouge&quot;&gt;npm test&lt;/code&gt;. you should see an out like this:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ npm test

&amp;amp;gt; node-tests@1.0.0 test /Users/michelenasti/Doc
uments/node-tests
&amp;amp;gt; mocha **/*.test.js



  ✓ should add two numbers

  1 passing (13ms)

&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h2 id=&quot;whats-going-on&quot;&gt;What’s going on&lt;/h2&gt;

&lt;p&gt;Our tests are run directly by Mocha, that’s why we don’t import the library in this function.&lt;/p&gt;

&lt;p&gt;Mocha provides us a function called &lt;code class=&quot;highlighter-rouge&quot;&gt;it()&lt;/code&gt;. You might notice this function at (1). It takes two parameters: a description of the test, and a function with the code to execute.&lt;/p&gt;

&lt;p&gt;In the JS community tests are usually written in a &lt;em&gt;Behaviour Driven Development&lt;/em&gt; paradygm, this is a complex notion, for now let’s just say that test description starts with “&lt;em&gt;should …&lt;/em&gt;”. I’ll write more in the future :)&lt;/p&gt;

&lt;p&gt;The second argument passed to &lt;code class=&quot;highlighter-rouge&quot;&gt;it()&lt;/code&gt; is a function with the actual test code. Here we call the function under test, take the result and check the correctness.&lt;/p&gt;

&lt;p&gt;How Mocha decides if a test has passed or not? If no errors are thrown in our test code, then the test is marked as passed. On the other side, if an &lt;code class=&quot;highlighter-rouge&quot;&gt;Error()&lt;/code&gt; object is thrown, the test will stop and the message of the &lt;code class=&quot;highlighter-rouge&quot;&gt;Error&lt;/code&gt; is printed to the terminal.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Exercise for you: modify &lt;code class=&quot;highlighter-rouge&quot;&gt;utils.js&lt;/code&gt; to let the test fail :)&lt;/em&gt;&lt;/p&gt;

&lt;h2 id=&quot;do-js-developers-throw-errors-to-test-their-functions&quot;&gt;Do JS developers throw errors to test their functions?&lt;/h2&gt;

&lt;p&gt;No, in reality JS developers NEVER throw Errors. Usually in JS we use some other libraries to &lt;em&gt;assert&lt;/em&gt; some properties on the result, using functions that are more expressive. We will talk about this aspect in another post. However, I think that seeing how tests work without assertion libraries is &lt;em&gt;fundamental&lt;/em&gt; to use such libraries.&lt;/p&gt;

&lt;h2 id=&quot;last-but-not-least&quot;&gt;Last but not least&lt;/h2&gt;

&lt;p&gt;Do you want your test to run automatically everytime you change some file? Of course you can, mixing some code coming from a previous post (&lt;a href=&quot;https://michelenasti.com/2017/01/31/develop-faster-in-nodejs-with-nodemon.html&quot;&gt;nodemon&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;In &lt;code class=&quot;highlighter-rouge&quot;&gt;package.json&lt;/code&gt; add the script &lt;code class=&quot;highlighter-rouge&quot;&gt;test-watch&lt;/code&gt;…&lt;/p&gt;

&lt;div class=&quot;language-javascript highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;s2&quot;&gt;&quot;scripts&quot;&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
   &lt;span class=&quot;s2&quot;&gt;&quot;test&quot;&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;mocha **/*.test.js&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
   &lt;span class=&quot;s2&quot;&gt;&quot;test-watch&quot;&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;nodemon --exec \&quot;npm test\&quot;&quot;&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Happy testing!&lt;/p&gt;
</description>
        
        <content:encoded>
            <![CDATA[
                <!doctype html>
                <html lang="en" prefix="op: http://media.facebook.com/op#">
              <head>
                <meta charset="utf-8">
                <link rel="canonical" href="https://michelenasti.com/2017/03/23/node-js-testing-easy-with-mocha.html">
                <meta property="op:markup_version" content="v1.0">
              </head>
              <body>
                <article>
                  <header>
                      <h1>Easy testing of NodeJS applications with Mocha</h1>
                      
                      <figure>
                          <img src="https://michelenasti.com/images/michele_nasti.jpg" alt=" Easy testing of NodeJS applications with Mocha ">
                          <figcaption>Easy testing of NodeJS applications with Mocha</figcaption>
                      </figure>
                      
                      <time class="op-published" dateTime="2017-03-23 18:13:00 UTC">Thu, 23 Mar 2017 18:13:00 +0000</time>
                      <time class="op-modified" dateTime=""></time>
                  </header>
                  
                    <p>Testing in Javascript has become an immensely popular argument, but still there’s a lot of people that has not clear how to do it effectively. <a href="/2016/08/my-very-personal-javascript-fatigue/">I was one of these</a>. There are many troubles that a young developer has to overcome in order to master Javascript testing. In this article, I’m going to explain Javascript testing with Mocha, a powerful library.</p>

<h2 id="why-testing-in-javascript">Why testing in Javascript</h2>

<p>An easy example. You write a function that takes only one argument, and use it extensively. After some days, you modify this function to take two arguments.</p>

<p>Obviously you try to find every place where this function is called and add the missing parameter. Since the scripting nature of the language, how can you tell that this modification did not break anything? How to discover rapidly what to fix? Are users our only testers?</p>

<h2 id="setup-the-example">Setup the example</h2>

<p>Let’s write a simple Node test file. Let’s call it <code class="highlighter-rouge">utils.js</code>, a file where we put all the functions that do not fit in a specific module.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>module.exports.add = (a,b) =&amp;gt;  a + b;
</code></pre>
</div>

<p>That’s it! Let’s test this function. Is our sum function really doing its job?</p>

<h2 id="setup-the-test">Setup the test</h2>

<p>First, let’s install 
<a href="https://mochajs.org"><strong>Mocha</strong></a>. This is easy as launching</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ npm install --save-dev mocha 
</code></pre>
</div>

<p>Let’s modify our <code class="highlighter-rouge">package.json</code> (you did run <code class="highlighter-rouge">npm init</code>, didn’t you?) to add a new task:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>"scripts": {
    ... 
    "test": "mocha **/*.test.js"
  },
</code></pre>
</div>

<p>Mocha will be installed as a <em>development dependency</em>, this means that it is not necessary to run our code. Some deployment systems (like Heroku) will not download these dev dependencies.</p>

<p>As you can see, the <code class="highlighter-rouge">test</code> command will execute all files in every directory ending with <code class="highlighter-rouge">.test.js</code>. This is incredibly fast.</p>

<p>Let’s create in the very same directory where we put <code class="highlighter-rouge">utils.js</code>, another file called <code class="highlighter-rouge">utils.test.js</code>.</p>

<p>Here is the test code:</p>
<div class="highlighter-rouge"><pre class="highlight"><code>const utils = require('./utils'); //(1)

it('should add two numbers', () =&amp;gt; {   //(2)
  let res = utils.add(33,11);
  if (res !== 44) {
     throw new Error(`Expected: 44, but got ${res}`); //(3)
  }
});
</code></pre>
</div>

<p>And now you can simply run <code class="highlighter-rouge">npm test</code>. you should see an out like this:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ npm test

&amp;gt; node-tests@1.0.0 test /Users/michelenasti/Doc
uments/node-tests
&amp;gt; mocha **/*.test.js



  ✓ should add two numbers

  1 passing (13ms)

</code></pre>
</div>

<h2 id="whats-going-on">What’s going on</h2>

<p>Our tests are run directly by Mocha, that’s why we don’t import the library in this function.</p>

<p>Mocha provides us a function called <code class="highlighter-rouge">it()</code>. You might notice this function at (1). It takes two parameters: a description of the test, and a function with the code to execute.</p>

<p>In the JS community tests are usually written in a <em>Behaviour Driven Development</em> paradygm, this is a complex notion, for now let’s just say that test description starts with “<em>should …</em>”. I’ll write more in the future :)</p>

<p>The second argument passed to <code class="highlighter-rouge">it()</code> is a function with the actual test code. Here we call the function under test, take the result and check the correctness.</p>

<p>How Mocha decides if a test has passed or not? If no errors are thrown in our test code, then the test is marked as passed. On the other side, if an <code class="highlighter-rouge">Error()</code> object is thrown, the test will stop and the message of the <code class="highlighter-rouge">Error</code> is printed to the terminal.</p>

<p><em>Exercise for you: modify <code class="highlighter-rouge">utils.js</code> to let the test fail :)</em></p>

<h2 id="do-js-developers-throw-errors-to-test-their-functions">Do JS developers throw errors to test their functions?</h2>

<p>No, in reality JS developers NEVER throw Errors. Usually in JS we use some other libraries to <em>assert</em> some properties on the result, using functions that are more expressive. We will talk about this aspect in another post. However, I think that seeing how tests work without assertion libraries is <em>fundamental</em> to use such libraries.</p>

<h2 id="last-but-not-least">Last but not least</h2>

<p>Do you want your test to run automatically everytime you change some file? Of course you can, mixing some code coming from a previous post (<a href="https://michelenasti.com/2017/01/31/develop-faster-in-nodejs-with-nodemon.html">nodemon</a>).</p>

<p>In <code class="highlighter-rouge">package.json</code> add the script <code class="highlighter-rouge">test-watch</code>…</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="s2">"scripts"</span><span class="err">:</span> <span class="p">{</span>
   <span class="s2">"test"</span><span class="err">:</span> <span class="s2">"mocha **/*.test.js"</span><span class="p">,</span>
   <span class="s2">"test-watch"</span><span class="err">:</span> <span class="s2">"nodemon --exec \"npm test\""</span>
  <span class="p">},</span>
</code></pre>
</div>

<p>Happy testing!</p>

                  
                    <footer>
                        <aside>Written by Amit Seal Ami, a Lecturer from Institute of Information Technology, University of Dhaka.</aside>
                        <small>Copyright - Amit Seal Ami</small>
                  </footer>
                </article>
              </body>
            </html>
        ]]>
        </content:encoded>

      </item>
    
      <item>
        <title>L'Inglese tra italiani, a lavoro, è una scelta sbagliata</title>
        <link>https://michelenasti.com/2017/03/20/l-inglese-tra-italiani-a-lavoro-e-una-scelta-sbagliata.html</link>
        <guid isPermaLink="true">https://michelenasti.com/2017/03/20/l-inglese-tra-italiani-a-lavoro-e-una-scelta-sbagliata.html</guid>
        <pubDate>Mon, 20 Mar 2017 09:56:01 +0000</pubDate>
        <author></author>
        
          <description>&lt;p&gt;C’è un trend che ogni tanto ritorna, ossia quello di usare l’inglese come lingua ufficiale durante l’orario di lavoro. Con colleghi italiani. In un ufficio italiano.&lt;/p&gt;

&lt;p&gt;La prima volta che ho sentito di questa pratica era durante la mia prima esperienza lavorativa; realizzando un software per un’azienda inglese, una grande parte delle specifiche arrivavano in quella lingua (giustamente!) e i nostri Business Analyst dovevano interfacciarsi continuamente con loro per documentare il software. Da qui, la scelta del team di analisti di parlare solo in inglese, tra di loro, per un giorno a settimana.&lt;/p&gt;

&lt;p&gt;Ora che lavoro da remoto, e interazione “sincrona” con i colleghi è molto scarsa, per uno specifico progetto è stato concordato di comunicare (in chat!) solo ed esclusivamente in inglese.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/pexels-photo-119689%20(1).jpeg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;it’s time for a cup of tea!&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;Chi vi scrive ha un inglese decente, complice il papà professore di Inglese che si è sbattuto per insegnarglielo fin da piccolo. Ovvio che non sono madrelingua ma non faccio pena, anzi mi sento tranquillamente a mio agio a parlare il mio fantastico &lt;em&gt;English&lt;/em&gt; con accento napoletano.&lt;/p&gt;

&lt;p&gt;Ebbene, &lt;strong&gt;trovo questa idea di sforzarsi a parlare inglese, tra italiani, una cagata pazzesca.&lt;/strong&gt;&lt;/p&gt;

&lt;h2 id=&quot;i-tipi-di-comunicazione&quot;&gt;I tipi di comunicazione&lt;/h2&gt;

&lt;p&gt;Faccio solo un rapido e semplice excursus sul tipo di comunicazioni possibili in un ambiente di lavoro:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;Comunicazione Sincrona&lt;/strong&gt; - è quel tipo di comunicazione che prevede due o più persone impegnate nello stesso momento. Esempi: la classica chiacchierata face-2-face, la telefonata, una videocall (skype...) etc. Qui è importante l'immediatezza e la chiarezza dei concetti espressi.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;Comunicazione Asincrona&lt;/strong&gt; - Le comunicazioni che non prevedono una risposta immediata tra gli interlocutori. Tra questi tipi di comunicazione ci sono chat, mail, blog post, commenti a un wiki, documentazione, documenti word... Qui invece è desiderabile ottenere una comunicazione non ambigua e chiara anche a distanza di mesi.&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Aspettarsi una risposta istantanea a una chat è da stupidi, così come vi sembrerebbe piuttosto strano se un interlocutore fisico (con cui state conversando al distributore) smetta di rispondervi all’improvviso.&lt;/p&gt;

&lt;p&gt;Bene, avete appena completato il primo corso base di comunicazione aziendale :)&lt;/p&gt;

&lt;h2 id=&quot;perché-parlare-in-inglese-tra-italiani-è-una-cagata-pazzesca&quot;&gt;Perché parlare in inglese tra italiani è una cagata pazzesca&lt;/h2&gt;

&lt;p&gt;Ho sentito molti motivi per cui le aziende vogliono introdurre l’inglese aggressivo tra i propri dipendenti. Smontiamoli uno ad uno.&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;&quot;Così possiamo attrarre talenti stranieri&quot;.&lt;/strong&gt;&amp;nbsp;Cazzata. I talenti stranieri non vengono perché in Italia si parla inglese, anzi si aspettano che con loro parliate in inglese (che li avete chiamati a fare?). Per attrarre talenti stranieri servono &lt;strong&gt;idee sfidanti&lt;/strong&gt;, &lt;strong&gt;stipendi alti&lt;/strong&gt;, e un&amp;nbsp;&lt;strong&gt;ecosistema dinamico.&lt;/strong&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;&quot;Così i dipendenti migliorano l'inglese&quot;.&lt;/strong&gt; Mi dispiace davvero che qualcuno pensi che, se due persone che non conoscono l'inglese iniziano improvvisamente a parlarlo (sotto tortura), poi lo imparano. Anche questa è una &lt;em&gt;cazzata&lt;/em&gt;. Se volete imparare l'inglese esiste una sola strada: un bel corso di lingue in cui si parla molto (e in cui la grammatica non è trascurata).&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;&quot;Così ci sentiamo più internazionali&quot;&lt;/strong&gt;. Equivale a misurarsi il pene col righello senza mai confrontare le misure con gli altri. L'unica metrica che dovrebbe interessarvi è il FATTURATO.&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;span style=&quot;font-size: 18px;&quot;&gt;Aggiungo, per completezza, che sul luogo di lavoro è importante che la comunicazione sia &lt;strong&gt;efficace, semplice e chiara&lt;/strong&gt;. &lt;em&gt;Ogni sovrastruttura, impedimento, legaccio, costrizione finirà col logorare il vostro lavoro.&lt;/em&gt; Io ad esempio non sopporto quando devo parlare con qualcuno e mi si risponde “mandami una mail che sono SEMPRE impegnato” (non riesci neanche a trovare 10 minuti per me?). Anche questo è un esempio di costrizione che non migliora il problem solving. &lt;/span&gt;&lt;/p&gt;

&lt;h2 id=&quot;lestremo-opposto-only-italian-please&quot;&gt;L’estremo opposto: only Italian, please&lt;/h2&gt;

&lt;p&gt;Siccome sono un programmatore (e se siete su questa pagina dovreste averlo intuito) posso già dirvi che il 99% dei libri su cui ho studiato, gli articoli on line che ho letto (e scritto) , le guide tecniche e i siti delle aziende più importanti sono in inglese.&lt;/p&gt;

&lt;p&gt;Questo vuol dire sostanzialmente due cose:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;La documentazione dei vostri software e dei vostri processi di business non può essere in italiano&lt;/strong&gt;. Anche se oggi siete tutti italiani sul progetto, un bel giorno potreste trovarvi ad assumere degli stranieri, o delocalizzare lo sviluppo in qualche paese asiatico, e l’unico modo che avete per comunicare con loro sarà l’inglese. Siate future-proof e usate l’inglese come fa il resto del mondo.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Il vostro codice sorgente deve essere in inglese.&lt;/strong&gt; Il motivo è lo stesso del punto precedente, con l’aggravante che &lt;code class=&quot;highlighter-rouge&quot;&gt;checkIfCodiceFiscaleIsValid()&lt;/code&gt; non si può sentire.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;E’ importante dunque che chi voglia lavorare in questo mondo debba per lo meno saper leggere e scrivere un Inglese decente.&lt;/p&gt;

&lt;h2 id=&quot;quando-è-giusto-parlare-inglese-o-qualsiasi-altra-lingua-straniera&quot;&gt;Quando è giusto parlare inglese (o qualsiasi altra lingua straniera)&lt;/h2&gt;

&lt;p&gt;Quando nella vostra conversazione sincrona uno dei partecipanti non capisce l’italiano. A quel punto si sceglie una lingua compresa da tutti e la si usa.&lt;/p&gt;

&lt;h2 id=&quot;implicazioni-filosofiche-di-questa-scelta&quot;&gt;Implicazioni filosofiche di questa scelta&lt;/h2&gt;

&lt;p&gt;Siamo costretti a restare confinati nella nostra italianità? Non avremo mai accesso ai “talenti stranieri”?&lt;/p&gt;

&lt;p&gt;Se la tua azienda è una s.r.l., non puoi certo definirla L.T.D. :)&lt;/p&gt;

&lt;p&gt;Un altra conseguenza è che non è la lingua che si parla a rendere &lt;em&gt;grande&lt;/em&gt; un workplace.&lt;/p&gt;

&lt;p&gt;Infine: meglio un ottimo performer con un inglese zoppicante, o un  inglese madrelingua che lavora così così?&lt;/p&gt;
</description>
        
        <content:encoded>
            <![CDATA[
                <!doctype html>
                <html lang="en" prefix="op: http://media.facebook.com/op#">
              <head>
                <meta charset="utf-8">
                <link rel="canonical" href="https://michelenasti.com/2017/03/20/l-inglese-tra-italiani-a-lavoro-e-una-scelta-sbagliata.html">
                <meta property="op:markup_version" content="v1.0">
              </head>
              <body>
                <article>
                  <header>
                      <h1>L'Inglese tra italiani, a lavoro, è una scelta sbagliata</h1>
                      
                      <figure>
                          <img src="https://michelenasti.com/images/michele_nasti.jpg" alt=" L'Inglese tra italiani, a lavoro, è una scelta sbagliata ">
                          <figcaption>L'Inglese tra italiani, a lavoro, è una scelta sbagliata</figcaption>
                      </figure>
                      
                      <time class="op-published" dateTime="2017-03-20 09:56:01 UTC">Mon, 20 Mar 2017 09:56:01 +0000</time>
                      <time class="op-modified" dateTime=""></time>
                  </header>
                  
                    <p>C’è un trend che ogni tanto ritorna, ossia quello di usare l’inglese come lingua ufficiale durante l’orario di lavoro. Con colleghi italiani. In un ufficio italiano.</p>

<p>La prima volta che ho sentito di questa pratica era durante la mia prima esperienza lavorativa; realizzando un software per un’azienda inglese, una grande parte delle specifiche arrivavano in quella lingua (giustamente!) e i nostri Business Analyst dovevano interfacciarsi continuamente con loro per documentare il software. Da qui, la scelta del team di analisti di parlare solo in inglese, tra di loro, per un giorno a settimana.</p>

<p>Ora che lavoro da remoto, e interazione “sincrona” con i colleghi è molto scarsa, per uno specifico progetto è stato concordato di comunicare (in chat!) solo ed esclusivamente in inglese.</p>

<p><img src="/images/pexels-photo-119689%20(1).jpeg" alt="" /></p>

<p><em>it’s time for a cup of tea!</em></p>

<p>Chi vi scrive ha un inglese decente, complice il papà professore di Inglese che si è sbattuto per insegnarglielo fin da piccolo. Ovvio che non sono madrelingua ma non faccio pena, anzi mi sento tranquillamente a mio agio a parlare il mio fantastico <em>English</em> con accento napoletano.</p>

<p>Ebbene, <strong>trovo questa idea di sforzarsi a parlare inglese, tra italiani, una cagata pazzesca.</strong></p>

<h2 id="i-tipi-di-comunicazione">I tipi di comunicazione</h2>

<p>Faccio solo un rapido e semplice excursus sul tipo di comunicazioni possibili in un ambiente di lavoro:</p>
<ul>
  <li>
    <p><strong>Comunicazione Sincrona</strong> - è quel tipo di comunicazione che prevede due o più persone impegnate nello stesso momento. Esempi: la classica chiacchierata face-2-face, la telefonata, una videocall (skype...) etc. Qui è importante l'immediatezza e la chiarezza dei concetti espressi.</p>
  </li>
  <li>
    <p><strong>Comunicazione Asincrona</strong> - Le comunicazioni che non prevedono una risposta immediata tra gli interlocutori. Tra questi tipi di comunicazione ci sono chat, mail, blog post, commenti a un wiki, documentazione, documenti word... Qui invece è desiderabile ottenere una comunicazione non ambigua e chiara anche a distanza di mesi.</p>
  </li>
</ul>

<p>Aspettarsi una risposta istantanea a una chat è da stupidi, così come vi sembrerebbe piuttosto strano se un interlocutore fisico (con cui state conversando al distributore) smetta di rispondervi all’improvviso.</p>

<p>Bene, avete appena completato il primo corso base di comunicazione aziendale :)</p>

<h2 id="perché-parlare-in-inglese-tra-italiani-è-una-cagata-pazzesca">Perché parlare in inglese tra italiani è una cagata pazzesca</h2>

<p>Ho sentito molti motivi per cui le aziende vogliono introdurre l’inglese aggressivo tra i propri dipendenti. Smontiamoli uno ad uno.</p>
<ul>
  <li>
    <p><strong>"Così possiamo attrarre talenti stranieri".</strong>&nbsp;Cazzata. I talenti stranieri non vengono perché in Italia si parla inglese, anzi si aspettano che con loro parliate in inglese (che li avete chiamati a fare?). Per attrarre talenti stranieri servono <strong>idee sfidanti</strong>, <strong>stipendi alti</strong>, e un&nbsp;<strong>ecosistema dinamico.</strong></p>
  </li>
  <li>
    <p><strong>"Così i dipendenti migliorano l'inglese".</strong> Mi dispiace davvero che qualcuno pensi che, se due persone che non conoscono l'inglese iniziano improvvisamente a parlarlo (sotto tortura), poi lo imparano. Anche questa è una <em>cazzata</em>. Se volete imparare l'inglese esiste una sola strada: un bel corso di lingue in cui si parla molto (e in cui la grammatica non è trascurata).</p>
  </li>
  <li>
    <p><strong>"Così ci sentiamo più internazionali"</strong>. Equivale a misurarsi il pene col righello senza mai confrontare le misure con gli altri. L'unica metrica che dovrebbe interessarvi è il FATTURATO.</p>
  </li>
</ul>

<p><span style="font-size: 18px;">Aggiungo, per completezza, che sul luogo di lavoro è importante che la comunicazione sia <strong>efficace, semplice e chiara</strong>. <em>Ogni sovrastruttura, impedimento, legaccio, costrizione finirà col logorare il vostro lavoro.</em> Io ad esempio non sopporto quando devo parlare con qualcuno e mi si risponde “mandami una mail che sono SEMPRE impegnato” (non riesci neanche a trovare 10 minuti per me?). Anche questo è un esempio di costrizione che non migliora il problem solving. </span></p>

<h2 id="lestremo-opposto-only-italian-please">L’estremo opposto: only Italian, please</h2>

<p>Siccome sono un programmatore (e se siete su questa pagina dovreste averlo intuito) posso già dirvi che il 99% dei libri su cui ho studiato, gli articoli on line che ho letto (e scritto) , le guide tecniche e i siti delle aziende più importanti sono in inglese.</p>

<p>Questo vuol dire sostanzialmente due cose:</p>
<ul>
  <li><strong>La documentazione dei vostri software e dei vostri processi di business non può essere in italiano</strong>. Anche se oggi siete tutti italiani sul progetto, un bel giorno potreste trovarvi ad assumere degli stranieri, o delocalizzare lo sviluppo in qualche paese asiatico, e l’unico modo che avete per comunicare con loro sarà l’inglese. Siate future-proof e usate l’inglese come fa il resto del mondo.</li>
  <li><strong>Il vostro codice sorgente deve essere in inglese.</strong> Il motivo è lo stesso del punto precedente, con l’aggravante che <code class="highlighter-rouge">checkIfCodiceFiscaleIsValid()</code> non si può sentire.</li>
</ul>

<p>E’ importante dunque che chi voglia lavorare in questo mondo debba per lo meno saper leggere e scrivere un Inglese decente.</p>

<h2 id="quando-è-giusto-parlare-inglese-o-qualsiasi-altra-lingua-straniera">Quando è giusto parlare inglese (o qualsiasi altra lingua straniera)</h2>

<p>Quando nella vostra conversazione sincrona uno dei partecipanti non capisce l’italiano. A quel punto si sceglie una lingua compresa da tutti e la si usa.</p>

<h2 id="implicazioni-filosofiche-di-questa-scelta">Implicazioni filosofiche di questa scelta</h2>

<p>Siamo costretti a restare confinati nella nostra italianità? Non avremo mai accesso ai “talenti stranieri”?</p>

<p>Se la tua azienda è una s.r.l., non puoi certo definirla L.T.D. :)</p>

<p>Un altra conseguenza è che non è la lingua che si parla a rendere <em>grande</em> un workplace.</p>

<p>Infine: meglio un ottimo performer con un inglese zoppicante, o un  inglese madrelingua che lavora così così?</p>

                  
                    <footer>
                        <aside>Written by Amit Seal Ami, a Lecturer from Institute of Information Technology, University of Dhaka.</aside>
                        <small>Copyright - Amit Seal Ami</small>
                  </footer>
                </article>
              </body>
            </html>
        ]]>
        </content:encoded>

      </item>
    
      <item>
        <title>Deploy a NodeJS app on Heroku in less than 1 minute</title>
        <link>https://michelenasti.com/2017/03/18/deploy-a-nodejs-app-on-heroku-in-less-than-1-minute.html</link>
        <guid isPermaLink="true">https://michelenasti.com/2017/03/18/deploy-a-nodejs-app-on-heroku-in-less-than-1-minute.html</guid>
        <pubDate>Sat, 18 Mar 2017 13:18:53 +0000</pubDate>
        <author></author>
        
          <description>&lt;p&gt;Actually, the time you need to deploy an app depends on how fast you are to copy &amp;amp; paste.&lt;/p&gt;

&lt;h2 id=&quot;prerequisites&quot;&gt;Prerequisites&lt;/h2&gt;
&lt;p&gt;Your code must be hosted in a git repository.&lt;/p&gt;

&lt;h2 id=&quot;steps-to-set-up-the-environment-the-first-time&quot;&gt;Steps to set up the environment the first time&lt;/h2&gt;
&lt;ol&gt;
  &lt;li&gt;Sign up (or log in) to
  &lt;a href=&quot;http://heroku.com&quot;&gt;heroku.com&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;download
  &lt;a href=&quot;https://devcenter.heroku.com/articles/heroku-cli&quot;&gt;heroku’s command for the console&lt;/a&gt; (select the right version for your operating system).&lt;/li&gt;
  &lt;li&gt;be sure the command is installed: &lt;code class=&quot;highlighter-rouge&quot;&gt;heroku -v&lt;/code&gt; (you should see some output)&lt;/li&gt;
  &lt;li&gt;launch &lt;code class=&quot;highlighter-rouge&quot;&gt;heroku login&lt;/code&gt;and log in with your email and password.&lt;/li&gt;
  &lt;li&gt;Upload ssh keys to heroku: &lt;code class=&quot;highlighter-rouge&quot;&gt;heroku keys:add&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;ssh -v git@heroku.com&lt;/code&gt;: even if the command seems to fail, check that the long output contains the row
    &lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;debug1: Authentication succeeded (publickey).
&lt;/code&gt;&lt;/pre&gt;
    &lt;/div&gt;
    &lt;p&gt;Generally it is one of the last 5-6 rows. If this log is present, everything is set up correctly.&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;steps-to-set-up-the-environment-with-the-nodejs-app&quot;&gt;Steps to set up the environment with the NodeJs app&lt;/h2&gt;
&lt;ul&gt;
  &lt;li&gt;Set the host port of your application as an environment variable:
    &lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;const port = process.env.PORT || 3000 ;  
... 
app.listen(port);
&lt;/code&gt;&lt;/pre&gt;
    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;set the &lt;code class=&quot;highlighter-rouge&quot;&gt;npm start&lt;/code&gt; script, in &lt;code class=&quot;highlighter-rouge&quot;&gt;package.json&lt;/code&gt;:&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&quot;scripts&quot;: {
   &quot;start&quot;: &quot;node server.js&quot;,
   ...
   }

&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;Check that the app runs correctly: &lt;code class=&quot;highlighter-rouge&quot;&gt;npm start&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;launch &lt;code class=&quot;highlighter-rouge&quot;&gt;heroku create&lt;/code&gt;: will create a new remote for your repository named &lt;code class=&quot;highlighter-rouge&quot;&gt;heroku&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;git push heroku&lt;/code&gt; : will push your code to heroku&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;heroku open&lt;/code&gt;: will open your webapp in the browser&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;For every modification you do to your code, just commit and &lt;code class=&quot;highlighter-rouge&quot;&gt;git push heroku&lt;/code&gt;!&lt;/p&gt;
</description>
        
        <content:encoded>
            <![CDATA[
                <!doctype html>
                <html lang="en" prefix="op: http://media.facebook.com/op#">
              <head>
                <meta charset="utf-8">
                <link rel="canonical" href="https://michelenasti.com/2017/03/18/deploy-a-nodejs-app-on-heroku-in-less-than-1-minute.html">
                <meta property="op:markup_version" content="v1.0">
              </head>
              <body>
                <article>
                  <header>
                      <h1>Deploy a NodeJS app on Heroku in less than 1 minute</h1>
                      
                      <figure>
                          <img src="https://michelenasti.com/images/michele_nasti.jpg" alt=" Deploy a NodeJS app on Heroku in less than 1 minute ">
                          <figcaption>Deploy a NodeJS app on Heroku in less than 1 minute</figcaption>
                      </figure>
                      
                      <time class="op-published" dateTime="2017-03-18 13:18:53 UTC">Sat, 18 Mar 2017 13:18:53 +0000</time>
                      <time class="op-modified" dateTime=""></time>
                  </header>
                  
                    <p>Actually, the time you need to deploy an app depends on how fast you are to copy &amp; paste.</p>

<h2 id="prerequisites">Prerequisites</h2>
<p>Your code must be hosted in a git repository.</p>

<h2 id="steps-to-set-up-the-environment-the-first-time">Steps to set up the environment the first time</h2>
<ol>
  <li>Sign up (or log in) to
  <a href="http://heroku.com">heroku.com</a></li>
  <li>download
  <a href="https://devcenter.heroku.com/articles/heroku-cli">heroku’s command for the console</a> (select the right version for your operating system).</li>
  <li>be sure the command is installed: <code class="highlighter-rouge">heroku -v</code> (you should see some output)</li>
  <li>launch <code class="highlighter-rouge">heroku login</code>and log in with your email and password.</li>
  <li>Upload ssh keys to heroku: <code class="highlighter-rouge">heroku keys:add</code></li>
  <li><code class="highlighter-rouge">ssh -v git@heroku.com</code>: even if the command seems to fail, check that the long output contains the row
    <div class="highlighter-rouge"><pre class="highlight"><code>debug1: Authentication succeeded (publickey).
</code></pre>
    </div>
    <p>Generally it is one of the last 5-6 rows. If this log is present, everything is set up correctly.</p>
  </li>
</ol>

<h2 id="steps-to-set-up-the-environment-with-the-nodejs-app">Steps to set up the environment with the NodeJs app</h2>
<ul>
  <li>Set the host port of your application as an environment variable:
    <div class="highlighter-rouge"><pre class="highlight"><code>const port = process.env.PORT || 3000 ;  
... 
app.listen(port);
</code></pre>
    </div>
  </li>
  <li>set the <code class="highlighter-rouge">npm start</code> script, in <code class="highlighter-rouge">package.json</code>:</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>"scripts": {
   "start": "node server.js",
   ...
   }

</code></pre>
</div>

<ul>
  <li>Check that the app runs correctly: <code class="highlighter-rouge">npm start</code></li>
  <li>launch <code class="highlighter-rouge">heroku create</code>: will create a new remote for your repository named <code class="highlighter-rouge">heroku</code></li>
  <li><code class="highlighter-rouge">git push heroku</code> : will push your code to heroku</li>
  <li><code class="highlighter-rouge">heroku open</code>: will open your webapp in the browser</li>
</ul>

<p>For every modification you do to your code, just commit and <code class="highlighter-rouge">git push heroku</code>!</p>

                  
                    <footer>
                        <aside>Written by Amit Seal Ami, a Lecturer from Institute of Information Technology, University of Dhaka.</aside>
                        <small>Copyright - Amit Seal Ami</small>
                  </footer>
                </article>
              </body>
            </html>
        ]]>
        </content:encoded>

      </item>
    
      <item>
        <title>Two easy ways perform GET requests in NodeJS </title>
        <link>https://michelenasti.com/2017/03/13/two-easy-ways-perform-get-requests-in-nodejs.html</link>
        <guid isPermaLink="true">https://michelenasti.com/2017/03/13/two-easy-ways-perform-get-requests-in-nodejs.html</guid>
        <pubDate>Mon, 13 Mar 2017 23:07:41 +0000</pubDate>
        <author></author>
        
          <description>&lt;p&gt;Today I want to talk about something that we all need during our programming life: requesting data from a remote server. We will do this using callbacks and promises, to show both the approaches.&lt;/p&gt;

&lt;p&gt;We will see this specifically for NodeJS because it’s so simple that I couldn’t even imagine.&lt;/p&gt;

&lt;p&gt;In this article I’m going to talk about two super-popular libraries that do the same thing, but expose their API to the developer differently. Let’s see what they do and how to use them.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/callbacks.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;a-simple-use-case-google-maps-api&quot;&gt;a simple use case: Google maps API&lt;/h2&gt;

&lt;p&gt;Just as an example, we will write a simple program that takes a textual address (for example&lt;code class=&quot;highlighter-rouge&quot;&gt;Piazza della Concordia, Salerno&lt;/code&gt;) and return latitude and longitude.&lt;/p&gt;

&lt;p&gt;The URL is this: &lt;a href=&quot;https://maps.googleapis.com/maps/api/geocode/json?address=piazza della concordia, salerno&quot;&gt;https://maps.googleapis.com/maps/api/geocode/json?address=piazza della concordia, salerno&lt;/a&gt;.  Clicking on this link you can see the response in json format.&lt;/p&gt;

&lt;p&gt;Our mission is to retrive latitude and longitude, so&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;results[0].geometry.location.lat
results[0].geometry.location.lng
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h2 id=&quot;request-the-name-says-it-all&quot;&gt;Request: the name says it all&lt;/h2&gt;

&lt;p&gt;The first library I’m going to talk is simply called &lt;a href=&quot;https://www.npmjs.com/package/request&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;request&lt;/code&gt;&lt;/a&gt;. Install as always:&lt;/p&gt;

&lt;div class=&quot;language-console highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;w&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;npm&lt;/span&gt;&lt;span class=&quot;kv&quot;&gt; install request --save
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;From the NPM description:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Request is designed to be the simplest way possible to make http calls. It supports HTTPS and follows redirects by default.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Here is a NodeJS function that uses &lt;code class=&quot;highlighter-rouge&quot;&gt;request&lt;/code&gt; to perform the call&lt;/p&gt;

&lt;div class=&quot;language-javascript highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;encodedAddress&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;encodeURIComponent&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;address&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

  &lt;span class=&quot;nx&quot;&gt;request&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;({&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;https&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;//maps.googleapis.com/maps/api/geocode/json?address=${encodedAddress}`,&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;json&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;body&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;

    &lt;span class=&quot;c1&quot;&gt;//server unreachable&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; 
      &lt;span class=&quot;nx&quot;&gt;callback&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'Unable to connect to Google Servers'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;c1&quot;&gt;// no results &lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;body&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;status&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'ZERO_RESULTS'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;nx&quot;&gt;callback&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'Unable to find that address'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;body&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;status&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'OK'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;nx&quot;&gt;callback&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;undefined&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;address&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;body&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;results&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;].&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;formatted_address&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;latitude&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;body&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;results&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;].&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;geometry&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;location&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;lat&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;longitude&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;body&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;results&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;].&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;geometry&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;location&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;lng&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;encodeURIComponent()&lt;/code&gt; is a function that converts strings with special characters (like spaces, or quotes..) to a string that can be passed over a URI.&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;request&lt;/code&gt; is just a function that takes an URI, some options, and will give the result in a &lt;strong&gt;callback&lt;/strong&gt;. Since we are following Node standard approach to callbacks, where the first argument is the error object, the return callback contains a &lt;code class=&quot;highlighter-rouge&quot;&gt;undefined&lt;/code&gt; as first argument.&lt;/p&gt;

&lt;h2 id=&quot;axios-a-promise-based-equivalent&quot;&gt;Axios: a Promise based equivalent&lt;/h2&gt;

&lt;p&gt;&lt;a href=&quot;https://michelenasti.com/2017/03/12/js-promises-description-pros-cons-of-this-es6-construct.html&quot;&gt;In my last article we talked about promises&lt;/a&gt;, so we would like to see these in action, right? We have two options, the first is to wrap &lt;code class=&quot;highlighter-rouge&quot;&gt;request&lt;/code&gt; in a promise (easy, but more code); the second is to &lt;strong&gt;use a library already built with promises in mind&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;The one I use, and that is super popular, is called &lt;strong&gt;&lt;a href=&quot;https://www.npmjs.com/package/axios&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;Axios&lt;/code&gt;&lt;/a&gt;&lt;/strong&gt;: Here’s the description&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Promise based HTTP client for the browser and node.js&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;To install:&lt;/p&gt;

&lt;div class=&quot;language-console highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;w&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;npm&lt;/span&gt;&lt;span class=&quot;kv&quot;&gt; install axios
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Here is the snippet for the axios request:&lt;/p&gt;

&lt;div class=&quot;language-javascript highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;encodedAddress&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;encodeURIComponent&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;address&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;geocodeUrl&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;https&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;//maps.googleapis.com/maps/api/geocode/json?address=${encodedAddress}`;&lt;/span&gt;

&lt;span class=&quot;nx&quot;&gt;axios&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;geocodeUrl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;then&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;c1&quot;&gt;// throw error on no results&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;status&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'ZERO_RESULTS'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;Error&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'Unable to find that address'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;c1&quot;&gt;// return new promise with data (for chaining)&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;Promise&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;resolve&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;({&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;latitude&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;results&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;].&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;geometry&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;location&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;lat&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;longitude&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;results&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;].&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;geometry&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;location&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;lng&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;formatted_address&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;results&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;].&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;formatted_address&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;

  &lt;span class=&quot;c1&quot;&gt;// show data&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}).&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;then&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;nx&quot;&gt;console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;latitude&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;formatted_address&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;nx&quot;&gt;console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;latitude&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;latitude&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;nx&quot;&gt;console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;latitude&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;longitude&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

  &lt;span class=&quot;c1&quot;&gt;//error handling &lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}).&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;catch&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;nx&quot;&gt;console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;});&lt;/span&gt; 
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;The approach here is different. &lt;code class=&quot;highlighter-rouge&quot;&gt;axios.get()&lt;/code&gt; returns a Promise, that we chain with a call to the &lt;code class=&quot;highlighter-rouge&quot;&gt;then()&lt;/code&gt; method.&lt;/p&gt;

&lt;p&gt;Once we have the data, in the form of &lt;code class=&quot;highlighter-rouge&quot;&gt;response.data&lt;/code&gt;, we can extrapolate the fields we need.&lt;/p&gt;

&lt;p&gt;I could just print the data in the first &lt;code class=&quot;highlighter-rouge&quot;&gt;then()&lt;/code&gt; block, but to be more coherent with my design guidelines (&lt;em&gt;every function does just one thing&lt;/em&gt;) I wanted to separate the two operations so the first block will just retrieve the data, then returns another Promise (&lt;code class=&quot;highlighter-rouge&quot;&gt;return Promise.resolve({..})&lt;/code&gt;).&lt;/p&gt;

&lt;p&gt;The next &lt;code class=&quot;highlighter-rouge&quot;&gt;then()&lt;/code&gt; block will only display the data retrieved.&lt;/p&gt;

&lt;h2 id=&quot;which-approach-do-you-prefer&quot;&gt;Which approach do you prefer?&lt;/h2&gt;

&lt;p&gt;This depends on you! &lt;strong&gt;I prefer promises&lt;/strong&gt;, because I find them more natural, but being a Node coder means you can choose and decide what’s best for you. Both are well tested libraries with well known patterns, so you only have to choose the one you love.&lt;/p&gt;

&lt;p&gt;Cheers from &lt;code class=&quot;highlighter-rouge&quot;&gt;40.7802306&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;14.7010686&lt;/code&gt; !&lt;/p&gt;
</description>
        
        <content:encoded>
            <![CDATA[
                <!doctype html>
                <html lang="en" prefix="op: http://media.facebook.com/op#">
              <head>
                <meta charset="utf-8">
                <link rel="canonical" href="https://michelenasti.com/2017/03/13/two-easy-ways-perform-get-requests-in-nodejs.html">
                <meta property="op:markup_version" content="v1.0">
              </head>
              <body>
                <article>
                  <header>
                      <h1>Two easy ways perform GET requests in NodeJS </h1>
                      
                      <figure>
                          <img src="https://michelenasti.com/images/michele_nasti.jpg" alt=" Two easy ways perform GET requests in NodeJS  ">
                          <figcaption>Two easy ways perform GET requests in NodeJS </figcaption>
                      </figure>
                      
                      <time class="op-published" dateTime="2017-03-13 23:07:41 UTC">Mon, 13 Mar 2017 23:07:41 +0000</time>
                      <time class="op-modified" dateTime=""></time>
                  </header>
                  
                    <p>Today I want to talk about something that we all need during our programming life: requesting data from a remote server. We will do this using callbacks and promises, to show both the approaches.</p>

<p>We will see this specifically for NodeJS because it’s so simple that I couldn’t even imagine.</p>

<p>In this article I’m going to talk about two super-popular libraries that do the same thing, but expose their API to the developer differently. Let’s see what they do and how to use them.</p>

<p><img src="/images/callbacks.png" alt="" /></p>

<h2 id="a-simple-use-case-google-maps-api">a simple use case: Google maps API</h2>

<p>Just as an example, we will write a simple program that takes a textual address (for example<code class="highlighter-rouge">Piazza della Concordia, Salerno</code>) and return latitude and longitude.</p>

<p>The URL is this: <a href="https://maps.googleapis.com/maps/api/geocode/json?address=piazza della concordia, salerno">https://maps.googleapis.com/maps/api/geocode/json?address=piazza della concordia, salerno</a>.  Clicking on this link you can see the response in json format.</p>

<p>Our mission is to retrive latitude and longitude, so</p>

<div class="highlighter-rouge"><pre class="highlight"><code>results[0].geometry.location.lat
results[0].geometry.location.lng
</code></pre>
</div>

<h2 id="request-the-name-says-it-all">Request: the name says it all</h2>

<p>The first library I’m going to talk is simply called <a href="https://www.npmjs.com/package/request"><code class="highlighter-rouge">request</code></a>. Install as always:</p>

<div class="language-console highlighter-rouge"><pre class="highlight"><code><span class="w">$ </span><span class="nc">npm</span><span class="kv"> install request --save
</span></code></pre>
</div>

<p>From the NPM description:</p>

<blockquote>
  <p>Request is designed to be the simplest way possible to make http calls. It supports HTTPS and follows redirects by default.</p>
</blockquote>

<p>Here is a NodeJS function that uses <code class="highlighter-rouge">request</code> to perform the call</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">encodedAddress</span> <span class="o">=</span> <span class="nb">encodeURIComponent</span><span class="p">(</span><span class="nx">address</span><span class="p">);</span>

  <span class="nx">request</span><span class="p">({</span>
    <span class="na">url</span><span class="p">:</span> <span class="err">`</span><span class="na">https</span><span class="p">:</span><span class="c1">//maps.googleapis.com/maps/api/geocode/json?address=${encodedAddress}`,</span>
    <span class="na">json</span><span class="p">:</span> <span class="kc">true</span>
  <span class="p">},</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">response</span><span class="p">,</span> <span class="nx">body</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>

    <span class="c1">//server unreachable</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span> 
      <span class="nx">callback</span><span class="p">(</span><span class="s1">'Unable to connect to Google Servers'</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// no results </span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">body</span><span class="p">.</span><span class="nx">status</span> <span class="o">===</span> <span class="s1">'ZERO_RESULTS'</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">callback</span><span class="p">(</span><span class="s1">'Unable to find that address'</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">body</span><span class="p">.</span><span class="nx">status</span> <span class="o">===</span> <span class="s1">'OK'</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">callback</span><span class="p">(</span><span class="kc">undefined</span><span class="p">,</span> <span class="p">{</span>
        <span class="na">address</span><span class="p">:</span> <span class="nx">body</span><span class="p">.</span><span class="nx">results</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">formatted_address</span><span class="p">,</span>
        <span class="na">latitude</span><span class="p">:</span> <span class="nx">body</span><span class="p">.</span><span class="nx">results</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">geometry</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">lat</span><span class="p">,</span>
        <span class="na">longitude</span><span class="p">:</span> <span class="nx">body</span><span class="p">.</span><span class="nx">results</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">geometry</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">lng</span>
      <span class="p">});</span>
    <span class="p">}</span>

  <span class="p">});</span>
</code></pre>
</div>

<p><code class="highlighter-rouge">encodeURIComponent()</code> is a function that converts strings with special characters (like spaces, or quotes..) to a string that can be passed over a URI.</p>

<p><code class="highlighter-rouge">request</code> is just a function that takes an URI, some options, and will give the result in a <strong>callback</strong>. Since we are following Node standard approach to callbacks, where the first argument is the error object, the return callback contains a <code class="highlighter-rouge">undefined</code> as first argument.</p>

<h2 id="axios-a-promise-based-equivalent">Axios: a Promise based equivalent</h2>

<p><a href="https://michelenasti.com/2017/03/12/js-promises-description-pros-cons-of-this-es6-construct.html">In my last article we talked about promises</a>, so we would like to see these in action, right? We have two options, the first is to wrap <code class="highlighter-rouge">request</code> in a promise (easy, but more code); the second is to <strong>use a library already built with promises in mind</strong>.</p>

<p>The one I use, and that is super popular, is called <strong><a href="https://www.npmjs.com/package/axios"><code class="highlighter-rouge">Axios</code></a></strong>: Here’s the description</p>

<blockquote>
  <p>Promise based HTTP client for the browser and node.js</p>
</blockquote>

<p>To install:</p>

<div class="language-console highlighter-rouge"><pre class="highlight"><code><span class="w">$ </span><span class="nc">npm</span><span class="kv"> install axios
</span></code></pre>
</div>

<p>Here is the snippet for the axios request:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">encodedAddress</span> <span class="o">=</span> <span class="nb">encodeURIComponent</span><span class="p">(</span><span class="nx">address</span><span class="p">);</span>

<span class="kd">let</span> <span class="nx">geocodeUrl</span> <span class="o">=</span> <span class="err">`</span><span class="nx">https</span><span class="err">:</span><span class="c1">//maps.googleapis.com/maps/api/geocode/json?address=${encodedAddress}`;</span>

<span class="nx">axios</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">geocodeUrl</span><span class="p">).</span><span class="nx">then</span><span class="p">((</span><span class="nx">response</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// throw error on no results</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">status</span> <span class="o">===</span> <span class="s1">'ZERO_RESULTS'</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">'Unable to find that address'</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="c1">// return new promise with data (for chaining)</span>
  <span class="k">return</span> <span class="nx">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">({</span>
    <span class="na">latitude</span><span class="p">:</span> <span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">results</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">geometry</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">lat</span><span class="p">,</span>
    <span class="na">longitude</span><span class="p">:</span> <span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">results</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">geometry</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">lng</span><span class="p">,</span>
    <span class="na">formatted_address</span><span class="p">:</span> <span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">results</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">formatted_address</span>
  <span class="p">});</span>

  <span class="c1">// show data</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">((</span><span class="nx">response</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="err">`</span><span class="na">latitude</span><span class="p">:</span> <span class="nx">$</span><span class="p">{</span><span class="nx">response</span><span class="p">.</span><span class="nx">formatted_address</span><span class="p">}</span><span class="err">`</span><span class="p">);</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="err">`</span><span class="na">latitude</span><span class="p">:</span> <span class="nx">$</span><span class="p">{</span><span class="nx">response</span><span class="p">.</span><span class="nx">latitude</span><span class="p">}</span><span class="err">`</span><span class="p">);</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="err">`</span><span class="na">latitude</span><span class="p">:</span> <span class="nx">$</span><span class="p">{</span><span class="nx">response</span><span class="p">.</span><span class="nx">longitude</span><span class="p">}</span><span class="err">`</span><span class="p">);</span>

  <span class="c1">//error handling </span>
<span class="p">}).</span><span class="k">catch</span><span class="p">((</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span>
<span class="p">});</span> 
</code></pre>
</div>

<p>The approach here is different. <code class="highlighter-rouge">axios.get()</code> returns a Promise, that we chain with a call to the <code class="highlighter-rouge">then()</code> method.</p>

<p>Once we have the data, in the form of <code class="highlighter-rouge">response.data</code>, we can extrapolate the fields we need.</p>

<p>I could just print the data in the first <code class="highlighter-rouge">then()</code> block, but to be more coherent with my design guidelines (<em>every function does just one thing</em>) I wanted to separate the two operations so the first block will just retrieve the data, then returns another Promise (<code class="highlighter-rouge">return Promise.resolve({..})</code>).</p>

<p>The next <code class="highlighter-rouge">then()</code> block will only display the data retrieved.</p>

<h2 id="which-approach-do-you-prefer">Which approach do you prefer?</h2>

<p>This depends on you! <strong>I prefer promises</strong>, because I find them more natural, but being a Node coder means you can choose and decide what’s best for you. Both are well tested libraries with well known patterns, so you only have to choose the one you love.</p>

<p>Cheers from <code class="highlighter-rouge">40.7802306</code>, <code class="highlighter-rouge">14.7010686</code> !</p>

                  
                    <footer>
                        <aside>Written by Amit Seal Ami, a Lecturer from Institute of Information Technology, University of Dhaka.</aside>
                        <small>Copyright - Amit Seal Ami</small>
                  </footer>
                </article>
              </body>
            </html>
        ]]>
        </content:encoded>

      </item>
    
      <item>
        <title>JS Promises: description, pros, cons of this ES6 construct</title>
        <link>https://michelenasti.com/2017/03/12/js-promises-description-pros-cons-of-this-es6-construct.html</link>
        <guid isPermaLink="true">https://michelenasti.com/2017/03/12/js-promises-description-pros-cons-of-this-es6-construct.html</guid>
        <pubDate>Sun, 12 Mar 2017 13:06:29 +0000</pubDate>
        <author></author>
        
          <description>&lt;p&gt;I hope that you have done some kind of exploration with Javascript, NodeJS and asynchronous constructs right now.&lt;/p&gt;

&lt;p&gt;To recap: when you wait for an async operation to handle the result, for example in NodeJS when we read a file, we do this:&lt;/p&gt;

&lt;div class=&quot;language-javascript highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kr&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;fs&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'fs'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;fs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;readFile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'filename.txt'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;err&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
   &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;err&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;err&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; 
   &lt;span class=&quot;c1&quot;&gt;//now you can use the data object &lt;/span&gt;
   &lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;This is the standard, classic way of handling asynchronicity in NodeJS and Javascript.&lt;/p&gt;

&lt;p&gt;In the last few years a new approach has come to rise, first from outside libraries, then as part of ES6 language: &lt;strong&gt;Promises&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/promise.jpg&quot; alt=&quot;&quot; style=&quot;float: none;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Not me in the photo. This is the Italian way to promise. I love his way of looking guilty. &lt;/em&gt;&lt;/p&gt;

&lt;h2 id=&quot;i-promise-that-i-will-give-you-the-result&quot;&gt;I promise that I will give you the result&lt;/h2&gt;

&lt;p&gt;I don’t want to talk about the history of promises, because like everything in JS Promises have a complex story coming from many libraries doing the same thing, with different syntaxes and patterns.&lt;/p&gt;

&lt;p&gt;However ES6 has standardized this, and now we have a fantastic &lt;code class=&quot;highlighter-rouge&quot;&gt;Promise&lt;/code&gt; object. Let’s see how to use it.&lt;/p&gt;

&lt;p&gt;The following snippet will create a Promise that waits 2,5 seconds and then sends a message &lt;code class=&quot;highlighter-rouge&quot;&gt;Hey. it worked&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;language-javascript highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;somePromise&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;Promise&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;resolve&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;reject&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;//1&lt;/span&gt;
  &lt;span class=&quot;nx&quot;&gt;setTimeout&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// only one can be called and only once &lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;resolve&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'Hey. it worked'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;                      &lt;span class=&quot;c1&quot;&gt;//2&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;//reject('Unable to fulfill promise');          //3&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2500&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;});&lt;/span&gt; 

&lt;span class=&quot;nx&quot;&gt;somePromise&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;then&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;                                   &lt;span class=&quot;c1&quot;&gt;//4&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'Success: '&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt; 
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;errorMessage&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'Error: '&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;errorMessage&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;My definition of promises: &lt;strong&gt;a &lt;code class=&quot;highlighter-rouge&quot;&gt;Promise&lt;/code&gt; is a wrapper object that you use to encapsulate a function that might return a value in the future&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;We declare a promise as showed in (1): &lt;code class=&quot;highlighter-rouge&quot;&gt;new Promise()&lt;/code&gt; with a function inside.&lt;/p&gt;

&lt;p&gt;This function takes two arguments that are two other functions, usually called &lt;code class=&quot;highlighter-rouge&quot;&gt;resolve&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;reject&lt;/code&gt;. So the full specification is &lt;code class=&quot;highlighter-rouge&quot;&gt;let somePromise = new Promise((resolve, reject) =&amp;gt; {...});&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;How do you use these two parameters? &lt;code class=&quot;highlighter-rouge&quot;&gt;resolve&lt;/code&gt; (2) is a function used to return a value, when the function ends normally (e.g. reading a file, you get the content of the file and return to the caller); &lt;code class=&quot;highlighter-rouge&quot;&gt;reject&lt;/code&gt; (3) is used when you encounter a problem (e.g. you couldn’t read the file).&lt;/p&gt;

&lt;p&gt;There are some bonds on using Promises:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;you cannot call both &lt;code class=&quot;highlighter-rouge&quot;&gt;resolve&lt;/code&gt; or &lt;code class=&quot;highlighter-rouge&quot;&gt;reject&lt;/code&gt;in your code. As soon as one of the two functions gets called, the promise stops.&lt;/li&gt;
  &lt;li&gt;if you don’t call any of the two functions, the promise will hang.&lt;/li&gt;
  &lt;li&gt;you can only pass &lt;strong&gt;one&lt;/strong&gt; parameter to &lt;code class=&quot;highlighter-rouge&quot;&gt;resolve&lt;/code&gt; or &lt;code class=&quot;highlighter-rouge&quot;&gt;reject&lt;/code&gt;. If you have more stuff to pass, wrap everything in an object.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Ok, now we have defined a promise. How do we use it? An example is shown in (4): we just call the promise and then use the &lt;code class=&quot;highlighter-rouge&quot;&gt;then&lt;/code&gt; method to use the response.&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;then&lt;/code&gt; can take two functions as arguments:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;the first callback is called when the promise ends correctly, with the value contained in &lt;code class=&quot;highlighter-rouge&quot;&gt;resolve&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;the second callback is the &lt;em&gt;error handler&lt;/em&gt;, so you might want to use it when you want to get data from the &lt;code class=&quot;highlighter-rouge&quot;&gt;reject&lt;/code&gt; function.&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;chaining-promises&quot;&gt;Chaining promises&lt;/h2&gt;

&lt;p&gt;This approach is nice, but the true power comes when you can &lt;code class=&quot;highlighter-rouge&quot;&gt;chain&lt;/code&gt; many promises one after another.&lt;/p&gt;

&lt;p&gt;The following code shows a function &lt;code class=&quot;highlighter-rouge&quot;&gt;asyncAdd&lt;/code&gt; that adds two numbers after 1,5 seconds. I bet your calculator is faster. It does however some checks on the type of &lt;code class=&quot;highlighter-rouge&quot;&gt;a&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;b&lt;/code&gt;, to be sure they are numbers.&lt;/p&gt;

&lt;div class=&quot;language-javascript highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;asyncAdd&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;Promise&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;resolve&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;reject&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;setTimeout&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;typeof&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'number'&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;typeof&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;b&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'number'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;resolve&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;reject&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'Arguments must be numbers'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1500&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;

&lt;span class=&quot;nx&quot;&gt;asyncAdd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;                         &lt;span class=&quot;c1&quot;&gt;// (1)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;then&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;result&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;                  &lt;span class=&quot;c1&quot;&gt;// (2)&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;result&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;asyncAdd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;result&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'33'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;     &lt;span class=&quot;c1&quot;&gt;// (3)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;})&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;then&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;res&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;                     &lt;span class=&quot;c1&quot;&gt;// (4)&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'Should be 45:'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;res&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; 
  &lt;span class=&quot;p&quot;&gt;})&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;catch&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;errorMessage&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;           &lt;span class=&quot;c1&quot;&gt;// (5)&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;errorMessage&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;})&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;Quiz&lt;/strong&gt;: what does this code print? (Answer below)&lt;/p&gt;

&lt;p&gt;In (1) we are evaluating the first sum. &lt;strong&gt;Then&lt;/strong&gt; (2) (&lt;em&gt;Look how it is semantically fantastic to express this concept in plain english!!!&lt;/em&gt;) we write the result to console, and return another operation (3): we add the result to the number ‘33’ (&lt;strong&gt;note! it is a string!&lt;/strong&gt;).&lt;/p&gt;

&lt;p&gt;Since we are returning a function that returns a promise, we can chain the two promises with another &lt;code class=&quot;highlighter-rouge&quot;&gt;then()&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;We didn’t write the second &lt;code class=&quot;highlighter-rouge&quot;&gt;then&lt;/code&gt; callback, because we have used the &lt;code class=&quot;highlighter-rouge&quot;&gt;.catch()&lt;/code&gt; method. We will explain this in a second.&lt;/p&gt;

&lt;p&gt;In the second &lt;code class=&quot;highlighter-rouge&quot;&gt;then()&lt;/code&gt; (4) we would print the result of the total sum.&lt;/p&gt;

&lt;p&gt;Lastly, in (5) we have the &lt;code class=&quot;highlighter-rouge&quot;&gt;catch&lt;/code&gt; block. In the previous paragraph we were saying that you can handle errors inside every &lt;code class=&quot;highlighter-rouge&quot;&gt;then&lt;/code&gt;, but if you chain many &lt;code class=&quot;highlighter-rouge&quot;&gt;then&lt;/code&gt; together and the first one fails, the others are still executed. Usually you don’t want this, because the next &lt;code class=&quot;highlighter-rouge&quot;&gt;then&lt;/code&gt; depends on the result of the previous.&lt;/p&gt;

&lt;p&gt;So, if you just want to stop an operation at the first error encountered, you can use a single &lt;code class=&quot;highlighter-rouge&quot;&gt;catch()&lt;/code&gt; block at the end: whatever promise will fail, be it the first or the last, the &lt;code class=&quot;highlighter-rouge&quot;&gt;catch&lt;/code&gt; block will be called to handle the failure. So easy to reason about.&lt;/p&gt;

&lt;p&gt;(Sorry, no answer for the quiz… run it and see!)&lt;/p&gt;

&lt;h2 id=&quot;conclusions&quot;&gt;Conclusions&lt;/h2&gt;

&lt;p&gt;A promise is a new construct that, after some practice, becomes a powerful tool for your async constructs.&lt;/p&gt;

&lt;p&gt;The advantages are that you don’t have to write anymore nested callbacks with a lot of indented code, that is often complex to reason about, and to handle errors.&lt;/p&gt;

&lt;p&gt;The disadvantage is that there is much more than what I wrote in this article, about promises, that covers every possible edge case that naturally occours when you work with async code. However, what you read here should cover 80% of your needs.&lt;/p&gt;

&lt;p&gt;You can transform every callback in a promise; many NodeJS core developers don’t like promises at all, and use only callbacks. Popular libraries in NPM use one way or the other to deliver results, so you might be forced to use one or the other approach based on this.&lt;/p&gt;
</description>
        
        <content:encoded>
            <![CDATA[
                <!doctype html>
                <html lang="en" prefix="op: http://media.facebook.com/op#">
              <head>
                <meta charset="utf-8">
                <link rel="canonical" href="https://michelenasti.com/2017/03/12/js-promises-description-pros-cons-of-this-es6-construct.html">
                <meta property="op:markup_version" content="v1.0">
              </head>
              <body>
                <article>
                  <header>
                      <h1>JS Promises: description, pros, cons of this ES6 construct</h1>
                      
                      <figure>
                          <img src="https://michelenasti.com/images/michele_nasti.jpg" alt=" JS Promises: description, pros, cons of this ES6 construct ">
                          <figcaption>JS Promises: description, pros, cons of this ES6 construct</figcaption>
                      </figure>
                      
                      <time class="op-published" dateTime="2017-03-12 13:06:29 UTC">Sun, 12 Mar 2017 13:06:29 +0000</time>
                      <time class="op-modified" dateTime=""></time>
                  </header>
                  
                    <p>I hope that you have done some kind of exploration with Javascript, NodeJS and asynchronous constructs right now.</p>

<p>To recap: when you wait for an async operation to handle the result, for example in NodeJS when we read a file, we do this:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kr">const</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'fs'</span><span class="p">);</span>
<span class="nx">fs</span><span class="p">.</span><span class="nx">readFile</span><span class="p">(</span><span class="s1">'filename.txt'</span><span class="p">,</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
   <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="k">throw</span> <span class="nx">err</span><span class="p">;</span> 
   <span class="c1">//now you can use the data object </span>
   <span class="p">...</span>
<span class="p">});</span>
</code></pre>
</div>

<p>This is the standard, classic way of handling asynchronicity in NodeJS and Javascript.</p>

<p>In the last few years a new approach has come to rise, first from outside libraries, then as part of ES6 language: <strong>Promises</strong>.</p>

<p><img src="/images/promise.jpg" alt="" style="float: none;" /></p>

<p><em>Not me in the photo. This is the Italian way to promise. I love his way of looking guilty. </em></p>

<h2 id="i-promise-that-i-will-give-you-the-result">I promise that I will give you the result</h2>

<p>I don’t want to talk about the history of promises, because like everything in JS Promises have a complex story coming from many libraries doing the same thing, with different syntaxes and patterns.</p>

<p>However ES6 has standardized this, and now we have a fantastic <code class="highlighter-rouge">Promise</code> object. Let’s see how to use it.</p>

<p>The following snippet will create a Promise that waits 2,5 seconds and then sends a message <code class="highlighter-rouge">Hey. it worked</code>:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">somePromise</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="c1">//1</span>
  <span class="nx">setTimeout</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// only one can be called and only once </span>
    <span class="nx">resolve</span><span class="p">(</span><span class="s1">'Hey. it worked'</span><span class="p">);</span>                      <span class="c1">//2</span>
    <span class="c1">//reject('Unable to fulfill promise');          //3</span>
  <span class="p">},</span> <span class="mi">2500</span><span class="p">);</span>
<span class="p">});</span> 

<span class="nx">somePromise</span><span class="p">.</span><span class="nx">then</span><span class="p">(</span>                                   <span class="c1">//4</span>
  <span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Success: '</span> <span class="o">+</span> <span class="nx">message</span><span class="p">);</span>
  <span class="p">},</span> 
  <span class="p">(</span><span class="nx">errorMessage</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Error: '</span><span class="p">,</span> <span class="nx">errorMessage</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">);</span>
</code></pre>
</div>

<p>My definition of promises: <strong>a <code class="highlighter-rouge">Promise</code> is a wrapper object that you use to encapsulate a function that might return a value in the future</strong>.</p>

<p>We declare a promise as showed in (1): <code class="highlighter-rouge">new Promise()</code> with a function inside.</p>

<p>This function takes two arguments that are two other functions, usually called <code class="highlighter-rouge">resolve</code> and <code class="highlighter-rouge">reject</code>. So the full specification is <code class="highlighter-rouge">let somePromise = new Promise((resolve, reject) =&gt; {...});</code>.</p>

<p>How do you use these two parameters? <code class="highlighter-rouge">resolve</code> (2) is a function used to return a value, when the function ends normally (e.g. reading a file, you get the content of the file and return to the caller); <code class="highlighter-rouge">reject</code> (3) is used when you encounter a problem (e.g. you couldn’t read the file).</p>

<p>There are some bonds on using Promises:</p>

<ul>
  <li>you cannot call both <code class="highlighter-rouge">resolve</code> or <code class="highlighter-rouge">reject</code>in your code. As soon as one of the two functions gets called, the promise stops.</li>
  <li>if you don’t call any of the two functions, the promise will hang.</li>
  <li>you can only pass <strong>one</strong> parameter to <code class="highlighter-rouge">resolve</code> or <code class="highlighter-rouge">reject</code>. If you have more stuff to pass, wrap everything in an object.</li>
</ul>

<p>Ok, now we have defined a promise. How do we use it? An example is shown in (4): we just call the promise and then use the <code class="highlighter-rouge">then</code> method to use the response.</p>

<p><code class="highlighter-rouge">then</code> can take two functions as arguments:</p>

<ul>
  <li>the first callback is called when the promise ends correctly, with the value contained in <code class="highlighter-rouge">resolve</code></li>
  <li>the second callback is the <em>error handler</em>, so you might want to use it when you want to get data from the <code class="highlighter-rouge">reject</code> function.</li>
</ul>

<h2 id="chaining-promises">Chaining promises</h2>

<p>This approach is nice, but the true power comes when you can <code class="highlighter-rouge">chain</code> many promises one after another.</p>

<p>The following code shows a function <code class="highlighter-rouge">asyncAdd</code> that adds two numbers after 1,5 seconds. I bet your calculator is faster. It does however some checks on the type of <code class="highlighter-rouge">a</code> and <code class="highlighter-rouge">b</code>, to be sure they are numbers.</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">asyncAdd</span> <span class="o">=</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">new</span> <span class="nx">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">setTimeout</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">a</span> <span class="o">===</span> <span class="s1">'number'</span> <span class="o">&amp;&amp;</span> <span class="k">typeof</span> <span class="nx">b</span> <span class="o">===</span> <span class="s1">'number'</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">resolve</span><span class="p">(</span><span class="nx">a</span> <span class="o">+</span> <span class="nx">b</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">reject</span><span class="p">(</span><span class="s1">'Arguments must be numbers'</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">},</span> <span class="mi">1500</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">};</span>

<span class="nx">asyncAdd</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>                         <span class="c1">// (1)</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">result</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>                  <span class="c1">// (2)</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">asyncAdd</span><span class="p">(</span><span class="nx">result</span><span class="p">,</span> <span class="s1">'33'</span><span class="p">);</span>     <span class="c1">// (3)</span>
  <span class="p">})</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>                     <span class="c1">// (4)</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Should be 45:'</span><span class="p">,</span> <span class="nx">res</span><span class="p">);</span> 
  <span class="p">})</span>
  <span class="p">.</span><span class="k">catch</span><span class="p">((</span><span class="nx">errorMessage</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>           <span class="c1">// (5)</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">errorMessage</span><span class="p">);</span>
  <span class="p">})</span>
</code></pre>
</div>

<p><strong>Quiz</strong>: what does this code print? (Answer below)</p>

<p>In (1) we are evaluating the first sum. <strong>Then</strong> (2) (<em>Look how it is semantically fantastic to express this concept in plain english!!!</em>) we write the result to console, and return another operation (3): we add the result to the number ‘33’ (<strong>note! it is a string!</strong>).</p>

<p>Since we are returning a function that returns a promise, we can chain the two promises with another <code class="highlighter-rouge">then()</code>.</p>

<p>We didn’t write the second <code class="highlighter-rouge">then</code> callback, because we have used the <code class="highlighter-rouge">.catch()</code> method. We will explain this in a second.</p>

<p>In the second <code class="highlighter-rouge">then()</code> (4) we would print the result of the total sum.</p>

<p>Lastly, in (5) we have the <code class="highlighter-rouge">catch</code> block. In the previous paragraph we were saying that you can handle errors inside every <code class="highlighter-rouge">then</code>, but if you chain many <code class="highlighter-rouge">then</code> together and the first one fails, the others are still executed. Usually you don’t want this, because the next <code class="highlighter-rouge">then</code> depends on the result of the previous.</p>

<p>So, if you just want to stop an operation at the first error encountered, you can use a single <code class="highlighter-rouge">catch()</code> block at the end: whatever promise will fail, be it the first or the last, the <code class="highlighter-rouge">catch</code> block will be called to handle the failure. So easy to reason about.</p>

<p>(Sorry, no answer for the quiz… run it and see!)</p>

<h2 id="conclusions">Conclusions</h2>

<p>A promise is a new construct that, after some practice, becomes a powerful tool for your async constructs.</p>

<p>The advantages are that you don’t have to write anymore nested callbacks with a lot of indented code, that is often complex to reason about, and to handle errors.</p>

<p>The disadvantage is that there is much more than what I wrote in this article, about promises, that covers every possible edge case that naturally occours when you work with async code. However, what you read here should cover 80% of your needs.</p>

<p>You can transform every callback in a promise; many NodeJS core developers don’t like promises at all, and use only callbacks. Popular libraries in NPM use one way or the other to deliver results, so you might be forced to use one or the other approach based on this.</p>

                  
                    <footer>
                        <aside>Written by Amit Seal Ami, a Lecturer from Institute of Information Technology, University of Dhaka.</aside>
                        <small>Copyright - Amit Seal Ami</small>
                  </footer>
                </article>
              </body>
            </html>
        ]]>
        </content:encoded>

      </item>
    
  </channel>
</rss>